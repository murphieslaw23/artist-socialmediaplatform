import{p as oo,c as eo,n as to,d as so,j as io,e as lo,u as ro,i as y,_ as no,l as ao}from"../server.mjs";import{u as co}from"./useI18n.9785d6fe.js";import{_ as H,u as uo,a as v}from"./Icon.66eb61eb.js";import{u as po}from"./useFeed.0a870d4a.js";import{openBlock as n,createElementBlock as a,onBeforeMount as _o,onMounted as mo,watch as ho,ref as m,createBlock as F,KeepAlive as vo,createVNode as s,withCtx as d,withDirectives as k,vShow as w,createElementVNode as t,Fragment as ko,renderList as wo,createTextVNode as _,toDisplayString as l,createCommentVNode as c,withModifiers as f,normalizeClass as g,unref as L,pushScopeId as xo,popScopeId as yo}from"vue";import"vue-router";import{S as fo,M as go,a as bo,u as Co,b as Mo,c as Io,d as $o}from"./ModalView.784f5ea3.js";import{L as So}from"./Layout.294e92ff.js";import{I as A,F as Ao}from"./FeedModalView.e4cf9595.js";import"#internal/nitro";import"./LoadingEmptyErrorMessage.02098181.js";import"./Spinner.8f56f1de.js";import"./user-counters-api.260734d1.js";const Fo={};function Lo(b,C){return n(),a("div")}const Ro=H(Fo,[["render",Lo]]);const $=b=>(xo("data-v-3c9bc210"),b=b(),yo(),b),Vo={class:"mx-auto w-full"},Eo={class:"grid grid-cols-1 gap-1 mx-auto md:gap-2 xl:w-11/12"},Bo={class:"flex flex-row rounded-md theme-color"},No={class:"w-full"},To={key:0,class:"p-2 md:p-4 user-info"},Oo=["src"],Do={class:"name"},zo=$(()=>t("br",null,null,-1)),Uo=$(()=>t("span",{class:"mx-1"},"\xB7",-1)),jo={key:1,class:"px-2 mt-2 md:px-4"},Go={class:"text-xs font-semibold"},Ho=["id"],Ko=["id","onClick"],Po=["onClick"],Wo={key:2,class:"px-2 md:px-4"},qo={key:0,class:"my-2 w-full rounded-md theme-color-secondary"},Jo={key:0,class:"p-2 md:p-4 user-info"},Qo=["src"],Xo={class:"name"},Yo=$(()=>t("br",null,null,-1)),Zo=$(()=>t("span",{class:"mx-1"},"\xB7",-1)),oe={class:"px-2 mt-2 md:px-4"},ee={class:"text-xs font-semibold"},te=["id"],se=["id","onClick"],ie=["onClick"],le={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},re={class:"mx-auto mt-2 primary-button"},ne={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},ae={class:"mx-auto mt-2 primary-button"},ce={class:"float-right mx-4 mt-2 interactions"},de={key:0,class:"reactions"},ue=["onClick"],pe=["onClick"],_e=["onClick"],me={class:"option dropdown"},he={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"option-dropdown-items"},ve={class:"option-dropdown dropdown-menu"},ke={id:"option-dropdown-items",class:"w-52 toggler","aria-labelledby":"option-dropdown-buttons",role:"menu"},we={class:"menu-wrapper"},xe=$(()=>t("div",{class:"custom-divider"},null,-1)),ye=["onClick"],fe={id:"chronological-modal",class:"modal work-view"},ge={id:"chronological-feed-modal",class:"z-30 modal work-view"},be={__name:"index",props:{changeMode:{type:Function,default:()=>{}}},setup(b){oo({title:co().tl("meta.title.feed")});const C=eo();to();const{oApiConfiguration:R,fetchOptions:V}=so(),E=uo(R,V()),B=po(R,V()),K=io(),P=lo(),{$router:W}=ro();_o(()=>{C.loggedIn||P.push({path:"/explore"})}),mo(()=>{}),ho(()=>W.currentRoute.value.params.path,()=>{X(),y().closeModal("feed-collection-selection-modal")}),m({explicitMode:void 0,pagination:{page:0,perPage:10}});const N=m([]),T=m(null),S=(e,r,i)=>{r?N.value[i].apply_explicit_filter=!1:(T.value.view(e),y().openModal("chronological-modal"))},O=m(null),q=e=>{O.value.view(e),y().openModal("chronological-feed-modal")},D=(e,r,i,p)=>{Co().readMore(e,r,i,p)},z=m(!1);let J;const Q=e=>{const r=m(K.public.appUrl+e),{copy:i}=Mo({source:r});i(),Io().splash(J,z,"copy-alert")},M=m([]),h=m([]),U=async(e,r)=>{const i=parseInt(e.split("-")[1]);let p=!1;if(r==="artworks"){const[o,x]=await E.like({workId:i});p=o}else if(r==="feeds"){const[o,x]=await B.like({feedId:i});p=o}if(p){h.value.push(e);const o=document.getElementById(`feed-like-button-${r}-${i}`);o.classList.add("animate-bounce"),setInterval(()=>{o.classList.remove("animate-bounce")},2500)}},j=async(e,r)=>{const i=parseInt(e.split("-")[1]);let p=!1;if(r==="artworks"){const[o,x]=await E.unlike({workId:i});p=o}else if(r==="feeds"){const[o,x]=await B.unlike({feedId:i});p=o}if(p){const o=h.value.indexOf(e);h.value.splice(o,1)}},X=()=>{y().closeModal("chronological-modal"),y().closeModal("chronological-feed-modal")},G=m(null),I=m(0),Y=e=>{I.value=e,y().openModal("feed-collection-selection-modal"),G.value.fetchCurrentSaved()},Z=e=>{if(e){const r=M.value.indexOf(I.value);M.value.splice(r,1)}else M.value.push(I.value);$o().animate("save-to-collection-button-"+I.value)};return(e,r)=>{const i=no,p=ao;return n(),F(vo,null,[s(So,{"with-footer":!0,"hide-side":e.isMobile()},{"right-side":d(()=>[s(Ro)]),default:d(()=>[k(s(fo,{id:"copy-alert",text:e.$t("linkCopied"),icon:"i-bi-check-all"},null,8,["text"]),[[w,z.value]]),t("div",Vo,[t("div",Eo,[(n(!0),a(ko,null,wo(N.value,(o,x)=>(n(),a("div",{key:o.id+o.type,class:"rounded-md lg:mx-6"},[t("div",Bo,[t("div",No,[o.users?(n(),a("div",To,[s(i,{to:"/profile/"+o.users.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.users.avatar_bucket,o.users.avatar_filename),onError:r[0]||(r[0]=(...u)=>e.imageLoadError&&e.imageLoadError(...u))},null,40,Oo)]),_:2},1032,["to"]),t("div",Do,[s(i,{to:"/profile/"+o.users.username,class:"fullname hover:href"},{default:d(()=>[_(l(o.users.name),1)]),_:2},1032,["to"]),zo,s(i,{to:"/profile/"+o.users.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+l(o.users.username),1)]),_:2},1032,["to"]),Uo,s(i,{to:(o.type==="artwork"?"/a/":"/feed/")+o.id,class:"hover:underline text-xxs"},{default:d(()=>[_(l(e.formatDate(o.scheduled_post?o.scheduled_post:o.created_at,!0)),1)]),_:2},1032,["to"])])])):c("",!0),o.type==="artwork"?(n(),a("div",jo,[t("span",Go,l(o.title),1),k(t("p",null,[t("span",{id:"feed-description-"+o.id},l(o.description.length>300?`${o.description.slice(0,300)}...`:o.description),9,Ho),o.description.length>300?(n(),a("a",{key:0,id:"feed-read-more-"+o.id,class:"href",onClick:f(u=>D(o.description,o.id,"feed-read-more-","feed-description-"),["prevent"])},l(e.$t("readMore")),9,Ko)):c("",!0)],512),[[w,o.description]])])):c("",!0),t("div",null,[t("div",null,[o.type==="artwork"&&!e.isMobile()?(n(),a("div",{key:0,class:"cursor-pointer",onClick:f(u=>S(o.id),["prevent"])},[s(A,{class:"p-2 md:p-4",work:o},null,8,["work"])],8,Po)):c("",!0),o.type==="artwork"&&e.isMobile()?(n(),F(i,{key:1,to:"/a/"+o.id,class:"cursor-pointer"},{default:d(()=>[s(A,{class:"p-2",work:o},null,8,["work"])]),_:2},1032,["to"])):c("",!0)])]),o.type==="feed"?(n(),a("div",Wo,[k(t("p",{class:g(["mt-2",{"mb-2":!o.artwork_share_info}])},l(o.text),3),[[w,o.text]]),o.artwork_share_info?(n(),a("div",qo,[o.artwork_share_info.user?(n(),a("div",Jo,[s(i,{to:"/profile/"+o.artwork_share_info.user.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.artwork_share_info.user.avatar_bucket,o.artwork_share_info.user.avatar_filename),onError:r[1]||(r[1]=(...u)=>e.imageLoadError&&e.imageLoadError(...u))},null,40,Qo)]),_:2},1032,["to"]),t("div",Xo,[s(i,{to:"/profile/"+o.artwork_share_info.user.username,class:"fullname hover:href"},{default:d(()=>[_(l(o.artwork_share_info.user.name),1)]),_:2},1032,["to"]),Yo,s(i,{to:"/profile/"+o.artwork_share_info.user.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+l(o.artwork_share_info.user.username),1)]),_:2},1032,["to"]),Zo,s(i,{to:"/a/"+o.artwork_share_info.id,class:"hover:underline text-xxs"},{default:d(()=>[_(l(e.formatDate(o.artwork_share_info.scheduled_post?o.artwork_share_info.scheduled_post:o.artwork_share_info.created_at,!0)),1)]),_:2},1032,["to"])])])):c("",!0),t("div",oe,[t("span",ee,l(o.artwork_share_info.title),1),k(t("p",null,[t("span",{id:"feed-description-"+o.artwork_share_info.id},l(o.artwork_share_info.description.length>300?`${o.artwork_share_info.description.slice(0,300)}...`:o.artwork_share_info.description),9,te),o.artwork_share_info.description.length>300?(n(),a("a",{key:0,id:"feed-read-more-"+o.artwork_share_info.id,class:"href",onClick:f(u=>D(o.artwork_share_info.description,o.artwork_share_info.id,"feed-read-more-","feed-description-"),["prevent"])},l(e.$t("readMore")),9,se)):c("",!0)],512),[[w,o.artwork_share_info.description]])]),t("div",null,[e.isMobile()?c("",!0):(n(),a("div",{key:0,class:g(["p-2",{"cursor-pointer":!o.apply_explicit_filter}]),onClick:f(u=>S(o.artwork_share_info.id,o.apply_explicit_filter,x),["prevent"])},[t("div",{class:g(["overflow-hidden relative p-2 rounded-md",{"md:mx-2":o.apply_explicit_filter}])},[s(A,{class:g([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(n(),a("div",le,[t("div",null,l(L(C).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",re,l(e.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)],10,ie)),e.isMobile()?(n(),F(i,{key:1,to:o.apply_explicit_filter?null:"/a/"+o.artwork_share_info.id,onClick:f(u=>S(o.artwork_share_info.id,o.apply_explicit_filter,x),["prevent"]),class:"cursor-pointer"},{default:d(()=>[t("div",{class:g(["overflow-hidden relative p-2 rounded-md",{"m-2":o.apply_explicit_filter}])},[s(A,{class:g([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(n(),a("div",ne,[t("div",null,l(L(C).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",ae,l(e.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)]),_:2},1032,["to","onClick"])):c("",!0)])])):c("",!0)])):c("",!0),t("div",ce,[L(C).loggedIn?(n(),a("div",de,[t("span",{onClick:u=>o.type==="artwork"?h.value.includes("a-"+o.id)?j("a-"+o.id,o.type):U("a-"+o.id,o.type):h.value.includes("f-"+o.id)?j("f-"+o.id,o.type):U("f-"+o.id,o.type)},[k(s(v,{id:"feed-like-button-"+o.type+"-"+o.id,name:"i-ion-heart",class:"mr-1 text-red-500 hover:text-red-500"},null,8,["id"]),[[w,o.type==="artwork"?h.value.includes("a-"+o.id):h.value.includes("f-"+o.id)]]),k(s(v,{name:"i-ion-heart-outline",class:"mr-1 icon-color hover:text-red-500"},null,512),[[w,o.type==="artwork"?!h.value.includes("a-"+o.id):!h.value.includes("f-"+o.id)]]),_(" "+l(e.thousand(o._count.likes)),1)],8,ue),t("span",{onClick:f(u=>o.type==="artwork"?S(o.id):q(o.id),["prevent"])},[s(v,{name:"i-mdi-comment-multiple-outline",class:"mr-1 icon-color hover:text-blue-500"}),_(" "+l(e.thousand(o._count.comments)),1)],8,pe),o.type==="artwork"?(n(),a("span",{key:0,onClick:u=>Y(o.id)},[k(s(v,{id:"save-to-collection-button-"+o.id,name:"i-ion-bookmark",class:"text-blue-500 hover:text-blue-500"},null,8,["id"]),[[w,M.value.includes(o.id)]]),k(s(v,{name:"i-majesticons-bookmark-line",class:"icon-color hover:text-blue-500"},null,512),[[w,!M.value.includes(o.id)]])],8,_e)):c("",!0),t("div",me,[t("button",he,[t("span",null,[s(v,{name:"i-uit-ellipsis-v",class:"align-middle icon icon-color"})])]),t("div",ve,[t("div",ke,[t("div",we,[s(i,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,class:"flex py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[s(v,{name:"i-fluent-arrow-enter-20-filled",class:"mr-2 text-base"}),_(" "+l(e.$t("open")),1)]),_:2},1032,["to"]),s(i,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,target:"_blank",class:"flex z-20 py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[s(v,{name:"i-ci-external-link",class:"mr-2 text-base"}),_(" "+l(e.$t("openInNewTab")),1)]),_:2},1032,["to"]),xe,t("a",{class:"flex py-2 px-3 w-full leading-4 rounded-md transition-all duration-150 cursor-pointer hover:button-color parent-icon hover:text-white",onClick:u=>Q(o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id)},[s(v,{name:"i-icon-park-outline-copy",class:"mr-2 text-base"}),_(" "+l(e.$t("copySharableLink")),1)],8,ye)])])])])])):c("",!0)])])])]))),128)),s(p),t("div",fe,[s(go,{ref_key:"chronologicalModalViewRef",ref:T,section:"chronological"},null,512)]),t("div",ge,[s(Ao,{ref_key:"chronologicalFeedModalViewRef",ref:O,section:"chronological-feed"},null,512)]),s(bo,{id:"feed-collection-selection-modal","modal-id":"feed-collection-selection-modal",ref_key:"collectionSelectionModalRef",ref:G,"work-id":I.value,class:"modal",onSave:Z},null,8,["work-id"])])])]),_:1},8,["hide-side"])],1024)}}},Te=H(be,[["__scopeId","data-v-3c9bc210"]]);export{Te as default};
//# sourceMappingURL=index.456c6ef8.js.map
