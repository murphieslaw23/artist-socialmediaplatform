import{c as N,d as T,i as v,_ as H,k as J}from"../server.mjs";import{ref as l,reactive as K,resolveComponent as E,openBlock as M,createElementBlock as W,createElementVNode as s,toDisplayString as _,createVNode as f,withCtx as V,createTextVNode as R,normalizeClass as b,createCommentVNode as j,withDirectives as y,vShow as k,createBlock as L,onMounted as Q,watch as X,unref as Y}from"vue";import"vue-router";import{L as Z}from"./Layout.1d340549.js";import{_ as $,a as ee,u as oe}from"./Icon.93e80fad.js";import{W as te,M as ae}from"./ModalView.59914c51.js";import{_ as ne}from"./LoadingEmptyErrorMessage.22f8db37.js";import{u as ie}from"./useUser.6818e1d7.js";import"#internal/nitro";import"./Spinner.7606b4f6.js";import"./user-counters-api.3030b6d8.js";import"./useFeed.5ef81cdb.js";const re={components:{Icon:ee,WorkList:te,ModalView:ae,LoadingEmptyErrorMessage:ne},props:{title:{type:String,default:""},section:{type:String,default:""},paginationProp:{type:Object,default(){return{perPage:{type:Number,default:6},maxLoadMore:{type:Number,default:5}}}},discoverRoute:{type:String,default:"/"}},setup(t){const o=N(),{oApiConfiguration:a,fetchOptions:e}=T(),g=oe(a,e()),h=l([]),m=async()=>{const n=await P();if(n){const u=n.works,r=n.pagination;h.value=u,r.record_total<=i.perPage&&x(),r.record_total===0&&q()}else S()},p=l(!0),c=l(void 0),i=K({perPage:t.paginationProp.perPage,page:l(0)}),P=async()=>{i.page===0&&(p.value=!0);try{let n,u;if(t.section==="recent"){const[r,w]=await g.getLatest({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});r?n=r:u=w}else if(t.section==="following"){const[r,w]=await g.getFollowing({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});r?n=r:u=w}else if(t.section==="popular"){const[r,w]=await g.getMostPopular({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value,range:"daily",rangeMode:"none"});r?n=r:u=w}return i.page+=1,z(),n}catch{S()}},d=l({delay:!1,maxLoad:t.paginationProp.maxLoadMore,showDiscoveryButton:!1}),U=async()=>{d.value.delay=!0;const n=await P(),u=n.works,r=n.pagination;u.forEach(w=>{h.value.push(w)}),d.value.delay=!1,r.next_previous.next_page||x(),r.next_previous.next_page&&r.current_page===d.value.maxLoad&&(x(),d.value.showDiscoveryButton=!0)},B=l(!0),x=()=>{B.value=!1},C=l(!1),q=()=>{C.value=!0,x()},A=l(!1),S=()=>{p.value=!1,A.value=!0,x()},z=()=>{p.value=!1,C.value=!1,A.value=!1},G=n=>{c.value=n,i.page=0,B.value=!0,d.value.showDiscoveryButton=!1,m()},D=l(null),I=l(null),O=l(null);return{auth:o,loading:p,explicitMode:c,changeExplicitMode:G,fetchTop:m,pagination:i,works:h,loadMoreOptions:d,showLoadMoreButton:B,loadMore:U,isEmpty:C,isError:A,recentModalViewRef:D,followingModalViewRef:I,popularModalViewRef:O,view:(n,u=!1)=>{t.section==="recent"&&D.value.view(n,u),t.section==="following"&&I.value.view(n,u),t.section==="popular"&&O.value.view(n,u),v().openModal(`${t.section}-modal`)}}}},se={id:"lists"},le={class:"navigations"},ce={class:"title hidden-md-flex"},de={class:"buttons"},ue={key:0,class:"filter-buttons"},pe={class:"hidden-md-flex"},fe=["id"];function ge(t,o,a,e,g,h){const m=E("Icon"),p=H,c=E("LoadingEmptyErrorMessage"),i=E("WorkList"),P=E("ModalView");return M(),W("div",null,[s("div",se,[s("div",le,[s("div",ce,_(a.title),1),f(p,{to:a.discoverRoute,class:"flex flex-row justify-between title md:hidden"},{default:V(()=>[R(_(a.title)+" ",1),f(m,{name:"i-fluent-arrow-enter-20-filled",class:"text-xl text-colored"})]),_:1},8,["to"]),s("div",de,[e.auth.loggedIn&&e.auth.user.user_settings&&e.auth.user.user_settings.show_explicit?(M(),W("div",ue,[s("p",{class:b(["rounded-l-md button-item",[e.explicitMode===void 0?"button":"theme-color"]]),onClick:o[0]||(o[0]=d=>e.changeExplicitMode(void 0))},_(t.$t("default")),3),s("p",{class:b(["button-item",[e.explicitMode==="safe"?"button":"theme-color"]]),onClick:o[1]||(o[1]=d=>e.changeExplicitMode("safe"))},_(t.$t("safe")),3),s("p",{class:b(["rounded-r-md button-item",[e.explicitMode==="explicit"?"button":"theme-color"]]),onClick:o[2]||(o[2]=d=>e.changeExplicitMode("explicit"))},_(t.$t("explicit")),3)])):j("",!0),s("div",pe,[f(p,{class:"discover-button",to:a.discoverRoute},{default:V(()=>[R(_(t.$t("seeMore")),1)]),_:1},8,["to"])])])]),f(c,{loading:e.loading,empty:e.isEmpty,error:e.isError,fetch:e.fetchTop},null,8,["loading","empty","error","fetch"]),y(s("div",null,[y(f(i,{"section-class":"work-grid",works:e.works,view:e.view},null,8,["works","view"]),[[k,!e.isEmpty]]),y(s("div",{class:b(["primary-button md:mt-4",e.loadMoreOptions.delay?"animate-pulse":""]),onClick:o[3]||(o[3]=(...d)=>e.loadMore&&e.loadMore(...d))},_(t.$t("loadMore")),3),[[k,e.showLoadMoreButton]]),y(s("div",null,[f(p,{to:"/works/"+a.section,class:"flex-row justify-center primary-button md:mt-4"},{default:V(()=>[f(m,{name:"i-fluent-arrow-enter-20-filled",class:"mr-1 text-white hover:text-white"}),R(" "+_(t.$t("seeMore")),1)]),_:1},8,["to"])],512),[[k,e.loadMoreOptions.showDiscoveryButton]])],512),[[k,!e.loading]]),s("div",{id:a.section+"-modal",class:"modal work-view"},[y(f(P,{ref:a.section+"ModalViewRef",section:a.section},null,8,["section"]),[[k,!e.loading]])],8,fe)])])}const F=$(re,[["render",ge],["__scopeId","data-v-01406299"]]),me={__name:"Recent",setup(t){const o={perPage:20,maxLoadMore:4};return(a,e)=>(M(),L(F,{section:"recent",title:a.$t("artworks.recentArtworks"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/recent"},null,8,["title","pagination-prop"]))}},_e={__name:"Following",setup(t){const o={perPage:10,maxLoadMore:4};return(a,e)=>(M(),L(F,{section:"following",title:a.$t("following"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/following","custom-empty-message":a.$t("explores.noFollowing")},null,8,["title","pagination-prop","custom-empty-message"]))}},we={__name:"Popular",setup(t){const o={perPage:10,maxLoadMore:4};return(a,e)=>(M(),L(F,{section:"popular",title:a.$t("artworks.dailyPopular"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/popular"},null,8,["title","pagination-prop"]))}},ve={class:"flex flex-col mt-2 w-full"},Re={__name:"index",setup(t){const{oApiConfiguration:o,fetchOptions:a}=T(),e=ie(o,a()),g=N();Q(()=>{g.loggedIn&&p()});const h=J();X(()=>h.query,c=>{setTimeout(()=>{v().closeModal("recent-modal"),v().closeModal("popular-modal"),v().closeModal("following-modal"),v().closeModal("collection-selection-modal"),v().closeModal("album-selection-modal"),v().closeModal("report-modal")},50)});const m=l(!1),p=async()=>{const[c,i]=await e.getFollowingList({userId:g.user.id,pagination:{page:0,perPage:1}});m.value=c.pagination.record_total>0};return(c,i)=>(M(),L(Z,{"with-footer":!0,"hide-side":!0,"no-right-side":!0,fullscreen:!0},{default:V(()=>[s("div",ve,[f(me,{class:"mb-10"}),Y(g).loggedIn&&m.value?(M(),L(_e,{key:0,class:"mb-10"})):j("",!0),f(we)])]),_:1}))}};export{Re as default};
//# sourceMappingURL=index.6737fd96.js.map
