import{p as X,c as Y,n as Z,d as oo,j as eo,u as to,i as f,_ as so,k as io}from"../server.mjs";import{u as ro}from"./useI18n.985c4375.js";import{_ as U,u as ao,a as k}from"./Icon.0b4f7d9a.js";import{u as no}from"./useFeed.28f12f74.js";import{openBlock as a,createElementBlock as c,onMounted as lo,watch as co,ref as m,createBlock as S,KeepAlive as uo,createVNode as s,withCtx as d,withDirectives as v,vShow as w,createElementVNode as t,Fragment as po,renderList as _o,createTextVNode as _,toDisplayString as r,createCommentVNode as u,withModifiers as M,normalizeClass as $,unref as mo,pushScopeId as ho,popScopeId as ko}from"vue";import"vue-router";import{S as vo,M as wo,a as fo,u as xo,b as yo,c as go,d as bo}from"./ModalView.bcb00595.js";import{L as Mo}from"./Layout.46c0288b.js";import{I as C,F as Co}from"./FeedModalView.a5709a20.js";import"#internal/nitro";import"./ErrorMessages.3c30c12c.js";import"./Spinner.77afb095.js";import"./user-counters-api.a4b9d8e9.js";const Io={};function So(y,A){return a(),c("div")}const $o=U(Io,[["render",So]]);const x=y=>(ho("data-v-d259f867"),y=y(),ko(),y),Ao={class:"mx-auto w-full"},Fo={class:"grid grid-cols-1 gap-1 mx-auto md:gap-2 xl:w-11/12"},Lo={class:"flex flex-row rounded-md theme-color"},Ro={class:"w-full"},Vo={key:0,class:"p-2 md:p-4 user-info"},Eo=["src"],Bo={class:"name"},No=x(()=>t("br",null,null,-1)),Oo=x(()=>t("span",{class:"mx-1"},"\xB7",-1)),Do={key:1,class:"px-2 mt-2 md:px-4"},To={class:"text-xs font-semibold"},zo=["id"],Uo=["id","onClick"],jo=["onClick"],Ho={key:2,class:"px-2 md:px-4"},Ko={key:0,class:"my-2 w-full rounded-md theme-color-secondary"},Po={key:0,class:"p-2 md:p-4 user-info"},Wo=["src"],qo={class:"name"},Go=x(()=>t("br",null,null,-1)),Jo=x(()=>t("span",{class:"mx-1"},"\xB7",-1)),Qo={class:"px-2 mt-2 md:px-4"},Xo={class:"text-xs font-semibold"},Yo=["id"],Zo=["id","onClick"],oe=["onClick"],ee={class:"overflow-hidden relative p-2 rounded-md md:p-4"},te={key:0,class:"p-2 w-full mx-auto text-center rounded-md opacity-90 theme-color"},se=x(()=>t("button",{class:"mx-auto mt-2 primary-button"},"Show me this content",-1)),ie={class:"float-right mx-4 mt-2 interactions"},re={key:0,class:"reactions"},ae=["onClick"],ne=["onClick"],le=["onClick"],ce={class:"option dropdown"},de={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"option-dropdown-items"},ue={class:"option-dropdown dropdown-menu"},pe={id:"option-dropdown-items",class:"w-52 toggler","aria-labelledby":"option-dropdown-buttons",role:"menu"},_e={class:"menu-wrapper"},me=x(()=>t("div",{class:"custom-divider"},null,-1)),he=["onClick"],ke={id:"chronological-modal",class:"modal work-view"},ve={id:"chronological-feed-modal",class:"z-30 modal work-view"},we={__name:"index",props:{changeMode:{type:Function,default:()=>{}}},setup(y){X({title:ro().tl("meta.title.feed")});const A=Y();Z();const{oApiConfiguration:F,fetchOptions:L}=oo(),R=ao(F,L()),V=no(F,L()),j=eo(),{$router:H}=to();lo(()=>{}),co(()=>H.currentRoute.value.params.path,()=>{G(),f().closeModal("feed-collection-selection-modal")}),m({explicitMode:void 0,pagination:{page:0,perPage:10}});const K=m([]),E=m(null),I=e=>{E.value.view(e),f().openModal("chronological-modal")},B=m(null),P=e=>{B.value.view(e),f().openModal("chronological-feed-modal")},N=(e,n,i,p)=>{xo().readMore(e,n,i,p)},O=m(!1);let W;const q=e=>{const n=m(j.public.appUrl+e),{copy:i}=yo({source:n});i(),go().splash(W,O,"copy-alert")},g=m([]),h=m([]),D=async(e,n)=>{const i=parseInt(e.split("-")[1]);let p=!1;if(n==="artworks"){const[o,l]=await R.like({workId:i});p=o}else if(n==="feeds"){const[o,l]=await V.like({feedId:i});p=o}if(p){h.value.push(e);const o=document.getElementById(`feed-like-button-${n}-${i}`);o.classList.add("animate-bounce"),setInterval(()=>{o.classList.remove("animate-bounce")},2500)}},T=async(e,n)=>{const i=parseInt(e.split("-")[1]);let p=!1;if(n==="artworks"){const[o,l]=await R.unlike({workId:i});p=o}else if(n==="feeds"){const[o,l]=await V.unlike({feedId:i});p=o}if(p){const o=h.value.indexOf(e);h.value.splice(o,1)}},G=()=>{f().closeModal("chronological-modal"),f().closeModal("chronological-feed-modal")},z=m(null),b=m(0),J=e=>{b.value=e,f().openModal("feed-collection-selection-modal"),z.value.fetchCurrentSaved()},Q=e=>{if(e){const n=g.value.indexOf(b.value);g.value.splice(n,1)}else g.value.push(b.value);bo().animate("save-to-collection-button-"+b.value)};return(e,n)=>{const i=so,p=io;return a(),S(uo,null,[s(Mo,{"with-footer":!0,"hide-side":e.isMobile()},{"right-side":d(()=>[s($o)]),default:d(()=>[v(s(vo,{id:"copy-alert",text:e.$t("linkCopied"),icon:"i-bi-check-all"},null,8,["text"]),[[w,O.value]]),t("div",Ao,[t("div",Fo,[(a(!0),c(po,null,_o(K.value,o=>(a(),c("div",{key:o.id+o.type,class:"rounded-md lg:mx-6"},[t("div",Lo,[t("div",Ro,[o.users?(a(),c("div",Vo,[s(i,{to:"/profile/"+o.users.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.users.avatar_bucket,o.users.avatar_filename),onError:n[0]||(n[0]=(...l)=>e.imageLoadError&&e.imageLoadError(...l))},null,40,Eo)]),_:2},1032,["to"]),t("div",Bo,[s(i,{to:"/profile/"+o.users.username,class:"fullname hover:href"},{default:d(()=>[_(r(o.users.name),1)]),_:2},1032,["to"]),No,s(i,{to:"/profile/"+o.users.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+r(o.users.username),1)]),_:2},1032,["to"]),Oo,s(i,{to:(o.type==="artwork"?"/a/":"/feed/")+o.id,class:"hover:underline text-xxs"},{default:d(()=>[_(r(e.formatDate(o.scheduled_post?o.scheduled_post:o.created_at,!0)),1)]),_:2},1032,["to"])])])):u("",!0),o.type==="artwork"?(a(),c("div",Do,[t("span",To,r(o.title),1),v(t("p",null,[t("span",{id:"feed-description-"+o.id},r(o.description.length>300?`${o.description.slice(0,300)}...`:o.description),9,zo),o.description.length>300?(a(),c("a",{key:0,id:"feed-read-more-"+o.id,class:"href",onClick:M(l=>N(o.description,o.id,"feed-read-more-","feed-description-"),["prevent"])},r(e.$t("readMore")),9,Uo)):u("",!0)],512),[[w,o.description]])])):u("",!0),t("div",null,[t("div",null,[o.type==="artwork"&&!e.isMobile()?(a(),c("div",{key:0,class:"cursor-pointer",onClick:M(l=>I(o.id),["prevent"])},[s(C,{class:"p-2 md:p-4",work:o},null,8,["work"])],8,jo)):u("",!0),o.type==="artwork"&&e.isMobile()?(a(),S(i,{key:1,to:"/a/"+o.id,class:"cursor-pointer"},{default:d(()=>[s(C,{class:"p-2",work:o},null,8,["work"])]),_:2},1032,["to"])):u("",!0)])]),o.type==="feed"?(a(),c("div",Ho,[v(t("p",{class:$(["mt-2",{"mb-2":!o.artwork_share_info}])},r(o.text),3),[[w,o.text]]),o.artwork_share_info?(a(),c("div",Ko,[o.artwork_share_info.user?(a(),c("div",Po,[s(i,{to:"/profile/"+o.artwork_share_info.user.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.artwork_share_info.user.avatar_bucket,o.artwork_share_info.user.avatar_filename),onError:n[1]||(n[1]=(...l)=>e.imageLoadError&&e.imageLoadError(...l))},null,40,Wo)]),_:2},1032,["to"]),t("div",qo,[s(i,{to:"/profile/"+o.artwork_share_info.user.username,class:"fullname hover:href"},{default:d(()=>[_(r(o.artwork_share_info.user.name),1)]),_:2},1032,["to"]),Go,s(i,{to:"/profile/"+o.artwork_share_info.user.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+r(o.artwork_share_info.user.username),1)]),_:2},1032,["to"]),Jo,s(i,{to:"/a/"+o.artwork_share_info.id,class:"hover:underline text-xxs"},{default:d(()=>[_(r(e.formatDate(o.artwork_share_info.scheduled_post?o.artwork_share_info.scheduled_post:o.artwork_share_info.created_at,!0)),1)]),_:2},1032,["to"])])])):u("",!0),t("div",Qo,[t("span",Xo,r(o.artwork_share_info.title),1),v(t("p",null,[t("span",{id:"feed-description-"+o.artwork_share_info.id},r(o.artwork_share_info.description.length>300?`${o.artwork_share_info.description.slice(0,300)}...`:o.artwork_share_info.description),9,Yo),o.artwork_share_info.description.length>300?(a(),c("a",{key:0,id:"feed-read-more-"+o.artwork_share_info.id,class:"href",onClick:M(l=>N(o.artwork_share_info.description,o.artwork_share_info.id,"feed-read-more-","feed-description-"),["prevent"])},r(e.$t("readMore")),9,Zo)):u("",!0)],512),[[w,o.artwork_share_info.description]])]),t("div",null,[e.isMobile()?u("",!0):(a(),c("div",{key:0,class:"p-2 cursor-pointer",onClick:M(l=>I(o.artwork_share_info.id),["prevent"])},[t("div",ee,[s(C,{class:$([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(a(),c("div",te,[t("div",null,r(e.$t("explicitContentAlert")),1),se])):u("",!0)])],8,oe)),e.isMobile()?(a(),S(i,{key:1,to:"/a/"+o.artwork_share_info.id,class:"cursor-pointer"},{default:d(()=>[s(C,{class:$(["p-2",{"blur-sm unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"])]),_:2},1032,["to"])):u("",!0)])])):u("",!0)])):u("",!0),t("div",ie,[mo(A).loggedIn?(a(),c("div",re,[t("span",{onClick:l=>o.type==="artwork"?h.value.includes("a-"+o.id)?T("a-"+o.id,o.type):D("a-"+o.id,o.type):h.value.includes("f-"+o.id)?T("f-"+o.id,o.type):D("f-"+o.id,o.type)},[v(s(k,{id:"feed-like-button-"+o.type+"-"+o.id,name:"i-ion-heart",class:"mr-1 text-red-500 hover:text-red-500"},null,8,["id"]),[[w,o.type==="artwork"?h.value.includes("a-"+o.id):h.value.includes("f-"+o.id)]]),v(s(k,{name:"i-ion-heart-outline",class:"mr-1 icon-color hover:text-red-500"},null,512),[[w,o.type==="artwork"?!h.value.includes("a-"+o.id):!h.value.includes("f-"+o.id)]]),_(" "+r(e.thousand(o._count.likes)),1)],8,ae),t("span",{onClick:M(l=>o.type==="artwork"?I(o.id):P(o.id),["prevent"])},[s(k,{name:"i-mdi-comment-multiple-outline",class:"mr-1 icon-color hover:text-blue-500"}),_(" "+r(e.thousand(o._count.comments)),1)],8,ne),o.type==="artwork"?(a(),c("span",{key:0,onClick:l=>J(o.id)},[v(s(k,{id:"save-to-collection-button-"+o.id,name:"i-ion-bookmark",class:"text-blue-500 hover:text-blue-500"},null,8,["id"]),[[w,g.value.includes(o.id)]]),v(s(k,{name:"i-majesticons-bookmark-line",class:"icon-color hover:text-blue-500"},null,512),[[w,!g.value.includes(o.id)]])],8,le)):u("",!0),t("div",ce,[t("button",de,[t("span",null,[s(k,{name:"i-uit-ellipsis-v",class:"align-middle icon icon-color"})])]),t("div",ue,[t("div",pe,[t("div",_e,[s(i,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,class:"flex py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[s(k,{name:"i-fluent-arrow-enter-20-filled",class:"mr-2 text-base"}),_(" "+r(e.$t("open")),1)]),_:2},1032,["to"]),s(i,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,target:"_blank",class:"flex z-20 py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[s(k,{name:"i-ci-external-link",class:"mr-2 text-base"}),_(" "+r(e.$t("openInNewTab")),1)]),_:2},1032,["to"]),me,t("a",{class:"flex py-2 px-3 w-full leading-4 rounded-md transition-all duration-150 cursor-pointer hover:button-color parent-icon hover:text-white",onClick:l=>q(o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id)},[s(k,{name:"i-icon-park-outline-copy",class:"mr-2 text-base"}),_(" "+r(e.$t("copySharableLink")),1)],8,he)])])])])])):u("",!0)])])])]))),128)),s(p),t("div",ke,[s(wo,{ref_key:"chronologicalModalViewRef",ref:E,section:"chronological"},null,512)]),t("div",ve,[s(Co,{ref_key:"chronologicalFeedModalViewRef",ref:B,section:"chronological-feed"},null,512)]),s(fo,{id:"feed-collection-selection-modal","modal-id":"feed-collection-selection-modal",ref_key:"collectionSelectionModalRef",ref:z,"work-id":b.value,class:"modal",onSave:Q},null,8,["work-id"])])])]),_:1},8,["hide-side"])],1024)}}},Re=U(we,[["__scopeId","data-v-d259f867"]]);export{Re as default};
//# sourceMappingURL=index.bc496bf2.js.map
