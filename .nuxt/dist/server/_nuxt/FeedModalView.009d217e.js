import{c as le,e as ne,u as ie,d as de,n as ue,i as Y,s as ce,_ as me}from"../server.mjs";import{resolveDirective as q,openBlock as a,createElementBlock as r,withDirectives as w,createElementVNode as s,createCommentVNode as d,Fragment as A,renderList as B,normalizeClass as M,toDisplayString as u,onMounted as ve,ref as g,computed as fe,createVNode as m,withCtx as _,createTextVNode as $,withModifiers as P,vShow as L,createBlock as we,unref as C,vModelText as ke,pushScopeId as pe,popScopeId as ge}from"vue";import"vue-router";import{u as he}from"./useFeed.e853e4d0.js";import{_ as J,a as S}from"./Icon.25764744.js";import{S as _e}from"./Spinner.cb811415.js";import{M as ye,_ as be}from"./ModalView.5655df94.js";const xe=["images"],Ee=["src"],$e=["images"],Le=["src"],Ce=["images"],Me=["src"],Ie=["images"],ze=["src"],Te={key:4,class:"imgrid"},Se=["src"],Ve={key:1,class:"relative text-center"},Ae={class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-3xl font-semibold text-white"},Be=["src"],De={__name:"ImageList",props:{work:{type:Object,default:()=>{}}},setup(l){const F={1:"col-start-1 row-start-1 col-span-4 row-span-4",2:["col-start-1 row-start-1 col-span-1 row-span-2","col-start-2 row-start-1 col-span-1 row-span-2"],3:["col-start-1 row-start-1 col-span-1 row-span-4","col-start-2 row-start-1 col-span-1 row-span-2","col-start-2 row-start-3 col-span-1 row-span-2"]};return(v,f)=>{const k=q("lazy");return a(),r("div",null,[l.work.artwork_assets.length===1?(a(),r("div",{key:0,images:[v.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]},[w(s("img",{src:v.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed"),class:"object-contain w-full rounded",style:{"max-height":"1000px"},loading:"lazy",onError:f[0]||(f[0]=(...c)=>v.imageLoadError&&v.imageLoadError(...c))},null,40,Ee),[[k,v.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]])],8,xe)):d("",!0),l.work.artwork_assets.length===2?(a(),r("div",{key:1,images:l.work.images,class:"imgrid"},[(a(!0),r(A,null,B(l.work.images,(c,h)=>w((a(),r("img",{key:c,class:M(F[2][h]),src:c,loading:"lazy",onError:f[1]||(f[1]=(...y)=>v.imageLoadError&&v.imageLoadError(...y))},null,42,Le)),[[k,c]])),128))],8,$e)):d("",!0),l.work.artwork_assets.length===3?(a(),r("div",{key:2,images:l.work.images,class:"imgrid"},[(a(!0),r(A,null,B(l.work.images,(c,h)=>w((a(),r("img",{key:c,class:M(F[3][h]),src:c,loading:"lazy",onError:f[2]||(f[2]=(...y)=>v.imageLoadError&&v.imageLoadError(...y))},null,42,Me)),[[k,c]])),128))],8,Ce)):d("",!0),l.work.artwork_assets.length===4?(a(),r("div",{key:3,images:l.work.images,class:"imgrid"},[(a(!0),r(A,null,B(l.work.images,c=>w((a(),r("img",{key:c,src:c,loading:"lazy",onError:f[3]||(f[3]=(...h)=>v.imageLoadError&&v.imageLoadError(...h))},null,40,ze)),[[k,c]])),128))],8,Ie)):d("",!0),l.work.artwork_assets.length>4?(a(),r("div",Te,[(a(!0),r(A,null,B(l.work.images,(c,h)=>(a(),r("div",{key:h},[h<3?w((a(),r("img",{key:0,src:c,loading:"lazy",onError:f[4]||(f[4]=(...y)=>v.imageLoadError&&v.imageLoadError(...y))},null,40,Se)),[[k,c]]):(a(),r("div",Ve,[s("span",Ae,"+"+u(l.work.artwork_assets.length-4),1),w(s("img",{src:c,class:"z-0 brightness-50",loading:"lazy",onError:f[5]||(f[5]=(...y)=>v.imageLoadError&&v.imageLoadError(...y))},null,40,Be),[[k,c]])]))]))),128))])):d("",!0)])}}},G=J(De,[["__scopeId","data-v-433644ba"]]),D=l=>(pe("data-v-024eba00"),l=l(),ge(),l),Fe={class:"flex flex-row justify-between mb-2 w-full"},je={key:0,class:"user-info"},Pe=["src"],Oe={class:"name"},Ue=D(()=>s("br",null,null,-1)),Ne=D(()=>s("span",{class:"mx-1"},"\xB7",-1)),Re={class:"text-xxs"},We={key:1,class:"flex float-right flex-row gap-2 mb-4 cursor-pointer"},He=["innerHTML"],Ye={key:0,class:"p-2 md:p-4 user-info"},Ge=["src"],qe={class:"name"},Je=D(()=>s("br",null,null,-1)),Ke=D(()=>s("span",{class:"mx-1"},"\xB7",-1)),Qe={class:"px-2 mt-2 md:px-4"},Xe={class:"text-xs font-semibold"},Ze=["id"],et=["id"],tt={key:2,class:"flex flex-row justify-between"},ot={key:0},st={key:1},at={key:2,class:"flex flex-row gap-x-2"},rt={class:"inline-block relative z-30 dropdown"},lt={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"headlessui-menu-items-feed-more-options"},nt={class:"invisible rounded-md opacity-0 transition-all duration-300 transform origin-top-right scale-95 -translate-y-2 dropdown-menu"},it={id:"headlessui-menu-items-feed-more-options",class:"absolute right-0 p-1 mt-2 w-56 rounded-md shadow-lg origin-top-right outline-none theme-color","aria-labelledby":"headlessui-menu-button-1",role:"menu"},dt=["to"],ut={class:"mt-6 mb-2"},ct={key:0,class:"comment-box"},mt={class:"flex flex-col"},vt={class:"flex relative flex-col"},ft=["readonly","rows","placeholder"],wt={key:1,class:"p-4 mb-4 text-center rounded-md theme-color-secondary"},kt=["src"],pt={class:"w-full"},gt={class:"flex justify-between"},ht={class:"comment-time"},_t={key:0,class:"hidden reactions"},yt=D(()=>s("div",{class:"flex flex-row"},null,-1)),bt=[yt],xt={key:1,class:"mt-4 w-full text-xs italic text-center"},Et={id:"chronological-modal",class:"modal work-view"},$t={__name:"FeedModalView",props:{id:{type:String,default:""},section:{type:String,default:""}},emits:["showEmpty","showError"],setup(l,{expose:F,emit:v}){const f=l,k=le(),c=ne();ie();const{oApiConfiguration:h,fetchOptions:y}=de(),I=he(h,y()),{generateArtworkThumb:K}=ue();ve(()=>{f.id!==""&&R(f.id),window.addEventListener("keydown",o=>{const t=document.getElementById("chronological-modal");o.key==="Escape"&&(!t||t.style.display!="flex")&&Y().closeModal(`${f.section}-modal`)})});const x=f.id==="",N=g(!0),e=g({}),z=g(!1),R=async o=>{N.value=!0,E.value=[],V.value.page=0;try{const[t,i]=await I.feedDetail({id:o});if(i)i=="Post not found"?v("showEmpty"):v("showError");else{if(t.feed.artworks){t.feed.artworks.images=[];for(let b=0;b<t.feed.artworks.artwork_assets.length;b++)if(b<=3){const n=await K(t.feed.artworks.artwork_assets[b].bucket,t.feed.artworks.artwork_assets[b].filename,"feed");t.feed.artworks.images.push(n)}}e.value=t.feed,z.value=t.feed.liked,await ee(o)}}catch{ce()}N.value=!1},W=g(null),Q=async o=>{W.value.view(o),Y().openModal("chronological-modal")},X=async()=>{const[o,t]=await I.like({feedId:e.value.id});if(o){z.value=!0,e.value._count.feed_likes++;const i=document.getElementById("feedLikeButton"+e.value.id);i.classList.add("animate-bounce"),setInterval(()=>{i.classList.remove("animate-bounce")},2500)}},Z=async()=>{const[o,t]=await I.unlike({feedId:e.value.id});o&&(z.value=!1,e.value._count.feed_likes--)},E=g([]),V=g({perPage:5,page:0}),O=g([]),H=async o=>{try{const[t,i]=await I.fetchComments({feedId:o,pagination:{page:V.value.page,perPage:V.value.perPage}});return t.pagination.current_page===t.pagination.first_last.last_page?j.value=!1:j.value=!0,t.comments.forEach(b=>{O.value.push(b.id)}),t.comments}catch{}},ee=async o=>{try{(await H(o)).forEach(i=>E.value.push(i))}catch{}},j=g(!1),te=async o=>{try{V.value.page+=1,(await H(o)).forEach(i=>E.value.push(i))}catch{}},p=g(),U=200,oe=fe(()=>p.value!=null&&p.value!==""?U-p.value.length:U),T=g(!1),se=async()=>{T.value=!0;try{const[o,t,i]=await I.comment({feedId:e.value.id,comment:p.value});o&&(p.value="",E.value.splice(0,0,t),E.value.join(),O.value.splice(0,0,t.id),O.value.join())}catch{}T.value=!1};g([]);const ae=async o=>{const[t,i]=await I.remove(o);t&&setTimeout(()=>{c.push({path:"/"})},1e3)};return F({view:R}),(o,t)=>{const i=me,b=q("auto-animate");return a(),r("div",{class:M(["z-40 work-container work-view",x?"w-full md:w-9/12 lg:w-2/5 mx-auto md:p-6 p-4 theme-color":"w-full"])},[s("div",{class:M(["w-full",{"overflow-y-scroll pr-4":x}])},[s("div",Fe,[e.value.users?(a(),r("div",je,[m(i,{to:"/profile/"+e.value.users.username},{default:_(()=>[s("img",{class:"avatar",src:o.avatarCoverUrl(e.value.users.avatar_bucket,e.value.users.avatar_filename),onError:t[0]||(t[0]=(...n)=>o.imageLoadError&&o.imageLoadError(...n))},null,40,Pe)]),_:1},8,["to"]),s("div",Oe,[m(i,{to:"/profile/"+e.value.users.username,class:"fullname"},{default:_(()=>[$(u(e.value.users.name),1)]),_:1},8,["to"]),Ue,m(i,{to:"/profile/"+e.value.users.username,class:"username"},{default:_(()=>[$(" @"+u(e.value.users.username),1)]),_:1},8,["to"]),Ne,s("span",Re,u(o.formatDate(e.value.created_at,!0)),1)])])):d("",!0),x?(a(),r("div",We,[s("div",{class:"modal-close",onClick:t[1]||(t[1]=n=>o.closeModal(l.section+"-modal"))},[m(S,{name:"i-ion-close",class:"text-2xl"})])])):d("",!0)]),e.value.text?(a(),r("div",{key:0,innerHTML:e.value.text,class:"p-4 mb-4 rounded-md theme-color"},null,8,He)):d("",!0),e.value.artworks?(a(),r("div",{key:1,class:M(["mb-4 w-full rounded-md",x?"theme-color-secondary":"theme-color"])},[e.value.artworks.users?(a(),r("div",Ye,[m(i,{to:"/profile/"+e.value.artworks.users.username},{default:_(()=>[s("img",{class:"avatar",src:o.avatarCoverUrl(e.value.artworks.users.avatar_bucket,e.value.artworks.users.avatar_filename),onError:t[2]||(t[2]=(...n)=>o.imageLoadError&&o.imageLoadError(...n))},null,40,Ge)]),_:1},8,["to"]),s("div",qe,[m(i,{to:"/profile/"+e.value.artworks.users.username,class:"fullname hover:href"},{default:_(()=>[$(u(e.value.artworks.users.name),1)]),_:1},8,["to"]),Je,m(i,{to:"/profile/"+e.value.artworks.users.username,class:"hover:underline text-xxs"},{default:_(()=>[$(" @"+u(e.value.artworks.users.username),1)]),_:1},8,["to"]),Ke,m(i,{to:"/a/"+e.value.artworks.id,class:"hover:underline text-xxs"},{default:_(()=>[$(u(o.formatDate(e.value.artworks.scheduled_post?e.value.artworks.scheduled_post:e.value.artworks.created_at,!0)),1)]),_:1},8,["to"])])])):d("",!0),s("div",Qe,[s("span",Xe,u(e.value.artworks.title),1),w(s("p",null,[s("span",{id:"feed-description-"+e.value.artworks.id},u(e.value.artworks.description.length>300?`${e.value.artworks.description.slice(0,300)}...`:e.value.artworks.description),9,Ze),e.value.artworks.description.length>300?(a(),r("a",{key:0,id:"feed-read-more-"+e.value.artworks.id,class:"href",onClick:t[3]||(t[3]=P(n=>o.readMore(e.value.artworks.description,e.value.artworks.id,"feed-read-more-","feed-description-"),["prevent"]))},u(o.$t("readMore")),9,et)):d("",!0)],512),[[L,e.value.artworks.description]])]),s("div",null,[e.value.artworks&&o.isMobile()?(a(),we(i,{key:0,to:"/a/"+e.value.id,class:"cursor-pointer"},{default:_(()=>[m(G,{class:"p-2",work:e.value.artworks},null,8,["work"])]),_:1},8,["to"])):d("",!0),e.value.artworks&&!o.isMobile()?(a(),r("div",{key:1,class:"cursor-pointer",onClick:t[4]||(t[4]=P(n=>Q(e.value.artworks.id),["prevent"]))},[m(G,{class:"p-2 md:p-4",work:e.value.artworks},null,8,["work"])])):d("",!0)])],2)):d("",!0),e.value._count?(a(),r("div",tt,[e.value._count.feed_comments?(a(),r("div",ot,[s("b",null,u(o.thousand(e.value._count.feed_comments)),1),$(" "+u(e.value._count.feed_comments>1?o.$t("count.comments"):o.$t("count.comment")),1)])):d("",!0),e.value._count.feed_comments?d("",!0):(a(),r("div",st)),C(k).loggedIn?(a(),r("div",at,[s("div",{class:"flex flex-row",onClick:t[5]||(t[5]=n=>z.value?Z():X())},[w(m(S,{id:"feedLikeButton"+e.value.id,name:"i-ion-heart",class:"mr-2 text-xl text-red-500 cursor-pointer hover:text-red-500"},null,8,["id"]),[[L,z.value]]),w(m(S,{name:"i-ion-heart-outline",class:"mr-2 text-xl cursor-pointer hover:text-red-500"},null,512),[[L,!z.value]]),s("span",null,u(o.thousand(e.value._count.feed_likes)),1)]),s("div",rt,[s("button",lt,[s("span",null,[m(S,{name:"i-ion-ellipsis-vertical-outline",class:"align-middle icon icon-color"})])]),s("div",nt,[s("div",it,[C(k).loggedIn&&e.value.user_id&&C(k).user.id===e.value.user_id?(a(),r("div",{key:0,to:"/feed/"+e.value.id,class:"flex z-50 py-2 px-3 w-full rounded-md transition-all duration-150 cursor-pointer bg-danger hover:button-color parent-icon hover:text-white",onClick:t[6]||(t[6]=n=>o.openModal("feed-deletion-confirm-modal"))},[m(S,{name:"i-ion-trash-outline",class:"mr-2 text-base"}),$(" "+u(o.$t("delete")),1)],8,dt)):d("",!0)])])])])):d("",!0)])):d("",!0),s("div",ut,[C(k).loggedIn?(a(),r("div",ct,[s("div",mt,[s("div",vt,[w(s("textarea",{"onUpdate:modelValue":t[7]||(t[7]=n=>p.value=n),class:M(["input form-input",[{"cursor-not-allowed":T.value},{"theme-color-secondary textarea":x}]]),readonly:T.value,cols:"20",rows:p.value!=null&&p.value!=""?"6":"0",placeholder:o.$t("comments.inputPlaceholder"),maxlength:U,"data-gramm":"false"},null,10,ft),[[ke,p.value]]),w(s("span",{class:"absolute left-4 bottom-6 py-1 px-2 text-white rounded-md button-color"},u(C(oe)),513),[[L,p.value!=null&&p.value!=""]]),s("span",{class:"absolute right-2 bottom-5 py-1 px-2",onClick:t[8]||(t[8]=P(n=>se(),["prevent"]))},[w(m(S,{name:"i-ion-prism",class:"text-xl transition-all duration-100 rotate-90 cursor-pointer text-colored"},null,512),[[L,p.value!=null&&p.value!=""&&!T.value]]),w(m(_e,null,null,512),[[L,T.value]])])])])])):d("",!0),C(k).loggedIn?d("",!0):(a(),r("div",wt,u(o.$t("comments.loginOrRegisterToLeaveComment")),1))]),s("div",{class:M(["comment-content",[{"pr-3 overflow-x-hidden":x},{"mb-20":!x}]])},[(a(!0),r(A,null,B(E.value,n=>w((a(),r("div",{key:n.id,class:"flex flex-row w-full comment-item"},[m(i,{class:"mr-2",to:"/profile/"+n.users.username},{default:_(()=>[s("img",{class:"w-10 h-10 avatar",src:o.avatarCoverUrl(n.users.avatar_bucket,n.users.avatar_filename),onError:t[9]||(t[9]=(...re)=>o.imageLoadError&&o.imageLoadError(...re))},null,40,kt)]),_:2},1032,["to"]),s("div",pt,[s("div",{class:M(["p-4 w-full rounded-md",x?"theme-color-secondary":"theme-color"])},[s("div",gt,[m(i,{to:"/profile/"+n.users.username,class:"mb-2 text-xs font-medium transition-all duration-150 cursor-pointer hover:font-bold"},{default:_(()=>[$(u(n.users.name),1)]),_:2},1032,["to"]),s("div",ht,u(o.formatDate(n.created_at,!0)),1)]),s("div",null,u(n.comment),1),C(k).loggedIn?(a(),r("div",_t,bt)):d("",!0)],2)])])),[[b]])),128)),e.value._count?w((a(),r("div",{key:0,class:"text-center capitalize href",onClick:t[10]||(t[10]=P(n=>te(e.value.id),["prevent"]))},u(o.$t("comments.loadOlder")),513)),[[L,e.value._count.feed_comments>V.value.perPage&&j.value]]):d("",!0),w(s("div",{class:"w-full text-xs italic text-center"},u(o.$t("comments.reachedTheEnd")),513),[[L,E.value.length&&!j.value]]),C(k).loggedIn&&!E.value.length?(a(),r("div",xt,u(o.$t("comments.noCommentYet")),1)):d("",!0)],2)],2),s("div",Et,[m(ye,{ref_key:"sharedWorkModalViewRef",ref:W,section:"chronological"},null,512)]),m(be,{id:"feed-deletion-confirm-modal","modal-id":"feed-deletion-confirm-modal",message:`${o.$t("alert.areYouSure")} ${o.$t("alert.youCannotUndoThisAction")}`,class:"modal",onOnAccept:t[11]||(t[11]=n=>ae(e.value.id))},null,8,["message"])],2)}}},Vt=J($t,[["__scopeId","data-v-024eba00"]]);export{Vt as F,G as I};
//# sourceMappingURL=FeedModalView.009d217e.js.map
