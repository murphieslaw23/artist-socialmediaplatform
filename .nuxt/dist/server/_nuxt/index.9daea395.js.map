{"version":3,"file":"index.9daea395.js","sources":["../../../../pages/works/following/index.vue"],"sourcesContent":["<template>\r\n  <Layout \r\n    :with-footer=\"true\" \r\n    :hide-side=\"true\"\r\n    :no-right-side=\"true\"\r\n  >\r\n    <div id=\"lists\">\r\n      <!-- Top navigations -->\r\n      <div class=\"navigations\">\r\n        <div class=\"title\">\r\n          {{ $t('following') }}\r\n        </div>\r\n\r\n        <!-- Options -->\r\n        <div class=\"buttons\">\r\n          <!-- Filter explicit content -->\r\n          <div \r\n            v-if=\"auth.loggedIn && auth.user.user_settings.show_explicit\" \r\n            class=\"filter-buttons\"\r\n          >\r\n            <p \r\n              class=\"rounded-l-md button-item\" \r\n              :class=\"[explicitMode === undefined ? 'button' : 'theme-color']\"\r\n              @click=\"changeExplicitMode(undefined)\"\r\n            >\r\n              {{ $t('default') }}\r\n            </p>\r\n\r\n            <p \r\n              class=\"button-item\" \r\n              :class=\"[explicitMode === 'safe' ? 'button' : 'theme-color']\"\r\n              @click=\"changeExplicitMode('safe')\"\r\n            >\r\n              {{ $t('safe') }}\r\n            </p>\r\n            \r\n            <p \r\n              class=\"rounded-r-md button-item\" \r\n              :class=\"[explicitMode === 'explicit' ? 'button' : 'theme-color']\"\r\n              @click=\"changeExplicitMode('explicit')\"\r\n            >\r\n              {{ $t('explicit') }}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- On loading, empty or error occured -->\r\n      <LoadingEmptyErrorMessage\r\n        :loading=\"loading\"\r\n        :empty=\"isEmpty\"\r\n        :error=\"isError\"\r\n        :fetch=\"fetchTop\"\r\n      />\r\n\r\n      <!-- List area -->\r\n      <div v-show=\"!loading\" class=\"mt-4\">\r\n        <WorkList \r\n          v-show=\"!isEmpty\"\r\n          :section-class=\"'work-grid'\"\r\n          :works=\"works\"\r\n          :view=\"view\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Paging control -->\r\n      <div v-if=\"!loading && !isEmpty && !isError\" class=\"art-list-view-paging-control\">\r\n        <button \r\n          :class=\"[\r\n            config.pagination.enablePrev ? 'primary-button' : 'disabled-button'\r\n          ]\"\r\n          @click=\"movePage('prev')\"\r\n        >\r\n          <Icon :name=\"'i-ion-chevron-back-outline'\" />\r\n          {{ $t('pagination.previous') }}\r\n        </button>\r\n        <button \r\n          :class=\"[\r\n            config.pagination.enableNext ? 'primary-button' : 'disabled-button'\r\n          ]\"\r\n          @click=\"movePage('next')\"\r\n        >\r\n          {{ $t('pagination.next') }}\r\n          <Icon \r\n            :name=\"'i-ion-chevron-forward-outline'\" \r\n            class=\"md:ml-2\"\r\n            style=\"margin-right: 0 !important\" \r\n          />\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Modal view (artwork detail) -->\r\n      <div \r\n        id=\"recent-modal\"\r\n        class=\"modal work-view\" \r\n      >\r\n        <ModalView \r\n          v-show=\"!loading\"\r\n          ref=\"recentModalViewRef\"\r\n          section=\"recent\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </Layout>\r\n</template>\r\n\r\n<script setup>\r\n// stores\r\nimport useAuthStore from '@/stores/auth.store'\r\n\r\n// components\r\nimport Icon from '~/components/globals/Icon.vue'\r\nimport Layout from '~/components/layouts/Layout.vue'\r\nimport WorkList from '~/components/artworks/WorkList.vue'\r\nimport ModalView from '~/components/artworks/views/ModalView.vue'\r\nimport LoadingEmptyErrorMessage from '~/components/globals/LoadingEmptyErrorMessage.vue'\r\n\r\n/**\r\n * @meta\r\n */\r\ndefinePageMeta ({\r\n  // keepalive: true\r\n})\r\n\r\n// stores\r\nconst auth = useAuthStore()\r\n\r\n// composables\r\nconst { oApiConfiguration, fetchOptions } = useApiFetch()\r\nconst artworkApi = useArtwork(oApiConfiguration, fetchOptions())\r\n\r\nconst { $router } = useNuxtApp()\r\n\r\n/** Before mount, fetch first rows */\r\nonBeforeMount (() => {\r\n  if (!auth.loggedIn) {\r\n    $router.push('/')\r\n  }\r\n\r\n  fetchTop()\r\n})\r\n\r\n// Change epxlicit mode for authenticated user and user who activate explicit content\r\nconst explicitMode = ref(undefined)\r\nconst changeExplicitMode = async (mode) => {\r\n  explicitMode.value = mode\r\n  pagination.page = 0\r\n\r\n  await fetchTop()\r\n}\r\n\r\n/** Fetch first row */\r\nconst works = ref([])\r\nconst config = ref({\r\n  pagination: {\r\n    enablePrev: true,\r\n    enableNext: true\r\n  }\r\n})\r\nconst fetchTop = async () => {\r\n  const data = await fetch()\r\n\r\n  const dataWorks = data.works\r\n  const dataPagination = data.pagination\r\n\r\n  // handle empty data\r\n  if (!dataWorks.length && dataPagination.record_total === 0) {\r\n    showEmpty()\r\n  } else {\r\n    works.value = dataWorks\r\n  \r\n    if (dataPagination.next_previous.next_page === null) {\r\n      config.value.pagination.enableNext = false\r\n    } else {\r\n      config.value.pagination.enableNext = true\r\n    }\r\n\r\n    if (dataPagination.next_previous.prev_page === null) {\r\n      config.value.pagination.enablePrev = false\r\n    } else {\r\n      config.value.pagination.enablePrev = true\r\n    }\r\n  }\r\n}\r\n\r\n/** Fetch */\r\nconst loading = ref(true)\r\nconst pagination = reactive({\r\n  perPage: 18,\r\n  page: ref(0)\r\n})\r\nconst fetch = async () => {\r\n  if (pagination.page === 0) {\r\n    loading.value = true\r\n  }\r\n\r\n  const [data, error] = await artworkApi.getFollowing({\r\n    pagination: {\r\n      perPage: pagination.perPage,\r\n      page: pagination.page\r\n    },\r\n    explicitMode: explicitMode.value\r\n  })\r\n\r\n  if (error) {\r\n    showError()\r\n  } else {\r\n    reset()\r\n    return data\r\n  }\r\n}\r\n\r\n// Control pagination and fetch\r\nconst movePage = async (mode) => {\r\n  if (mode === 'prev') {\r\n    pagination.page -= 1\r\n  } else {\r\n    pagination.page += 1\r\n  }\r\n\r\n  await fetchTop()\r\n}\r\n\r\n/** Show empty if there's no artwork to show */\r\nconst isEmpty = ref(false)\r\nconst showEmpty = () => {\r\n  isEmpty.value = true\r\n}\r\n\r\n/** Show error message when error occured while trying to fetch artworks */\r\nconst isError = ref(false)\r\nconst showError = () => {\r\n  loading.value = false\r\n  isError.value = true\r\n  hideButton()\r\n}\r\n\r\n/** Reset refs */\r\nconst reset = () => {\r\n  loading.value = false\r\n  isEmpty.value = false\r\n  isError.value = false\r\n}\r\n\r\n/** Artwork viewer, open a modal */\r\nconst recentModalViewRef = ref(null)\r\nconst view = (workId, keepArtistPageNumber = false) => {\r\n  recentModalViewRef.value.view(workId, keepArtistPageNumber)\r\n\r\n  useModal().openModal('recent-modal')\r\n}\r\n\r\n// const closeModal = (modalId) => {\r\n//   useModal().closeModal(modalId)\r\n// }\r\n// onClickOutside(recentModalViewRef, () => closeModal('recent-modal'))\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '~/assets/css/tailwind.scss';\r\n@import '~/assets/css/artworks/list.scss';\r\n</style>\r\n"],"names":["auth","useAuthStore","oApiConfiguration","fetchOptions","useApiFetch","artworkApi","useArtwork","$router","useNuxtApp","onBeforeMount","fetchTop","explicitMode","ref","changeExplicitMode","mode","pagination","works","config","data","fetch","dataWorks","dataPagination","showEmpty","loading","reactive","error","showError","reset","movePage","isEmpty","isError","recentModalViewRef","view","workId","keepArtistPageNumber","useModal"],"mappings":"+7BA6HA,MAAAA,EAAAC,EAAA,EAGA,CAAA,kBAAAC,EAAA,aAAAC,CAAA,EAAAC,EAAA,EACAC,EAAAC,EAAAJ,EAAAC,GAAA,EAEA,CAAA,QAAAI,CAAA,EAAAC,EAAA,EAGAC,EAAA,IAAA,CACAT,EAAA,UACAO,EAAA,KAAA,GAAA,EAGAG,EAAA,CACA,CAAA,EAGA,MAAAC,EAAAC,EAAA,MAAA,EACAC,EAAA,MAAAC,GAAA,CACAH,EAAA,MAAAG,EACAC,EAAA,KAAA,EAEA,MAAAL,EAAA,CACA,EAGAM,EAAAJ,EAAA,EAAA,EACAK,EAAAL,EAAA,CACA,WAAA,CACA,WAAA,GACA,WAAA,EACA,CACA,CAAA,EACAF,EAAA,SAAA,CACA,MAAAQ,EAAA,MAAAC,EAAA,EAEAC,EAAAF,EAAA,MACAG,EAAAH,EAAA,WAGA,CAAAE,EAAA,QAAAC,EAAA,eAAA,EACAC,EAAA,GAEAN,EAAA,MAAAI,EAEAC,EAAA,cAAA,YAAA,KACAJ,EAAA,MAAA,WAAA,WAAA,GAEAA,EAAA,MAAA,WAAA,WAAA,GAGAI,EAAA,cAAA,YAAA,KACAJ,EAAA,MAAA,WAAA,WAAA,GAEAA,EAAA,MAAA,WAAA,WAAA,GAGA,EAGAM,EAAAX,EAAA,EAAA,EACAG,EAAAS,EAAA,CACA,QAAA,GACA,KAAAZ,EAAA,CAAA,CACA,CAAA,EACAO,EAAA,SAAA,CACAJ,EAAA,OAAA,IACAQ,EAAA,MAAA,IAGA,KAAA,CAAAL,EAAAO,CAAA,EAAA,MAAApB,EAAA,aAAA,CACA,WAAA,CACA,QAAAU,EAAA,QACA,KAAAA,EAAA,IACA,EACA,aAAAJ,EAAA,KACA,CAAA,EAEA,GAAAc,EACAC,EAAA,MAEA,QAAAC,EAAA,EACAT,CAEA,EAGAU,EAAA,MAAAd,GAAA,CACAA,IAAA,OACAC,EAAA,MAAA,EAEAA,EAAA,MAAA,EAGA,MAAAL,EAAA,CACA,EAGAmB,EAAAjB,EAAA,EAAA,EACAU,EAAA,IAAA,CACAO,EAAA,MAAA,EACA,EAGAC,EAAAlB,EAAA,EAAA,EACAc,EAAA,IAAA,CACAH,EAAA,MAAA,GACAO,EAAA,MAAA,GACA,WAAA,CACA,EAGAH,EAAA,IAAA,CACAJ,EAAA,MAAA,GACAM,EAAA,MAAA,GACAC,EAAA,MAAA,EACA,EAGAC,EAAAnB,EAAA,IAAA,EACAoB,EAAA,CAAAC,EAAAC,EAAA,KAAA,CACAH,EAAA,MAAA,KAAAE,EAAAC,CAAA,EAEAC,EAAA,EAAA,UAAA,cAAA,CACA"}