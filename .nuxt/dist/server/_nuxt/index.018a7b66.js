import{c as oo,x as eo,d as to,C as io,j as so,e as lo,k as ro,u as no,i as k,_ as ao,l as co}from"../server.mjs";import{_ as G,u as uo,a as v}from"./Icon.87522030.js";import{a as po}from"./useFeed.b8b7dd2b.js";import{u as _o}from"./useI18n.8f77c822.js";import{openBlock as r,createElementBlock as a,onBeforeMount as mo,onMounted as ho,watch as ko,ref as m,createBlock as R,KeepAlive as vo,createVNode as i,withCtx as d,withDirectives as w,vShow as x,createElementVNode as t,Fragment as wo,renderList as xo,createTextVNode as _,toDisplayString as l,createCommentVNode as c,withModifiers as y,normalizeClass as g,unref as T,pushScopeId as yo,popScopeId as fo}from"vue";import{S as go,M as bo,a as Mo,u as Co,b as $o,c as Io,d as So}from"./ModalView.fc4ee83d.js";import{L as Lo}from"./Layout.2ddecdfc.js";import{I as L,F as Ao}from"./FeedModalView.7fc0d1ba.js";import"#internal/nitro";import"vue-router";import"./LoadingEmptyErrorMessage.4c6a7625.js";import"./Spinner.1b9fad4a.js";import"./user-counters-api.b01a31ff.js";const Fo={};function Ro(b,M){return r(),a("div")}const To=G(Fo,[["render",Ro]]);const I=b=>(yo("data-v-4d440be6"),b=b(),fo(),b),Vo={class:"mx-auto w-full"},Eo={class:"grid grid-cols-1 gap-1 mx-auto md:gap-2 xl:w-10/12"},Bo={class:"flex flex-row rounded-md theme-color"},Ho={class:"w-full"},No={key:0,class:"p-2 md:p-4 user-info"},Oo=["src"],Do={class:"name"},zo=I(()=>t("br",null,null,-1)),Uo=I(()=>t("span",{class:"mx-1"},"\xB7",-1)),jo={key:1,class:"px-2 mt-2 md:px-4"},Go={class:"text-xs font-semibold"},qo=["id","innerHTML"],Ko=["id","onClick"],Po=["onClick"],Wo={key:2,class:"px-2 md:px-4"},Jo=["innerHTML","id"],Qo=["id","onClick"],Xo={key:1,class:"my-2 w-full rounded-md theme-color-secondary"},Yo={key:0,class:"p-2 md:p-4 user-info"},Zo=["src"],oe={class:"name"},ee=I(()=>t("br",null,null,-1)),te=I(()=>t("span",{class:"mx-1"},"\xB7",-1)),ie={class:"px-2 mt-2 md:px-4"},se={class:"text-xs font-semibold"},le=["id","innerHTML"],re=["id","onClick"],ne=["onClick"],ae={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},ce={class:"mx-auto mt-2 primary-button"},de={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},ue={class:"mx-auto mt-2 primary-button"},pe={class:"float-right mx-4 mt-2 interactions"},_e={key:0,class:"reactions"},me=["onClick"],he=["onClick"],ke=["onClick"],ve={class:"option dropdown"},we={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"option-dropdown-items"},xe={class:"option-dropdown dropdown-menu"},ye={id:"option-dropdown-items",class:"w-52 toggler","aria-labelledby":"option-dropdown-buttons",role:"menu"},fe={class:"menu-wrapper"},ge=I(()=>t("div",{class:"custom-divider"},null,-1)),be=["onClick"],Me={id:"chronological-modal",class:"modal work-view"},Ce={id:"chronological-feed-modal",class:"z-30 modal work-view"},$e={__name:"index",props:{changeMode:{type:Function,default:()=>{}}},setup(b){const M=oo();eo();const{oApiConfiguration:V,fetchOptions:E}=to(),B=uo(V,E()),H=po(V,E());io({title:_o().tl("meta.title.feed.feed")});const q=so(),K=lo(),P=ro();no(),mo(()=>{M.loggedIn||K.push({path:"/explore"})}),ho(()=>{}),ko(()=>P.query,()=>{X(),k().closeModal("feed-collection-selection-modal"),k().closeModal("collection-selection-modal"),k().closeModal("album-selection-modal"),k().closeModal("report-modal")}),m({explicitMode:void 0,pagination:{page:0,perPage:10}});const N=m([]),O=m(null),S=(e,n,s)=>{n?N.value[s].apply_explicit_filter=!1:(O.value.view(e),k().openModal("chronological-modal"))},D=m(null),W=e=>{D.value.view(e),k().openModal("chronological-feed-modal")},A=(e,n,s,p)=>{Co().readMore(e,n,s,p)},z=m(!1);let J;const Q=e=>{const n=m(q.public.appUrl+e),{copy:s}=$o({source:n});s(),Io().splash(J,z,"copy-alert")},C=m([]),h=m([]),U=async(e,n)=>{const s=parseInt(e.split("-")[1]);let p=!1;if(n==="artwork"){const[o,f]=await B.like({workId:s});p=o}else if(n==="feed"){const[o,f]=await H.like({feedId:s});p=o}if(p){h.value.push(e);const o=document.getElementById(`feed-like-button-${n}-${s}`);o.classList.add("animate-bounce"),setInterval(()=>{o.classList.remove("animate-bounce")},2500)}},j=async(e,n)=>{const s=parseInt(e.split("-")[1]);let p=!1;if(n==="artwork"){const[o,f]=await B.unlike({workId:s});p=o}else if(n==="feed"){const[o,f]=await H.unlike({feedId:s});p=o}if(p){const o=h.value.indexOf(e);h.value.splice(o,1)}},X=()=>{k().closeModal("chronological-modal"),k().closeModal("chronological-feed-modal")},F=m(null),$=m(0),Y=e=>{$.value=e,k().openModal("feed-collection-selection-modal"),F.value.fetchCollection(),F.value.fetchCurrentSaved()},Z=e=>{if(e){const n=C.value.indexOf($.value);C.value.splice(n,1)}else C.value.push($.value);So().animate("save-to-collection-button-"+$.value)};return(e,n)=>{const s=ao,p=co;return r(),R(vo,null,[i(Lo,{"with-footer":!0,"hide-side":e.isMobile()},{"right-side":d(()=>[i(To)]),default:d(()=>[w(i(go,{id:"copy-alert",text:e.$t("linkCopied"),icon:"i-bi-check-all"},null,8,["text"]),[[x,z.value]]),t("div",Vo,[t("div",Eo,[(r(!0),a(wo,null,xo(N.value,(o,f)=>(r(),a("div",{key:o.id+o.type,class:"rounded-md lg:mx-6"},[t("div",Bo,[t("div",Ho,[o.users?(r(),a("div",No,[i(s,{to:"/profile/"+o.users.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.users.avatar_bucket,o.users.avatar_filename),onError:n[0]||(n[0]=(...u)=>e.imageLoadError&&e.imageLoadError(...u))},null,40,Oo)]),_:2},1032,["to"]),t("div",Do,[i(s,{to:"/profile/"+o.users.username,class:"fullname hover:href"},{default:d(()=>[_(l(o.users.name),1)]),_:2},1032,["to"]),zo,i(s,{to:"/profile/"+o.users.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+l(o.users.username),1)]),_:2},1032,["to"]),Uo,i(s,{to:(o.type==="artwork"?"/a/":"/feed/")+o.id,class:"hover:underline text-xxs"},{default:d(()=>[_(l(e.formatDate(o.scheduled_post?o.scheduled_post:o.created_at,!0)),1)]),_:2},1032,["to"])])])):c("",!0),o.type==="artwork"?(r(),a("div",jo,[t("span",Go,l(o.title),1),w(t("p",null,[t("span",{id:"feed-description-"+o.id,innerHTML:o.description.length>300?`${o.description.slice(0,300)}...`:o.description},null,8,qo),o.description.length>300?(r(),a("a",{key:0,id:"feed-read-more-"+o.id,class:"href",onClick:y(u=>A(o.description,o.id,"feed-read-more-","feed-description-"),["prevent"])},l(e.$t("readMore")),9,Ko)):c("",!0)],512),[[x,o.description]])])):c("",!0),t("div",null,[t("div",null,[o.type==="artwork"&&!e.isMobile()?(r(),a("div",{key:0,class:"cursor-pointer",onClick:y(u=>S(o.id),["prevent"])},[i(L,{class:"p-2 md:p-4",work:o},null,8,["work"])],8,Po)):c("",!0),o.type==="artwork"&&e.isMobile()?(r(),R(s,{key:1,to:"/a/"+o.id,class:"cursor-pointer"},{default:d(()=>[i(L,{class:"p-2",work:o},null,8,["work"])]),_:2},1032,["to"])):c("",!0)])]),o.type==="feed"?(r(),a("div",Wo,[w(t("p",{innerHTML:o.text.split("<br>").length>3&&o.text.length>300?`${o.text.slice(0,300)}...`:o.text,id:"feed-text-"+o.id,class:g(["mt-2",{"mb-2":!o.artwork_share_info}])},null,10,Jo),[[x,o.text]]),o.text.split("<br>").length>3&&o.text.length>300?(r(),a("a",{key:0,id:"feed-read-more-"+o.id,class:"href",onClick:y(u=>A(o.text,o.id,"feed-read-more-","feed-text-"),["prevent"])},l(e.$t("readMore")),9,Qo)):c("",!0),o.artwork_share_info?(r(),a("div",Xo,[o.artwork_share_info.user?(r(),a("div",Yo,[i(s,{to:"/profile/"+o.artwork_share_info.user.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.artwork_share_info.user.avatar_bucket,o.artwork_share_info.user.avatar_filename),onError:n[1]||(n[1]=(...u)=>e.imageLoadError&&e.imageLoadError(...u))},null,40,Zo)]),_:2},1032,["to"]),t("div",oe,[i(s,{to:"/profile/"+o.artwork_share_info.user.username,class:"fullname hover:href"},{default:d(()=>[_(l(o.artwork_share_info.user.name),1)]),_:2},1032,["to"]),ee,i(s,{to:"/profile/"+o.artwork_share_info.user.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+l(o.artwork_share_info.user.username),1)]),_:2},1032,["to"]),te,i(s,{to:"/a/"+o.artwork_share_info.id,class:"hover:underline text-xxs"},{default:d(()=>[_(l(e.formatDate(o.artwork_share_info.scheduled_post?o.artwork_share_info.scheduled_post:o.artwork_share_info.created_at,!0)),1)]),_:2},1032,["to"])])])):c("",!0),t("div",ie,[t("span",se,l(o.artwork_share_info.title),1),w(t("p",null,[t("span",{id:"feed-description-"+o.artwork_share_info.id,innerHTML:o.artwork_share_info.description.length>300?`${o.artwork_share_info.description.slice(0,300)}...`:o.artwork_share_info.description},null,8,le),o.artwork_share_info.description.length>300?(r(),a("a",{key:0,id:"feed-read-more-"+o.artwork_share_info.id,class:"href",onClick:y(u=>A(o.artwork_share_info.description,o.artwork_share_info.id,"feed-read-more-","feed-description-"),["prevent"])},l(e.$t("readMore")),9,re)):c("",!0)],512),[[x,o.artwork_share_info.description]])]),t("div",null,[e.isMobile()?c("",!0):(r(),a("div",{key:0,class:g(["p-2",{"cursor-pointer":!o.apply_explicit_filter}]),onClick:y(u=>S(o.artwork_share_info.id,o.apply_explicit_filter,f),["prevent"])},[t("div",{class:g(["overflow-hidden relative p-2 rounded-md",{"md:mx-2":o.apply_explicit_filter}])},[i(L,{class:g([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(r(),a("div",ae,[t("div",null,l(T(M).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",ce,l(e.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)],10,ne)),e.isMobile()?(r(),R(s,{key:1,to:o.apply_explicit_filter?null:"/a/"+o.artwork_share_info.id,onClick:y(u=>S(o.artwork_share_info.id,o.apply_explicit_filter,f),["prevent"]),class:"cursor-pointer"},{default:d(()=>[t("div",{class:g(["overflow-hidden relative p-2 rounded-md",{"m-2":o.apply_explicit_filter}])},[i(L,{class:g([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(r(),a("div",de,[t("div",null,l(T(M).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",ue,l(e.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)]),_:2},1032,["to","onClick"])):c("",!0)])])):c("",!0)])):c("",!0),t("div",pe,[T(M).loggedIn?(r(),a("div",_e,[t("span",{onClick:u=>o.type==="artwork"?h.value.includes("a-"+o.id)?j("a-"+o.id,o.type):U("a-"+o.id,o.type):h.value.includes("f-"+o.id)?j("f-"+o.id,o.type):U("f-"+o.id,o.type)},[w(i(v,{id:"feed-like-button-"+o.type+"-"+o.id,name:"i-ion-heart",class:"mr-1 text-red-500 hover:text-red-500"},null,8,["id"]),[[x,o.type==="artwork"?h.value.includes("a-"+o.id):h.value.includes("f-"+o.id)]]),w(i(v,{name:"i-ri-heart-3-line",class:"mr-1 icon-color hover:text-red-500"},null,512),[[x,o.type==="artwork"?!h.value.includes("a-"+o.id):!h.value.includes("f-"+o.id)]]),_(" "+l(e.thousand(o._count.likes)),1)],8,me),t("span",{onClick:y(u=>o.type==="artwork"?S(o.id):W(o.id),["prevent"])},[i(v,{name:"i-mdi-comment-multiple-outline",class:"mr-1 icon-color hover:text-blue-500"}),_(" "+l(e.thousand(o._count.comments)),1)],8,he),o.type==="artwork"?(r(),a("span",{key:0,onClick:u=>Y(o.id)},[w(i(v,{id:"save-to-collection-button-"+o.id,name:"i-ion-bookmark",class:"text-blue-500 hover:text-blue-500"},null,8,["id"]),[[x,C.value.includes(o.id)]]),w(i(v,{name:"i-majesticons-bookmark-line",class:"icon-color hover:text-blue-500"},null,512),[[x,!C.value.includes(o.id)]])],8,ke)):c("",!0),t("div",ve,[t("button",we,[t("span",null,[i(v,{name:"i-uit-ellipsis-v",class:"align-middle icon icon-color"})])]),t("div",xe,[t("div",ye,[t("div",fe,[i(s,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,class:"flex py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[i(v,{name:"i-fluent-arrow-enter-20-filled",class:"mr-2 text-base"}),_(" "+l(e.$t("open")),1)]),_:2},1032,["to"]),i(s,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,target:"_blank",class:"flex z-20 py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[i(v,{name:"i-ci-external-link",class:"mr-2 text-base"}),_(" "+l(e.$t("openInNewTab")),1)]),_:2},1032,["to"]),ge,t("a",{class:"flex py-2 px-3 w-full leading-4 rounded-md transition-all duration-150 cursor-pointer hover:button-color parent-icon hover:text-white",onClick:u=>Q(o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id)},[i(v,{name:"i-icon-park-outline-copy",class:"mr-2 text-base"}),_(" "+l(e.$t("copySharableLink")),1)],8,be)])])])])])):c("",!0)])])])]))),128)),i(p),t("div",Me,[i(bo,{ref_key:"chronologicalModalViewRef",ref:O,section:"chronological"},null,512)]),t("div",Ce,[i(Ao,{ref_key:"chronologicalFeedModalViewRef",ref:D,section:"chronological-feed"},null,512)]),i(Mo,{id:"feed-collection-selection-modal","modal-id":"feed-collection-selection-modal",ref_key:"collectionSelectionModalRef",ref:F,"work-id":$.value,class:"modal",onSave:Z},null,8,["work-id"])])])]),_:1},8,["hide-side"])],1024)}}},De=G($e,[["__scopeId","data-v-4d440be6"]]);export{De as default};
//# sourceMappingURL=index.018a7b66.js.map
