{"version":3,"file":"index.79d3c31a.js","sources":["../../../../pages/works/recent/index.vue"],"sourcesContent":["<template>\r\n  <Layout \r\n    :with-footer=\"true\" \r\n    :hide-side=\"true\"\r\n    :no-right-side=\"true\"\r\n  >\r\n    <div id=\"lists\">\r\n      <!-- Top navigations -->\r\n      <div class=\"navigations\">\r\n        <div class=\"title\">\r\n          {{ $t('artworks.recentArtworks') }}\r\n        </div>\r\n\r\n        <!-- Options -->\r\n        <div class=\"buttons\">\r\n          <!-- Filter by tags -->\r\n          <div class=\"filter-buttons\">\r\n            <button \r\n              class=\"px-3 rounded-md button-item\"\r\n              :class=\"filterTagsCount ? 'button' : 'theme-color'\"\r\n              @click=\"openTagsFilterSelection\" \r\n            >\r\n              {{ filterTagsCount }} {{ $t('tagsApplied') }}\r\n            </button>\r\n          </div>\r\n\r\n          <!-- Filter explicit content -->\r\n          <div \r\n            v-if=\"auth.loggedIn && auth.user.user_settings.show_explicit\" \r\n            class=\"filter-buttons\"\r\n          >\r\n            <p \r\n              class=\"rounded-l-md button-item\" \r\n              :class=\"[explicitMode === undefined ? 'button' : 'theme-color']\"\r\n              @click=\"changeExplicitMode(undefined)\"\r\n            >\r\n              {{ $t('default') }}\r\n            </p>\r\n\r\n            <p \r\n              class=\"button-item\" \r\n              :class=\"[explicitMode === 'safe' ? 'button' : 'theme-color']\"\r\n              @click=\"changeExplicitMode('safe')\"\r\n            >\r\n              {{ $t('safe') }}\r\n            </p>\r\n            \r\n            <p \r\n              class=\"rounded-r-md button-item\" \r\n              :class=\"[explicitMode === 'explicit' ? 'button' : 'theme-color']\"\r\n              @click=\"changeExplicitMode('explicit')\"\r\n            >\r\n              {{ $t('explicit') }}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- On loading, empty or error occured -->\r\n      <LoadingEmptyErrorMessage\r\n        :loading=\"loading\"\r\n        :empty=\"isEmpty\"\r\n        :error=\"isError\"\r\n        :fetch=\"fetchTop\"\r\n      />\r\n\r\n      <!-- List area -->\r\n      <div v-show=\"!loading\" class=\"mt-4\">\r\n        <WorkList \r\n          v-show=\"!isEmpty\"\r\n          :section-class=\"'work-grid'\"\r\n          :works=\"works\"\r\n          :view=\"view\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Paging control -->\r\n      <div v-if=\"!loading && !isEmpty && !isError\" class=\"art-list-view-paging-control\">\r\n        <button \r\n          :class=\"[\r\n            config.pagination.enablePrev ? 'primary-button' : 'disabled-button'\r\n          ]\"\r\n          @click=\"movePage('prev')\"\r\n        >\r\n          <Icon :name=\"'i-ion-chevron-back-outline'\" />\r\n          {{ $t('pagination.previous') }}\r\n        </button>\r\n        <button \r\n          :class=\"[\r\n            config.pagination.enableNext ? 'primary-button' : 'disabled-button'\r\n          ]\"\r\n          @click=\"movePage('next')\"\r\n        >\r\n          {{ $t('pagination.next') }}\r\n          <Icon \r\n            :name=\"'i-ion-chevron-forward-outline'\" \r\n            class=\"md:ml-2\"\r\n            style=\"margin-right: 0 !important\" \r\n          />\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Modal view (artwork detail) -->\r\n      <div \r\n        id=\"recent-modal\"\r\n        class=\"modal work-view\" \r\n      >\r\n        <ModalView \r\n          v-show=\"!loading\"\r\n          ref=\"recentModalViewRef\"\r\n          section=\"recent\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Tag filter selection modal -->\r\n      <TagFilterSelection \r\n        v-show=\"!loading\"\r\n        id=\"tag-filter-selection-modal\"\r\n        ref=\"tagFilterSelectionModalRef\"\r\n        class=\"modal\"\r\n        @apply=\"applyTagFilter\"\r\n      />\r\n    </div>\r\n  </Layout>\r\n</template>\r\n\r\n<script setup>\r\n// stores\r\nimport authStore from '@/stores/auth.store'\r\n\r\n// components\r\nimport Icon from '~/components/globals/Icon.vue'\r\nimport Layout from '~/components/layouts/Layout.vue'\r\nimport WorkList from '~/components/artworks/WorkList.vue'\r\nimport ModalView from '~/components/artworks/views/ModalView.vue'\r\nimport LoadingEmptyErrorMessage from '~/components/globals/LoadingEmptyErrorMessage.vue'\r\nimport TagFilterSelection from '~/components/globals/TagFilterSelection.vue'\r\n\r\n// composables\r\nconst { oApiConfiguration, fetchOptions } = useApiFetch()\r\nconst artworkApi = useArtwork(oApiConfiguration, fetchOptions())\r\n\r\ndefineProps ({\r\n  browseMode: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\n\r\nconst auth = authStore()\r\n\r\n/** Before mount, fetch first rows */\r\nonBeforeMount (() => {\r\n  fetchTop()\r\n})\r\n\r\n// Change epxlicit mode for authenticated user and user who activate explicit content\r\nconst explicitMode = ref(undefined)\r\nconst changeExplicitMode = async (mode) => {\r\n  explicitMode.value = mode\r\n  pagination.page = 0\r\n\r\n  await fetchTop()\r\n}\r\n\r\n/**\r\n * FILTER BY TAGS ===========================================================================================================================\r\n */\r\nconst tagFilterSelectionModalRef = ref(null)\r\nconst openTagsFilterSelection = () => {\r\n  tagFilterSelectionModalRef.value.init(toRaw(previousSelectedTags.value))\r\n  useModal().openModal('tag-filter-selection-modal')\r\n}\r\n\r\nconst filterTags = ref('')\r\nconst previousSelectedTags = ref()\r\nconst filterTagsCount = ref(0)\r\nconst applyTagFilter = async (selectedTags, selectedTagsJoined) => {\r\n  previousSelectedTags.value = selectedTags\r\n  filterTags.value = selectedTagsJoined\r\n  filterTagsCount.value = selectedTagsJoined !== '' ? selectedTagsJoined.split(',').length : 0  \r\n  pagination.page = 0\r\n\r\n  // close tag selection modal and refetch the list\r\n  useModal().closeModal('tag-filter-selection-modal')\r\n  await fetchTop()\r\n}\r\n\r\n/** Fetch first row */\r\nwatch (async () => previousSelectedTags.value, _ => {\r\n  fetchTop()\r\n})\r\n\r\nconst works = ref([])\r\nconst config = ref({\r\n  pagination: {\r\n    enablePrev: true,\r\n    enableNext: true\r\n  }\r\n})\r\nconst fetchTop = async () => {\r\n  const data = await fetch()\r\n\r\n  const dataWorks = data.works\r\n  const dataPagination = data.pagination\r\n\r\n  // handle empty data\r\n  if (!dataWorks.length && dataPagination.record_total === 0) {\r\n    showEmpty()\r\n  } else {\r\n    works.value = dataWorks\r\n  \r\n    if (dataPagination.next_previous.next_page === null) {\r\n      config.value.pagination.enableNext = false\r\n    } else {\r\n      config.value.pagination.enableNext = true\r\n    }\r\n\r\n    if (dataPagination.next_previous.prev_page === null) {\r\n      config.value.pagination.enablePrev = false\r\n    } else {\r\n      config.value.pagination.enablePrev = true\r\n    }\r\n  }\r\n}\r\n\r\n/** Fetch */\r\nconst loading = ref(true)\r\nconst pagination = reactive({\r\n  perPage: 18,\r\n  page: ref(0)\r\n})\r\nconst fetch = async () => {\r\n  loading.value = true\r\n  isEmpty.value = false\r\n\r\n  const [data, error] = await artworkApi.getLatest({\r\n    pagination: {\r\n      perPage: pagination.perPage,\r\n      page: pagination.page\r\n    },\r\n    explicitMode: explicitMode.value,\r\n    tags: filterTags.value\r\n  })\r\n\r\n  if (error) {\r\n    showError()\r\n  } else {\r\n    reset()\r\n    return data\r\n  }\r\n\r\n  loading.value = false\r\n}\r\n\r\n// Control pagination and fetch\r\nconst movePage = async (mode) => {\r\n  if (mode === 'prev') {\r\n    pagination.page -= 1\r\n  } else {\r\n    pagination.page += 1\r\n  }\r\n\r\n  await fetchTop()\r\n}\r\n\r\n/** Show empty if there's no artwork to show */\r\nconst isEmpty = ref(false)\r\nconst showEmpty = () => {\r\n  isEmpty.value = true\r\n}\r\n\r\n/** Show error message when error occured while trying to fetch artworks */\r\nconst isError = ref(false)\r\nconst showError = () => {\r\n  loading.value = false\r\n  isError.value = true\r\n  hideButton()\r\n}\r\n\r\n/** Reset refs */\r\nconst reset = () => {\r\n  loading.value = false\r\n  isEmpty.value = false\r\n  isError.value = false\r\n}\r\n\r\n/** Artwork viewer, open a modal */\r\nconst recentModalViewRef = ref(null)\r\nconst view = (workId, keepArtistPageNumber = false) => {\r\n  recentModalViewRef.value.view(workId, keepArtistPageNumber)\r\n\r\n  useModal().openModal('recent-modal')\r\n}\r\n\r\n// const closeModal = (modalId) => {\r\n//   useModal().closeModal(modalId)\r\n// }\r\n// onClickOutside(recentModalViewRef, () => closeModal('recent-modal'))\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '~/assets/css/tailwind.scss';\r\n@import '~/assets/css/artworks/list.scss';\r\n</style>\r\n"],"names":["oApiConfiguration","fetchOptions","useApiFetch","artworkApi","useArtwork","auth","authStore","onBeforeMount","fetchTop","explicitMode","ref","changeExplicitMode","mode","pagination","tagFilterSelectionModalRef","openTagsFilterSelection","toRaw","previousSelectedTags","useModal","filterTags","filterTagsCount","applyTagFilter","selectedTags","selectedTagsJoined","watch","_","works","config","data","fetch","dataWorks","dataPagination","showEmpty","loading","reactive","isEmpty","error","showError","reset","movePage","isError","recentModalViewRef","view","workId","keepArtistPageNumber"],"mappings":"mlCA2IA,KAAA,CAAA,kBAAAA,EAAA,aAAAC,CAAA,EAAAC,EAAA,EACAC,EAAAC,EAAAJ,EAAAC,GAAA,EASAI,EAAAC,EAAA,EAGAC,EAAA,IAAA,CACAC,EAAA,CACA,CAAA,EAGA,MAAAC,EAAAC,EAAA,MAAA,EACAC,EAAA,MAAAC,GAAA,CACAH,EAAA,MAAAG,EACAC,EAAA,KAAA,EAEA,MAAAL,EAAA,CACA,EAKAM,EAAAJ,EAAA,IAAA,EACAK,EAAA,IAAA,CACAD,EAAA,MAAA,KAAAE,EAAAC,EAAA,KAAA,CAAA,EACAC,EAAA,EAAA,UAAA,4BAAA,CACA,EAEAC,EAAAT,EAAA,EAAA,EACAO,EAAAP,EAAA,EACAU,EAAAV,EAAA,CAAA,EACAW,EAAA,MAAAC,EAAAC,IAAA,CACAN,EAAA,MAAAK,EACAH,EAAA,MAAAI,EACAH,EAAA,MAAAG,IAAA,GAAAA,EAAA,MAAA,GAAA,EAAA,OAAA,EACAV,EAAA,KAAA,EAGAK,EAAA,EAAA,WAAA,4BAAA,EACA,MAAAV,EAAA,CACA,EAGAgB,EAAA,SAAAP,EAAA,MAAAQ,GAAA,CACAjB,EAAA,CACA,CAAA,EAEA,MAAAkB,EAAAhB,EAAA,EAAA,EACAiB,EAAAjB,EAAA,CACA,WAAA,CACA,WAAA,GACA,WAAA,EACA,CACA,CAAA,EACAF,EAAA,SAAA,CACA,MAAAoB,EAAA,MAAAC,EAAA,EAEAC,EAAAF,EAAA,MACAG,EAAAH,EAAA,WAGA,CAAAE,EAAA,QAAAC,EAAA,eAAA,EACAC,EAAA,GAEAN,EAAA,MAAAI,EAEAC,EAAA,cAAA,YAAA,KACAJ,EAAA,MAAA,WAAA,WAAA,GAEAA,EAAA,MAAA,WAAA,WAAA,GAGAI,EAAA,cAAA,YAAA,KACAJ,EAAA,MAAA,WAAA,WAAA,GAEAA,EAAA,MAAA,WAAA,WAAA,GAGA,EAGAM,EAAAvB,EAAA,EAAA,EACAG,EAAAqB,EAAA,CACA,QAAA,GACA,KAAAxB,EAAA,CAAA,CACA,CAAA,EACAmB,EAAA,SAAA,CACAI,EAAA,MAAA,GACAE,EAAA,MAAA,GAEA,KAAA,CAAAP,EAAAQ,CAAA,EAAA,MAAAjC,EAAA,UAAA,CACA,WAAA,CACA,QAAAU,EAAA,QACA,KAAAA,EAAA,IACA,EACA,aAAAJ,EAAA,MACA,KAAAU,EAAA,KACA,CAAA,EAEA,GAAAiB,EACAC,EAAA,MAEA,QAAAC,EAAA,EACAV,EAGAK,EAAA,MAAA,EACA,EAGAM,EAAA,MAAA3B,GAAA,CACAA,IAAA,OACAC,EAAA,MAAA,EAEAA,EAAA,MAAA,EAGA,MAAAL,EAAA,CACA,EAGA2B,EAAAzB,EAAA,EAAA,EACAsB,EAAA,IAAA,CACAG,EAAA,MAAA,EACA,EAGAK,EAAA9B,EAAA,EAAA,EACA2B,EAAA,IAAA,CACAJ,EAAA,MAAA,GACAO,EAAA,MAAA,GACA,WAAA,CACA,EAGAF,EAAA,IAAA,CACAL,EAAA,MAAA,GACAE,EAAA,MAAA,GACAK,EAAA,MAAA,EACA,EAGAC,EAAA/B,EAAA,IAAA,EACAgC,EAAA,CAAAC,EAAAC,EAAA,KAAA,CACAH,EAAA,MAAA,KAAAE,EAAAC,CAAA,EAEA1B,EAAA,EAAA,UAAA,cAAA,CACA"}