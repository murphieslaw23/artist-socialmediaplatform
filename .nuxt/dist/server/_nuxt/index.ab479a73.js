import{p as oo,c as eo,n as to,d as io,j as so,e as lo,u as ro,i as f,_ as no,l as ao}from"../server.mjs";import{u as co}from"./useI18n.7843972e.js";import{_ as G,u as uo,a as v}from"./Icon.0c5cbad6.js";import{u as po}from"./useFeed.c700948e.js";import{openBlock as r,createElementBlock as a,onBeforeMount as _o,onMounted as mo,watch as ho,ref as m,createBlock as R,KeepAlive as vo,createVNode as i,withCtx as d,withDirectives as k,vShow as w,createElementVNode as t,Fragment as ko,renderList as wo,createTextVNode as _,toDisplayString as l,createCommentVNode as c,withModifiers as x,normalizeClass as g,unref as T,pushScopeId as xo,popScopeId as yo}from"vue";import"vue-router";import{S as fo,M as go,a as bo,u as Mo,b as Co,c as $o,d as Io}from"./ModalView.fcf62ecd.js";import{L as So}from"./Layout.ebf172ee.js";import{I as L,F as Lo}from"./FeedModalView.1e641056.js";import"#internal/nitro";import"./LoadingEmptyErrorMessage.3cde1887.js";import"./Spinner.8a696002.js";import"./user-counters-api.6cf9eaa2.js";const Ao={};function Fo(b,M){return r(),a("div")}const Ro=G(Ao,[["render",Fo]]);const I=b=>(xo("data-v-0960a3cf"),b=b(),yo(),b),To={class:"mx-auto w-full"},Vo={class:"grid grid-cols-1 gap-1 mx-auto md:gap-2 xl:w-10/12"},Eo={class:"flex flex-row rounded-md theme-color"},Bo={class:"w-full"},Ho={key:0,class:"p-2 md:p-4 user-info"},No=["src"],Oo={class:"name"},Do=I(()=>t("br",null,null,-1)),zo=I(()=>t("span",{class:"mx-1"},"\xB7",-1)),Uo={key:1,class:"px-2 mt-2 md:px-4"},jo={class:"text-xs font-semibold"},Go=["id","innerHTML"],Ko=["id","onClick"],Po=["onClick"],Wo={key:2,class:"px-2 md:px-4"},qo=["innerHTML","id"],Jo=["id","onClick"],Qo={key:1,class:"my-2 w-full rounded-md theme-color-secondary"},Xo={key:0,class:"p-2 md:p-4 user-info"},Yo=["src"],Zo={class:"name"},oe=I(()=>t("br",null,null,-1)),ee=I(()=>t("span",{class:"mx-1"},"\xB7",-1)),te={class:"px-2 mt-2 md:px-4"},ie={class:"text-xs font-semibold"},se=["id","innerHTML"],le=["id","onClick"],re=["onClick"],ne={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},ae={class:"mx-auto mt-2 primary-button"},ce={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},de={class:"mx-auto mt-2 primary-button"},ue={class:"float-right mx-4 mt-2 interactions"},pe={key:0,class:"reactions"},_e=["onClick"],me=["onClick"],he=["onClick"],ve={class:"option dropdown"},ke={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"option-dropdown-items"},we={class:"option-dropdown dropdown-menu"},xe={id:"option-dropdown-items",class:"w-52 toggler","aria-labelledby":"option-dropdown-buttons",role:"menu"},ye={class:"menu-wrapper"},fe=I(()=>t("div",{class:"custom-divider"},null,-1)),ge=["onClick"],be={id:"chronological-modal",class:"modal work-view"},Me={id:"chronological-feed-modal",class:"z-30 modal work-view"},Ce={__name:"index",props:{changeMode:{type:Function,default:()=>{}}},setup(b){oo({title:co().tl("meta.title.feed.feed")});const M=eo();to();const{oApiConfiguration:V,fetchOptions:E}=io(),B=uo(V,E()),H=po(V,E()),K=so(),P=lo(),{$router:W}=ro();_o(()=>{M.loggedIn||P.push({path:"/explore"})}),mo(()=>{}),ho(()=>W.currentRoute.value.params.path,()=>{X(),f().closeModal("feed-collection-selection-modal")}),m({explicitMode:void 0,pagination:{page:0,perPage:10}});const N=m([]),O=m(null),S=(e,n,s)=>{n?N.value[s].apply_explicit_filter=!1:(O.value.view(e),f().openModal("chronological-modal"))},D=m(null),q=e=>{D.value.view(e),f().openModal("chronological-feed-modal")},A=(e,n,s,p)=>{Mo().readMore(e,n,s,p)},z=m(!1);let J;const Q=e=>{const n=m(K.public.appUrl+e),{copy:s}=Co({source:n});s(),$o().splash(J,z,"copy-alert")},C=m([]),h=m([]),U=async(e,n)=>{const s=parseInt(e.split("-")[1]);let p=!1;if(n==="artwork"){const[o,y]=await B.like({workId:s});p=o}else if(n==="feed"){const[o,y]=await H.like({feedId:s});p=o}if(p){h.value.push(e);const o=document.getElementById(`feed-like-button-${n}-${s}`);o.classList.add("animate-bounce"),setInterval(()=>{o.classList.remove("animate-bounce")},2500)}},j=async(e,n)=>{const s=parseInt(e.split("-")[1]);let p=!1;if(n==="artwork"){const[o,y]=await B.unlike({workId:s});p=o}else if(n==="feed"){const[o,y]=await H.unlike({feedId:s});p=o}if(p){const o=h.value.indexOf(e);h.value.splice(o,1)}},X=()=>{f().closeModal("chronological-modal"),f().closeModal("chronological-feed-modal")},F=m(null),$=m(0),Y=e=>{$.value=e,f().openModal("feed-collection-selection-modal"),F.value.fetchCollection(),F.value.fetchCurrentSaved()},Z=e=>{if(e){const n=C.value.indexOf($.value);C.value.splice(n,1)}else C.value.push($.value);Io().animate("save-to-collection-button-"+$.value)};return(e,n)=>{const s=no,p=ao;return r(),R(vo,null,[i(So,{"with-footer":!0,"hide-side":e.isMobile()},{"right-side":d(()=>[i(Ro)]),default:d(()=>[k(i(fo,{id:"copy-alert",text:e.$t("linkCopied"),icon:"i-bi-check-all"},null,8,["text"]),[[w,z.value]]),t("div",To,[t("div",Vo,[(r(!0),a(ko,null,wo(N.value,(o,y)=>(r(),a("div",{key:o.id+o.type,class:"rounded-md lg:mx-6"},[t("div",Eo,[t("div",Bo,[o.users?(r(),a("div",Ho,[i(s,{to:"/profile/"+o.users.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.users.avatar_bucket,o.users.avatar_filename),onError:n[0]||(n[0]=(...u)=>e.imageLoadError&&e.imageLoadError(...u))},null,40,No)]),_:2},1032,["to"]),t("div",Oo,[i(s,{to:"/profile/"+o.users.username,class:"fullname hover:href"},{default:d(()=>[_(l(o.users.name),1)]),_:2},1032,["to"]),Do,i(s,{to:"/profile/"+o.users.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+l(o.users.username),1)]),_:2},1032,["to"]),zo,i(s,{to:(o.type==="artwork"?"/a/":"/feed/")+o.id,class:"hover:underline text-xxs"},{default:d(()=>[_(l(e.formatDate(o.scheduled_post?o.scheduled_post:o.created_at,!0)),1)]),_:2},1032,["to"])])])):c("",!0),o.type==="artwork"?(r(),a("div",Uo,[t("span",jo,l(o.title),1),k(t("p",null,[t("span",{id:"feed-description-"+o.id,innerHTML:o.description.length>300?`${o.description.slice(0,300)}...`:o.description},null,8,Go),o.description.length>300?(r(),a("a",{key:0,id:"feed-read-more-"+o.id,class:"href",onClick:x(u=>A(o.description,o.id,"feed-read-more-","feed-description-"),["prevent"])},l(e.$t("readMore")),9,Ko)):c("",!0)],512),[[w,o.description]])])):c("",!0),t("div",null,[t("div",null,[o.type==="artwork"&&!e.isMobile()?(r(),a("div",{key:0,class:"cursor-pointer",onClick:x(u=>S(o.id),["prevent"])},[i(L,{class:"p-2 md:p-4",work:o},null,8,["work"])],8,Po)):c("",!0),o.type==="artwork"&&e.isMobile()?(r(),R(s,{key:1,to:"/a/"+o.id,class:"cursor-pointer"},{default:d(()=>[i(L,{class:"p-2",work:o},null,8,["work"])]),_:2},1032,["to"])):c("",!0)])]),o.type==="feed"?(r(),a("div",Wo,[k(t("p",{innerHTML:o.text.split("<br>").length>3&&o.text.length>300?`${o.text.slice(0,300)}...`:o.text,id:"feed-text-"+o.id,class:g(["mt-2",{"mb-2":!o.artwork_share_info}])},null,10,qo),[[w,o.text]]),o.text.split("<br>").length>3&&o.text.length>300?(r(),a("a",{key:0,id:"feed-read-more-"+o.id,class:"href",onClick:x(u=>A(o.text,o.id,"feed-read-more-","feed-text-"),["prevent"])},l(e.$t("readMore")),9,Jo)):c("",!0),o.artwork_share_info?(r(),a("div",Qo,[o.artwork_share_info.user?(r(),a("div",Xo,[i(s,{to:"/profile/"+o.artwork_share_info.user.username},{default:d(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.artwork_share_info.user.avatar_bucket,o.artwork_share_info.user.avatar_filename),onError:n[1]||(n[1]=(...u)=>e.imageLoadError&&e.imageLoadError(...u))},null,40,Yo)]),_:2},1032,["to"]),t("div",Zo,[i(s,{to:"/profile/"+o.artwork_share_info.user.username,class:"fullname hover:href"},{default:d(()=>[_(l(o.artwork_share_info.user.name),1)]),_:2},1032,["to"]),oe,i(s,{to:"/profile/"+o.artwork_share_info.user.username,class:"hover:underline text-xxs"},{default:d(()=>[_(" @"+l(o.artwork_share_info.user.username),1)]),_:2},1032,["to"]),ee,i(s,{to:"/a/"+o.artwork_share_info.id,class:"hover:underline text-xxs"},{default:d(()=>[_(l(e.formatDate(o.artwork_share_info.scheduled_post?o.artwork_share_info.scheduled_post:o.artwork_share_info.created_at,!0)),1)]),_:2},1032,["to"])])])):c("",!0),t("div",te,[t("span",ie,l(o.artwork_share_info.title),1),k(t("p",null,[t("span",{id:"feed-description-"+o.artwork_share_info.id,innerHTML:o.artwork_share_info.description.length>300?`${o.artwork_share_info.description.slice(0,300)}...`:o.artwork_share_info.description},null,8,se),o.artwork_share_info.description.length>300?(r(),a("a",{key:0,id:"feed-read-more-"+o.artwork_share_info.id,class:"href",onClick:x(u=>A(o.artwork_share_info.description,o.artwork_share_info.id,"feed-read-more-","feed-description-"),["prevent"])},l(e.$t("readMore")),9,le)):c("",!0)],512),[[w,o.artwork_share_info.description]])]),t("div",null,[e.isMobile()?c("",!0):(r(),a("div",{key:0,class:g(["p-2",{"cursor-pointer":!o.apply_explicit_filter}]),onClick:x(u=>S(o.artwork_share_info.id,o.apply_explicit_filter,y),["prevent"])},[t("div",{class:g(["overflow-hidden relative p-2 rounded-md",{"md:mx-2":o.apply_explicit_filter}])},[i(L,{class:g([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(r(),a("div",ne,[t("div",null,l(T(M).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",ae,l(e.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)],10,re)),e.isMobile()?(r(),R(s,{key:1,to:o.apply_explicit_filter?null:"/a/"+o.artwork_share_info.id,onClick:x(u=>S(o.artwork_share_info.id,o.apply_explicit_filter,y),["prevent"]),class:"cursor-pointer"},{default:d(()=>[t("div",{class:g(["overflow-hidden relative p-2 rounded-md",{"m-2":o.apply_explicit_filter}])},[i(L,{class:g([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(r(),a("div",ce,[t("div",null,l(T(M).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",de,l(e.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)]),_:2},1032,["to","onClick"])):c("",!0)])])):c("",!0)])):c("",!0),t("div",ue,[T(M).loggedIn?(r(),a("div",pe,[t("span",{onClick:u=>o.type==="artwork"?h.value.includes("a-"+o.id)?j("a-"+o.id,o.type):U("a-"+o.id,o.type):h.value.includes("f-"+o.id)?j("f-"+o.id,o.type):U("f-"+o.id,o.type)},[k(i(v,{id:"feed-like-button-"+o.type+"-"+o.id,name:"i-ion-heart",class:"mr-1 text-red-500 hover:text-red-500"},null,8,["id"]),[[w,o.type==="artwork"?h.value.includes("a-"+o.id):h.value.includes("f-"+o.id)]]),k(i(v,{name:"i-ion-heart-outline",class:"mr-1 icon-color hover:text-red-500"},null,512),[[w,o.type==="artwork"?!h.value.includes("a-"+o.id):!h.value.includes("f-"+o.id)]]),_(" "+l(e.thousand(o._count.likes)),1)],8,_e),t("span",{onClick:x(u=>o.type==="artwork"?S(o.id):q(o.id),["prevent"])},[i(v,{name:"i-mdi-comment-multiple-outline",class:"mr-1 icon-color hover:text-blue-500"}),_(" "+l(e.thousand(o._count.comments)),1)],8,me),o.type==="artwork"?(r(),a("span",{key:0,onClick:u=>Y(o.id)},[k(i(v,{id:"save-to-collection-button-"+o.id,name:"i-ion-bookmark",class:"text-blue-500 hover:text-blue-500"},null,8,["id"]),[[w,C.value.includes(o.id)]]),k(i(v,{name:"i-majesticons-bookmark-line",class:"icon-color hover:text-blue-500"},null,512),[[w,!C.value.includes(o.id)]])],8,he)):c("",!0),t("div",ve,[t("button",ke,[t("span",null,[i(v,{name:"i-uit-ellipsis-v",class:"align-middle icon icon-color"})])]),t("div",we,[t("div",xe,[t("div",ye,[i(s,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,class:"flex py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[i(v,{name:"i-fluent-arrow-enter-20-filled",class:"mr-2 text-base"}),_(" "+l(e.$t("open")),1)]),_:2},1032,["to"]),i(s,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,target:"_blank",class:"flex z-20 py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:d(()=>[i(v,{name:"i-ci-external-link",class:"mr-2 text-base"}),_(" "+l(e.$t("openInNewTab")),1)]),_:2},1032,["to"]),fe,t("a",{class:"flex py-2 px-3 w-full leading-4 rounded-md transition-all duration-150 cursor-pointer hover:button-color parent-icon hover:text-white",onClick:u=>Q(o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id)},[i(v,{name:"i-icon-park-outline-copy",class:"mr-2 text-base"}),_(" "+l(e.$t("copySharableLink")),1)],8,ge)])])])])])):c("",!0)])])])]))),128)),i(p),t("div",be,[i(go,{ref_key:"chronologicalModalViewRef",ref:O,section:"chronological"},null,512)]),t("div",Me,[i(Lo,{ref_key:"chronologicalFeedModalViewRef",ref:D,section:"chronological-feed"},null,512)]),i(bo,{id:"feed-collection-selection-modal","modal-id":"feed-collection-selection-modal",ref_key:"collectionSelectionModalRef",ref:F,"work-id":$.value,class:"modal",onSave:Z},null,8,["work-id"])])])]),_:1},8,["hide-side"])],1024)}}},Oe=G(Ce,[["__scopeId","data-v-0960a3cf"]]);export{Oe as default};
//# sourceMappingURL=index.ab479a73.js.map
