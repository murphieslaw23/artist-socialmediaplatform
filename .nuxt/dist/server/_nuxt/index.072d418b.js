import{c as V,d as j,i as L,u as G}from"../server.mjs";import{u as O,_ as H}from"./ErrorMessages.9629f58c.js";import{openBlock as c,createElementBlock as b,createElementVNode as e,createVNode as C,ref as f,toDisplayString as s,normalizeClass as _,createCommentVNode as z,withDirectives as a,vShow as i,Fragment as M,renderList as A,unref as m,createTextVNode as B,vModelText as J,computed as K,createBlock as F,withCtx as Q,withModifiers as T,pushScopeId as W,popScopeId as X}from"vue";import"vue-router";import{L as Y}from"./Layout.db0af32a.js";import{a as N,_ as U}from"./Icon.95c42902.js";import"#internal/nitro";import"./Spinner.490fe47a.js";const Z={class:"flex float-right flex-row gap-2 mb-2 cursor-pointer"},ee={__name:"CloseModalButton",emits:["close"],setup(k,{emit:u}){const D=()=>{u("close")};return(w,R)=>(c(),b("div",Z,[e("div",{class:"modal-close",onClick:R[0]||(R[0]=v=>D())},[C(N,{name:"i-ion-close",class:"text-2xl"})])]))}},se={class:"w-full modal-layer xl:w-3/12 lg:w-2/5"},te={class:"flex flex-row justify-between w-full"},le={class:"title"},oe={class:"report_detail"},ne={class:"report_detail__badge"},re={class:"report_detail__info"},ae={key:0},ie=["href"],de={class:"tags"},ue={class:"tag"},pe={class:"my-4 custom-divider"},ve={class:"flex flex-row gap-2 justify-between"},ce=["placeholder"],_e={__name:"ReportDetailModal",emits:["refresh"],setup(k,{expose:u,emit:D}){const w=V(),{oApiConfiguration:R,fetchOptions:v}=j(),$=O(R,v()),n=f({}),g=f([]),y=async o=>{const[r,d]=await $.getReportById({reportId:o});d||(n.value=r,g.value=r.reasons.split(","))},p=f({response:0,description:""}),x=async()=>{const[o,r]=await $.reviewReport({reportId:n.value.id,response:p.value.response,responseDescription:p.value.description});r||(await y(n.value.id),L().closeModal("report-detail-modal"),D("refresh"))};return u({view:y}),(o,r)=>(c(),b("div",null,[e("button",{class:"hidden",onClick:r[0]||(r[0]=d=>y())}),e("div",se,[e("div",te,[e("span",le,s(o.$t("reports.reportDetail")),1),C(ee,{onClose:r[1]||(r[1]=d=>o.closeModal("report-detail-modal"))})]),e("div",oe,[e("div",ne,[e("span",{class:_(n.value.status==="pending"?"bg-yellow-500":"bg-red-500")},s(n.value.status),3)]),e("div",re,[e("section",null,[e("div",null,[e("label",null,s(o.$t("reports.reportId")),1),e("div",null," #"+s(n.value.id),1)]),e("div",null,[e("label",null,s(o.$t("reports.reportDate")),1),e("div",null,s(o.formatDate(n.value.created_at)),1)]),n.value.user_reported?(c(),b("div",ae,[e("label",null,s(o.$t("reports.userReporting")),1),e("div",null,s(n.value.user_reported.username),1)])):z("",!0),e("div",null,[e("label",null,s(o.$t("reports.reportedPost")),1),e("div",null,[a(e("span",{class:"italic"},s(o.$t("reports.postRemoved")),513),[[i,n.value.is_removed]]),a(e("a",{href:(n.value.type==="artwork"?"/a/":"/feed/")+n.value.post_id,target:"blank",class:"href"},s(o.$t("reports.viewPost")),9,ie),[[i,!n.value.is_removed]])])]),e("div",null,[e("label",null,s(o.$t("reports.reportDescription")),1),e("div",null,s(n.value.description),1)]),e("div",null,[e("label",null,s(o.$t("reports.selectedReasons")),1),e("div",de,[(c(!0),b(M,null,A(g.value,d=>(c(),b("span",ue,s(o.$t("reports.reasons."+d)),1))),256))])])]),a(e("div",pe,null,512),[[i,(m(w).user.is_admin||m(w).user.is_moderator)&&n.value.status==="pending"||n.value.status==="closed"]]),a(e("section",null,[e("div",ve,[e("span",{class:_(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-green-500 cursor-pointer",{"bg-green-500 text-white":p.value.response===0}]),onClick:r[2]||(r[2]=d=>p.value.response=0)},[a(C(N,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,p.value.response===0]]),B(" "+s(o.$t("reports.decisions.doNotRemove")),1)],2),e("span",{class:_(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-red-500 cursor-pointer",{"bg-red-500 text-white":p.value.response===1}]),onClick:r[3]||(r[3]=d=>p.value.response=1)},[a(C(N,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,p.value.response===1]]),B(" "+s(o.$t("reports.decisions.remove")),1)],2)]),e("div",null,[a(e("textarea",{"onUpdate:modelValue":r[4]||(r[4]=d=>p.value.description=d),class:"form-input input textarea",rows:"5",cols:"0",placeholder:o.$t("description"),"data-gramm":"false"},null,8,ce),[[J,p.value.description]])]),e("button",{class:_(p.value.description?"primary-button":"disabled-button"),onClick:r[5]||(r[5]=d=>x())},s(o.$t("reports.submitReviewAndClose")),3)],512),[[i,(m(w).user.is_admin||m(w).user.is_moderator)&&n.value.status==="pending"]]),a(e("section",null,[e("div",null,[e("label",null,s(o.$t("reports.decision")),1),e("div",null,[e("span",{class:_(["font-bold uppercase",n.value.response?"text-green-500":"text-red-500"])},s(n.value.response?"Removed":"Not removed"),3)])]),e("div",null,[e("label",null,s(o.$t("description")),1),e("div",null,s(n.value.response_description),1)]),e("div",null,[e("label",null,s(o.$t("reports.decisionMadeAt")),1),e("div",null,s(o.formatDate(n.value.responded_at)),1)])],512),[[i,n.value.status==="closed"]])])])])]))}},fe=U(_e,[["__scopeId","data-v-5dc58e33"]]);const P=k=>(W("data-v-b857b2ab"),k=k(),X(),k),me={class:"reports"},ge={class:"reports__title"},he=P(()=>e("div",{class:"reports__filters"},null,-1)),be={class:"reports__list"},$e={class:"hidden-md-flex"},we={class:"reports__table",cellspacing:"0",cellpadding:"0"},ye={class:"rounded-l-md"},ke=P(()=>e("th",null,[e("div",{class:"rounded-r-md"},"\xA0")],-1)),Re={class:"rounded-l-md"},De=["onClick"],Ce=["href"],xe=["href"],Ie={class:"font-bold uppercase"},Me={class:"font-bold uppercase"},Ae={class:"rounded-r-md"},Ne=["onClick"],Pe=["href"],Ee={class:"font-bold uppercase"},Se={class:"font-bold uppercase"},Be=P(()=>e("label",null,"\xA0",-1)),Fe=["href"],Te=["onClick"],Ve={class:"reports__pagination"},je={__name:"index",setup(k){const u=V(),{oApiConfiguration:D,fetchOptions:w}=j(),R=O(D,w());G();const v=f({loading:!1,pagination:{page:0,perPage:10}}),$=f({status:"all",filterDateFrom:void 0,filterDateTo:void 0,userId:K(()=>{if(u.loggedIn&&!u.user.is_admin&&!u.user.is_moderator)return u.user.id}),selectedReasons:void 0}),n=f([]),g=f({}),y=async()=>{x(),v.value.loading=!0;const[l,h,t]=await R.getReports({status:$.value.status,createdAtFrom:$.value.filterDateFrom,createdAtTo:$.value.filterDateTo,userId:$.value.userId,reasons:$.value.selectedReasons,pagination:{page:v.value.pagination.page,perPage:v.value.pagination.perPage}});t?q():(h.record_total<=0&&r(),n.value=l,g.value=h),v.value.loading=!1},p=async l=>{l==="next"?v.value.pagination.page++:v.value.pagination.page--,await y()},x=()=>{o.value=!1,d.value=!1},o=f(!1),r=()=>{o.value=!0},d=f(!1),q=()=>{d.value=!0},E=f(null),I=l=>{E.value.view(l),L().openModal("report-detail-modal")};return(l,h)=>(c(),F(Y,{"hide-side":!0,"no-right-side":!0},{default:Q(()=>[e("div",me,[e("div",ge,s(m(u).user.is_admin||m(u).user.is_moderator?l.$t("reports.reports"):l.$t("reports.yourReports")),1),he,e("div",be,[a(e("div",null,[e("div",$e,[e("table",we,[e("thead",null,[e("tr",null,[e("th",null,[e("div",ye,s(l.$t("reports.reportId")),1)]),e("th",null,[e("div",null,s(l.$t("reports.reportDate")),1)]),a(e("th",null,[e("div",null,s(l.$t("reports.user")),1)],512),[[i,m(u).user.is_moderator&&m(u).user.is_admin]]),e("th",null,[e("div",null,s(l.$t("reports.post")),1)]),e("th",null,[e("div",null,s(l.$t("reports.description")),1)]),e("th",null,[e("div",null,s(l.$t("reports.status")),1)]),e("th",null,[e("div",null,s(l.$t("reports.decision")),1)]),ke])]),e("tbody",null,[(c(!0),b(M,null,A(n.value,t=>(c(),b("tr",{key:t.id},[e("td",null,[e("div",Re,[e("a",{class:"font-bold hover:underline href",onClick:T(S=>I(t.id),["prevent"])}," #"+s(t.id),9,De)])]),e("td",null,[e("div",null,s(l.formatDate(t.created_at)),1)]),a(e("td",null,[e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,Ce)])],512),[[i,m(u).user.is_moderator&&m(u).user.is_admin]]),e("td",null,[e("div",null,[a(e("span",{class:"italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),a(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"href"},s(l.$t("reports.viewPost")),9,xe),[[i,!t.is_removed]])])]),e("td",null,[e("div",null,s(t.description.length>300?`${t.description.slice(0,300)}...`:t.description),1)]),e("td",Ie,[e("div",null,[e("span",{class:_(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("td",null,[e("div",Me,[a(e("span",null,"-",512),[[i,t.status==="pending"]]),a(e("span",{class:_(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3),[[i,t.status==="closed"]])])]),e("td",Ae,[e("div",null,[e("a",{class:"underline href",onClick:T(S=>I(t.id),["prevent"])},s(l.$t("reports.moreInfo")),9,Ne)])])]))),128))])])]),(c(!0),b(M,null,A(n.value,t=>(c(),b("div",{key:t.id,class:"reports__cards"},[e("div",null,[e("label",null,s(l.$t("reports.user")),1),e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,Pe)])]),e("div",null,[e("label",null,s(l.$t("reports.description")),1),e("div",null,s(t.description),1)]),e("div",null,[e("label",null,s(l.$t("reports.reportDate")),1),e("div",null,s(l.formatDate(t.created_at)),1)]),e("div",null,[e("label",null,s(l.$t("reports.status")),1),e("div",Ee,[e("div",{class:_(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("div",null,[e("label",null,s(l.$t("reports.decision")),1),e("div",Se,[e("span",{class:_(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3)])]),e("div",null,[Be,e("div",null,[a(e("span",{class:"mr-2 italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),a(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"mr-2 underline href"},s(l.$t("reports.viewReportedPost")),9,Fe),[[i,!t.is_removed]]),e("div",{class:"underline href",onClick:S=>I(t.id)},s(l.$t("reports.moreInfo")),9,Te)])])]))),128)),a(e("div",Ve,[e("button",{class:_(g.value.next_previous&&g.value.next_previous.prev_page!==null?"primary-button":"disabled-button"),onClick:h[0]||(h[0]=t=>p("prev"))},s(l.$t("pagination.previous")),3),e("button",{class:_(g.value.next_previous&&g.value.next_previous.next_page!==null?"primary-button":"disabled-button"),onClick:h[1]||(h[1]=t=>p("next"))},s(l.$t("pagination.next")),3)],512),[[i,g.value.total_page>0]])],512),[[i,!v.value.loading&&!o.value&&!d.value]]),C(H,{loading:v.value.loading,empty:o.value,error:d.value,fetch:y},null,8,["loading","empty","error"])])]),v.value.loading?z("",!0):(c(),F(fe,{key:0,id:"report-detail-modal",ref_key:"reportDetailModalRef",ref:E,class:"modal",onRefresh:h[2]||(h[2]=t=>y())},null,512))]),_:1}))}},Ke=U(je,[["__scopeId","data-v-b857b2ab"]]);export{Ke as default};
//# sourceMappingURL=index.072d418b.js.map
