import{c as j,d as L,i as O,u as H}from"../server.mjs";import{u as z,_ as U}from"./LoadingEmptyErrorMessage.3cde1887.js";import{openBlock as _,createElementBlock as b,createElementVNode as e,createVNode as D,ref as c,toDisplayString as s,withDirectives as a,normalizeClass as f,createCommentVNode as q,vShow as i,Fragment as N,renderList as P,unref as g,createTextVNode as F,vModelText as J,computed as K,createBlock as T,withCtx as Q,withModifiers as V,pushScopeId as W,popScopeId as X}from"vue";import"vue-router";import{L as Y}from"./Layout.ebf172ee.js";import{a as E,_ as G}from"./Icon.0c5cbad6.js";import"#internal/nitro";import"./Spinner.8a696002.js";const Z={class:"flex float-right flex-row gap-2 mb-2 cursor-pointer"},ee={__name:"CloseModalButton",emits:["close"],setup(k,{emit:u}){const C=()=>{u("close")};return(y,R)=>(_(),b("div",Z,[e("div",{class:"modal-close",onClick:R[0]||(R[0]=v=>C())},[D(E,{name:"i-ion-close",class:"text-2xl"})])]))}},se={class:"w-full modal-layer xl:w-3/12 lg:w-2/5"},te={class:"flex flex-row justify-between w-full"},le={class:"title"},oe={class:"report_detail"},ne={class:"report_detail__badge"},re={class:"report_detail__info"},ae={key:0},ie=["href"],de={class:"tags"},ue={class:"tag"},pe={class:"my-4 custom-divider"},ve={class:"flex flex-row gap-2 justify-between"},ce=["placeholder"],_e={__name:"ReportDetailModal",emits:["refresh"],setup(k,{expose:u,emit:C}){const y=j(),{oApiConfiguration:R,fetchOptions:v}=L(),$=z(R,v()),w=c(!0),m=c(!1),n=c({}),x=c([]),I=async o=>{w.value=!0,m.value=!1;const[r,p]=await $.getReportById({reportId:o});p?m.value=!0:(n.value=r,x.value=r.reasons.split(",")),w.value=!1},d=c({response:0,description:""}),M=async()=>{const[o,r]=await $.reviewReport({reportId:n.value.id,response:d.value.response,responseDescription:d.value.description});r||(await I(n.value.id),O().closeModal("report-detail-modal"),C("refresh"))};return u({view:I}),(o,r)=>(_(),b("div",null,[e("button",{class:"hidden",onClick:r[0]||(r[0]=p=>I())}),e("div",se,[e("div",te,[e("span",le,s(o.$t("reports.reportDetail")),1),D(ee,{onClose:r[1]||(r[1]=p=>o.closeModal("report-detail-modal"))})]),D(U,{loading:w.value,error:m.value},null,8,["loading","error"]),a(e("div",oe,[e("div",ne,[e("span",{class:f(n.value.status==="pending"?"bg-yellow-500":"bg-red-500")},s(n.value.status),3)]),e("div",re,[e("section",null,[e("div",null,[e("label",null,s(o.$t("reports.reportId")),1),e("div",null," #"+s(n.value.id),1)]),e("div",null,[e("label",null,s(o.$t("reports.reportDate")),1),e("div",null,s(o.formatDate(n.value.created_at)),1)]),n.value.user_reported?(_(),b("div",ae,[e("label",null,s(o.$t("reports.userReporting")),1),e("div",null,s(n.value.user_reported.username),1)])):q("",!0),e("div",null,[e("label",null,s(o.$t("reports.reportedPost")),1),e("div",null,[a(e("span",{class:"italic"},s(o.$t("reports.postRemoved")),513),[[i,n.value.is_removed]]),a(e("a",{href:(n.value.type==="artwork"?"/a/":"/feed/")+n.value.post_id,target:"blank",class:"href"},s(o.$t("reports.viewPost")),9,ie),[[i,!n.value.is_removed]])])]),e("div",null,[e("label",null,s(o.$t("reports.reportDescription")),1),e("div",null,s(n.value.description),1)]),e("div",null,[e("label",null,s(o.$t("reports.selectedReasons")),1),e("div",de,[(_(!0),b(N,null,P(x.value,p=>(_(),b("span",ue,s(o.$t("reports.reasons."+p)),1))),256))])])]),a(e("div",pe,null,512),[[i,(g(y).user.is_admin||g(y).user.is_moderator)&&n.value.status==="pending"||n.value.status==="closed"]]),a(e("section",null,[e("div",ve,[e("span",{class:f(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-green-500 cursor-pointer",{"bg-green-500 text-white":d.value.response===0}]),onClick:r[2]||(r[2]=p=>d.value.response=0)},[a(D(E,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,d.value.response===0]]),F(" "+s(o.$t("reports.decisions.doNotRemove")),1)],2),e("span",{class:f(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-red-500 cursor-pointer",{"bg-red-500 text-white":d.value.response===1}]),onClick:r[3]||(r[3]=p=>d.value.response=1)},[a(D(E,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,d.value.response===1]]),F(" "+s(o.$t("reports.decisions.remove")),1)],2)]),e("div",null,[a(e("textarea",{"onUpdate:modelValue":r[4]||(r[4]=p=>d.value.description=p),class:"form-input input textarea",rows:"5",cols:"0",placeholder:o.$t("description"),"data-gramm":"false"},null,8,ce),[[J,d.value.description]])]),e("button",{class:f(d.value.description?"primary-button":"disabled-button"),onClick:r[5]||(r[5]=p=>M())},s(o.$t("reports.submitReviewAndClose")),3)],512),[[i,(g(y).user.is_admin||g(y).user.is_moderator)&&n.value.status==="pending"]]),a(e("section",null,[e("div",null,[e("label",null,s(o.$t("reports.decision")),1),e("div",null,[e("span",{class:f(["font-bold uppercase",n.value.response?"text-green-500":"text-red-500"])},s(n.value.response?"Removed":"Not removed"),3)])]),e("div",null,[e("label",null,s(o.$t("description")),1),e("div",null,s(n.value.response_description),1)]),e("div",null,[e("label",null,s(o.$t("reports.decisionMadeAt")),1),e("div",null,s(o.formatDate(n.value.responded_at)),1)])],512),[[i,n.value.status==="closed"]])])],512),[[i,!w.value]])])]))}},fe=G(_e,[["__scopeId","data-v-9102dd9e"]]);const S=k=>(W("data-v-5371471a"),k=k(),X(),k),me={class:"reports"},ge={class:"reports__title"},he=S(()=>e("div",{class:"reports__filters"},null,-1)),be={class:"reports__list"},$e={class:"hidden-md-flex"},we={class:"reports__table",cellspacing:"0",cellpadding:"0"},ye={class:"rounded-l-md"},ke=S(()=>e("th",null,[e("div",{class:"rounded-r-md"},"\xA0")],-1)),Re={class:"rounded-l-md"},De=["onClick"],Ce=["href"],xe=["href"],Ie={class:"font-bold uppercase"},Me={class:"font-bold uppercase"},Ae={class:"rounded-r-md"},Ne=["onClick"],Pe=["href"],Ee={class:"text-right md:text-left"},Se={class:"font-bold uppercase"},Be={class:"font-bold uppercase"},Fe=S(()=>e("label",null,"\xA0",-1)),Te=["href"],Ve=["onClick"],je={class:"reports__pagination"},Le={__name:"index",setup(k){const u=j(),{oApiConfiguration:C,fetchOptions:y}=L(),R=z(C,y());H();const v=c({loading:!1,pagination:{page:0,perPage:10}}),$=c({status:"all",filterDateFrom:void 0,filterDateTo:void 0,userId:K(()=>{if(u.loggedIn&&!u.user.is_admin&&!u.user.is_moderator)return u.user.id}),selectedReasons:void 0}),w=c([]),m=c({}),n=async()=>{I(),v.value.loading=!0;const[l,h,t]=await R.getReports({status:$.value.status,createdAtFrom:$.value.filterDateFrom,createdAtTo:$.value.filterDateTo,userId:$.value.userId,reasons:$.value.selectedReasons,pagination:{page:v.value.pagination.page,perPage:v.value.pagination.perPage}});t?r():(h.record_total<=0&&M(),w.value=l,m.value=h),v.value.loading=!1},x=async l=>{l==="next"?v.value.pagination.page++:v.value.pagination.page--,await n()},I=()=>{d.value=!1,o.value=!1},d=c(!1),M=()=>{d.value=!0},o=c(!1),r=()=>{o.value=!0},p=c(null),A=l=>{p.value.view(l),O().openModal("report-detail-modal")};return(l,h)=>(_(),T(Y,{"hide-side":!0,"no-right-side":!0},{default:Q(()=>[e("div",me,[e("div",ge,s(g(u).user.is_admin||g(u).user.is_moderator?l.$t("reports.reports"):l.$t("reports.yourReports")),1),he,e("div",be,[a(e("div",null,[e("div",$e,[e("table",we,[e("thead",null,[e("tr",null,[e("th",null,[e("div",ye,s(l.$t("reports.reportId")),1)]),e("th",null,[e("div",null,s(l.$t("reports.reportDate")),1)]),a(e("th",null,[e("div",null,s(l.$t("reports.user")),1)],512),[[i,g(u).user.is_moderator&&g(u).user.is_admin]]),e("th",null,[e("div",null,s(l.$t("reports.post")),1)]),e("th",null,[e("div",null,s(l.$t("reports.description")),1)]),e("th",null,[e("div",null,s(l.$t("reports.status")),1)]),e("th",null,[e("div",null,s(l.$t("reports.decision")),1)]),ke])]),e("tbody",null,[(_(!0),b(N,null,P(w.value,t=>(_(),b("tr",{key:t.id},[e("td",null,[e("div",Re,[e("a",{class:"font-bold hover:underline href",onClick:V(B=>A(t.id),["prevent"])}," #"+s(t.id),9,De)])]),e("td",null,[e("div",null,s(l.formatDate(t.created_at)),1)]),a(e("td",null,[e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,Ce)])],512),[[i,g(u).user.is_moderator&&g(u).user.is_admin]]),e("td",null,[e("div",null,[a(e("span",{class:"italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),a(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"href"},s(l.$t("reports.viewPost")),9,xe),[[i,!t.is_removed]])])]),e("td",null,[e("div",null,s(t.description.length>300?`${t.description.slice(0,300)}...`:t.description),1)]),e("td",Ie,[e("div",null,[e("span",{class:f(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("td",null,[e("div",Me,[a(e("span",null,"-",512),[[i,t.status==="pending"]]),a(e("span",{class:f(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3),[[i,t.status==="closed"]])])]),e("td",Ae,[e("div",null,[e("a",{class:"underline href",onClick:V(B=>A(t.id),["prevent"])},s(l.$t("reports.moreInfo")),9,Ne)])])]))),128))])])]),(_(!0),b(N,null,P(w.value,t=>(_(),b("div",{key:t.id,class:"reports__cards"},[e("div",null,[e("label",null,s(l.$t("reports.user")),1),e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,Pe)])]),e("div",null,[e("label",null,s(l.$t("reports.description")),1),e("div",Ee,s(t.description),1)]),e("div",null,[e("label",null,s(l.$t("reports.reportDate")),1),e("div",null,s(l.formatDate(t.created_at)),1)]),e("div",null,[e("label",null,s(l.$t("reports.status")),1),e("div",Se,[e("div",{class:f(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("div",null,[e("label",null,s(l.$t("reports.decision")),1),e("div",Be,[e("span",{class:f(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3)])]),e("div",null,[Fe,e("div",null,[a(e("span",{class:"mr-2 italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),a(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"mr-2 underline href"},s(l.$t("reports.viewReportedPost")),9,Te),[[i,!t.is_removed]]),e("div",{class:"underline href",onClick:B=>A(t.id)},s(l.$t("reports.moreInfo")),9,Ve)])])]))),128)),a(e("div",je,[e("button",{class:f(m.value.next_previous&&m.value.next_previous.prev_page!==null?"primary-button":"disabled-button"),onClick:h[0]||(h[0]=t=>x("prev"))},s(l.$t("pagination.previous")),3),e("button",{class:f(m.value.next_previous&&m.value.next_previous.next_page!==null?"primary-button":"disabled-button"),onClick:h[1]||(h[1]=t=>x("next"))},s(l.$t("pagination.next")),3)],512),[[i,m.value.total_page>0]])],512),[[i,!v.value.loading&&!d.value&&!o.value]]),D(U,{loading:v.value.loading,empty:d.value,error:o.value,fetch:n},null,8,["loading","empty","error"])])]),v.value.loading?q("",!0):(_(),T(fe,{key:0,id:"report-detail-modal",ref_key:"reportDetailModalRef",ref:p,class:"modal",onRefresh:h[2]||(h[2]=t=>n())},null,512))]),_:1}))}},Qe=G(Le,[["__scopeId","data-v-5371471a"]]);export{Qe as default};
//# sourceMappingURL=index.50b89710.js.map
