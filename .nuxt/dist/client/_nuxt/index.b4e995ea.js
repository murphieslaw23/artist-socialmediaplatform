import{h as N,i as T,k as j,r as l,I as H,a3 as b,o as h,l as W,m as r,t as w,b as f,w as B,p as R,J as E,q as U,s as y,v as k,G as v,x as K,c as P,P as Q,D as X,u as Y}from"./entry.64996531.js";import{L as Z}from"./Layout.7fc1f157.js";import{_ as $,u as ee}from"./Icon.1a411f0f.js";import{W as oe,M as te}from"./ModalView.4aa8a482.js";import{_ as ae}from"./ErrorMessages.9a8b0e4d.js";import{_ as ne}from"./_plugin-vue_export-helper.a1a6add7.js";import{u as ie}from"./useUser.422cee4f.js";import"./Spinner.13f27c72.js";import"./user-counters-api.38d2e3f3.js";import"./useFeed.be617097.js";const se={components:{Icon:$,WorkList:oe,ModalView:te,ErrorMessages:ae},props:{title:{type:String,default:""},section:{type:String,default:""},paginationProp:{type:Object,default(){return{perPage:{type:Number,default:6},maxLoadMore:{type:Number,default:5}}}},discoverRoute:{type:String,default:"/"}},setup(t){const o=N(),{oApiConfiguration:a,fetchOptions:e}=T(),m=ee(a,e());j(async()=>{await g()});const M=l([]),g=async()=>{const n=await L();if(n){const u=n.works,s=n.pagination;M.value=u,s.record_total<=i.perPage&&x(),s.record_total===0&&z()}else F()},p=l(!0),c=l(void 0),i=H({perPage:t.paginationProp.perPage,page:l(0)}),L=async()=>{i.page===0&&(p.value=!0);try{let n,u;if(t.section==="recent"){const[s,_]=await m.getLatest({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});s?n=s:u=_}else if(t.section==="following"){const[s,_]=await m.getFollowing({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});s?n=s:u=_}else if(t.section==="popular"){const[s,_]=await m.getMostPopular({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value,range:"daily",rangeMode:"none"});s?n=s:u=_}return i.page+=1,G(),n}catch{F()}},d=l({delay:!1,maxLoad:t.paginationProp.maxLoadMore,showDiscoveryButton:!1}),q=async()=>{d.value.delay=!0;const n=await L(),u=n.works,s=n.pagination;u.forEach(_=>{M.value.push(_)}),d.value.delay=!1,s.next_previous.next_page||x(),s.next_previous.next_page&&s.current_page===d.value.maxLoad&&(x(),d.value.showDiscoveryButton=!0)},V=l(!0),x=()=>{V.value=!1},C=l(!1),z=()=>{C.value=!0,x()},A=l(!1),F=()=>{p.value=!1,A.value=!0,x()},G=()=>{p.value=!1,C.value=!1,A.value=!1},J=n=>{c.value=n,i.page=0,V.value=!0,d.value.showDiscoveryButton=!1,g()},I=l(null),S=l(null),O=l(null);return{auth:o,loading:p,explicitMode:c,changeExplicitMode:J,fetchTop:g,pagination:i,works:M,loadMoreOptions:d,showLoadMoreButton:V,loadMore:q,isEmpty:C,isError:A,recentModalViewRef:I,followingModalViewRef:S,popularModalViewRef:O,view:(n,u=!1)=>{t.section==="recent"&&I.value.view(n,u),t.section==="following"&&S.value.view(n,u),t.section==="popular"&&O.value.view(n,u),v().openModal(`${t.section}-modal`)}}}},re={id:"lists"},le={class:"navigations"},ce={class:"title hidden-md-flex"},de={class:"buttons"},ue={key:0,class:"filter-buttons"},pe={class:"hidden-md-flex"},fe=["id"];function ge(t,o,a,e,m,M){const g=b("Icon"),p=K,c=b("ErrorMessages"),i=b("WorkList"),L=b("ModalView");return h(),W("div",null,[r("div",re,[r("div",le,[r("div",ce,w(a.title),1),f(p,{to:a.discoverRoute,class:"flex flex-row justify-between title md:hidden"},{default:B(()=>[R(w(a.title)+" ",1),f(g,{name:"i-fluent-arrow-enter-20-filled",class:"text-xl text-colored"})]),_:1},8,["to"]),r("div",de,[e.auth.loggedIn&&e.auth.user.user_settings&&e.auth.user.user_settings.show_explicit?(h(),W("div",ue,[r("p",{class:E(["rounded-l-md button-item",[e.explicitMode===void 0?"button":"theme-color"]]),onClick:o[0]||(o[0]=d=>e.changeExplicitMode(void 0))},w(t.$t("default")),3),r("p",{class:E(["button-item",[e.explicitMode==="safe"?"button":"theme-color"]]),onClick:o[1]||(o[1]=d=>e.changeExplicitMode("safe"))},w(t.$t("safe")),3),r("p",{class:E(["rounded-r-md button-item",[e.explicitMode==="explicit"?"button":"theme-color"]]),onClick:o[2]||(o[2]=d=>e.changeExplicitMode("explicit"))},w(t.$t("explicit")),3)])):U("",!0),r("div",pe,[f(p,{class:"discover-button",to:a.discoverRoute},{default:B(()=>[R(w(t.$t("seeMore")),1)]),_:1},8,["to"])])])]),f(c,{loading:e.loading,empty:e.isEmpty,error:e.isError,fetch:e.fetchTop},null,8,["loading","empty","error","fetch"]),y(r("div",null,[y(f(i,{"section-class":"work-grid",works:e.works,view:e.view},null,8,["works","view"]),[[k,!e.isEmpty]]),y(r("div",{class:E(["primary-button md:mt-4",e.loadMoreOptions.delay?"animate-pulse":""]),onClick:o[3]||(o[3]=(...d)=>e.loadMore&&e.loadMore(...d))},w(t.$t("loadMore")),3),[[k,e.showLoadMoreButton]]),y(r("div",null,[f(p,{to:"/works/"+a.section,class:"flex-row justify-center primary-button md:mt-4"},{default:B(()=>[f(g,{name:"i-fluent-arrow-enter-20-filled",class:"mr-1 text-white hover:text-white"}),R(" "+w(t.$t("seeMore")),1)]),_:1},8,["to"])],512),[[k,e.loadMoreOptions.showDiscoveryButton]])],512),[[k,!e.loading]]),r("div",{id:a.section+"-modal",class:"modal work-view"},[y(f(L,{ref:a.section+"ModalViewRef",section:a.section},null,8,["section"]),[[k,!e.loading]])],8,fe)])])}const D=ne(se,[["render",ge],["__scopeId","data-v-a02db1b8"]]),me={__name:"Recent",setup(t){const o={perPage:18,maxLoadMore:4};return(a,e)=>(h(),P(D,{section:"recent",title:a.$t("artworks.recentArtworks"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/recent"},null,8,["title","pagination-prop"]))}},we={__name:"Following",setup(t){const o={perPage:12,maxLoadMore:4};return(a,e)=>(h(),P(D,{section:"following",title:a.$t("following"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/following","custom-empty-message":a.$t("explores.noFollowing")},null,8,["title","pagination-prop","custom-empty-message"]))}},_e={__name:"Popular",setup(t){const o={perPage:12,maxLoadMore:4};return(a,e)=>(h(),P(D,{section:"popular",title:a.$t("artworks.dailyPopular"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/popular"},null,8,["title","pagination-prop"]))}},ve={class:"flex flex-col mt-2"},Ce={__name:"index",setup(t){const{oApiConfiguration:o,fetchOptions:a}=T(),e=ie(o,a()),m=N();j(()=>{m.loggedIn&&p()});const M=Q();X(()=>M.query,c=>{setTimeout(()=>{v().closeModal("recent-modal"),v().closeModal("popular-modal"),v().closeModal("following-modal"),v().closeModal("collection-selection-modal"),v().closeModal("album-selection-modal"),v().closeModal("report-modal")},50)});const g=l(!1),p=async()=>{const[c,i]=await e.getFollowingList({userId:m.user.id,pagination:{page:0,perPage:1}});g.value=c.pagination.record_total>0};return(c,i)=>(h(),P(Z,{"with-footer":!0,"hide-side":!0,"no-right-side":!0},{default:B(()=>[r("div",ve,[f(me,{class:"mb-10"}),Y(m).loggedIn&&g.value?(h(),P(we,{key:0,class:"mb-10"})):U("",!0),f(_e)])]),_:1}))}};export{Ce as default};
