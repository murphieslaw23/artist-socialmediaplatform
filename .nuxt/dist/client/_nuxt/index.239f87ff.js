import{o as r,l as c,aa as so,h as io,a2 as ao,i as lo,H as ro,j as no,a as co,a7 as uo,k as po,D as _o,r as v,c as T,b as s,w as n,a4 as ho,s as w,v as f,m as t,U as mo,T as vo,u as F,t as a,p as _,G as y,V as ko,q as u,F as b,J as M,K as wo,L as fo,x as xo}from"./entry.ec82c8a4.js";import{u as go}from"./useI18n.6f8d5930.js";import{u as yo,_ as k}from"./Icon.12c4779f.js";import{u as bo}from"./useFeed.56c6d0a5.js";import{S as Mo,M as Co,a as Io,u as $o,b as So,c as Ao,d as Fo}from"./ModalView.705bd7e7.js";import{L as Lo,J as Ro}from"./Layout.a04c6b50.js";import{F as Vo,I as L}from"./FeedModalView.ea9fdff6.js";import{_ as j}from"./_plugin-vue_export-helper.a1a6add7.js";import"./LoadingEmptyErrorMessage.8ae3c568.js";import"./Spinner.7be79ae2.js";import"./user-counters-api.995b125b.js";const To={};function Eo(I,x){return r(),c("div")}const Bo=j(To,[["render",Eo]]);const C=I=>(wo("data-v-2adc7817"),I=I(),fo(),I),No={class:"mx-auto w-full"},Do={class:"grid grid-cols-1 gap-1 mx-auto md:gap-2 xl:w-11/12"},Oo={class:"flex flex-row rounded-md theme-color"},Po={class:"w-full"},Uo={key:0,class:"p-2 md:p-4 user-info"},zo=["src"],Go={class:"name"},Ho=C(()=>t("br",null,null,-1)),jo=C(()=>t("span",{class:"mx-1"},"\xB7",-1)),Jo={key:1,class:"px-2 mt-2 md:px-4"},Ko={class:"text-xs font-semibold"},qo=["id"],Wo=["id","onClick"],Qo=["onClick"],Xo={key:2,class:"px-2 md:px-4"},Yo={key:0,class:"my-2 w-full rounded-md theme-color-secondary"},Zo={key:0,class:"p-2 md:p-4 user-info"},oe=["src"],ee={class:"name"},te=C(()=>t("br",null,null,-1)),se=C(()=>t("span",{class:"mx-1"},"\xB7",-1)),ie={class:"px-2 mt-2 md:px-4"},ae={class:"text-xs font-semibold"},le=["id"],re=["id","onClick"],ne=["onClick"],ce={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},de={class:"mx-auto mt-2 primary-button"},ue={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},pe={class:"mx-auto mt-2 primary-button"},_e={class:"float-right mx-4 mt-2 interactions"},he={key:0,class:"reactions"},me=["onClick"],ve=["onClick"],ke=["onClick"],we={class:"option dropdown"},fe={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"option-dropdown-items"},xe={class:"option-dropdown dropdown-menu"},ge={id:"option-dropdown-items",class:"w-52 toggler","aria-labelledby":"option-dropdown-buttons",role:"menu"},ye={class:"menu-wrapper"},be=C(()=>t("div",{class:"custom-divider"},null,-1)),Me=["onClick"],Ce={class:"mx-auto text-center"},Ie={class:"mx-auto text-center"},$e={class:"mx-auto text-center"},Se=C(()=>t("br",null,null,-1)),Ae={id:"chronological-modal",class:"modal work-view"},Fe={id:"chronological-feed-modal",class:"z-30 modal work-view"},Le={__name:"index",props:{changeMode:{type:Function,default:()=>{}}},setup(I){so({title:go().tl("meta.title.feed")});const x=io(),{generateArtworkThumb:J}=ao(),{oApiConfiguration:E,fetchOptions:B}=lo(),N=yo(E,B()),R=bo(E,B()),K=ro(),q=no(),{$router:W}=co();uo(()=>{x.loggedIn||q.push({path:"/explore"})}),po(()=>{}),_o(()=>W.currentRoute.value.params.path,()=>{oo(),y().closeModal("feed-collection-selection-modal")});const $=v({explicitMode:void 0,pagination:{page:0,perPage:10}}),V=v([]),Q=async({loaded:e})=>{const[l,i]=await R.getChronologicalFeeds({explicitMode:$.value.explicitMode,pagination:{page:$.value.pagination.page,perPage:$.value.pagination.perPage}});$.value.pagination.page+=1;for(let d=0;d<l.feeds.length;d++){const o=l.feeds[d];if(o.liked&&(o.type==="artwork"?m.value.push("a-"+o.id):m.value.push("f-"+o.id)),o.images=[],o.apply_explicit_filter=!1,o.type==="artwork"||o.type==="feed"&&o.artwork_share_info!=null){o.type==="artwork"&&o.saved&&g.value.push(o.id);for(let h=0;h<o.artwork_assets.length;h++)if(h<=3){const p=await J(o.artwork_assets[h].bucket,o.artwork_assets[h].filename,"feed");o.images.push(p)}o.artwork_share_info!=null&&(!x.loggedIn&&o.artwork_share_info.is_explicit||o.artwork_share_info.is_explicit&&!x.user.user_settings.show_explicit)&&(o.apply_explicit_filter=!0)}V.value.push(o)}e(l.feeds.length,$.value.pagination.perPage)},D=v(null),A=(e,l,i)=>{l?V.value[i].apply_explicit_filter=!1:(D.value.view(e),y().openModal("chronological-modal"))},O=v(null),X=e=>{O.value.view(e),y().openModal("chronological-feed-modal")},P=(e,l,i,d)=>{So().readMore(e,l,i,d)},U=v(!1);let Y;const Z=e=>{const l=v(K.public.appUrl+e),{copy:i}=Ao({source:l});i(),Fo().splash(Y,U,"copy-alert")},g=v([]),m=v([]),z=async(e,l)=>{const i=parseInt(e.split("-")[1]);let d=!1;if(l==="artworks"){const[o,h]=await N.like({workId:i});d=o}else if(l==="feeds"){const[o,h]=await R.like({feedId:i});d=o}if(d){m.value.push(e);const o=document.getElementById(`feed-like-button-${l}-${i}`);o.classList.add("animate-bounce"),setInterval(()=>{o.classList.remove("animate-bounce")},2500)}},G=async(e,l)=>{const i=parseInt(e.split("-")[1]);let d=!1;if(l==="artworks"){const[o,h]=await N.unlike({workId:i});d=o}else if(l==="feeds"){const[o,h]=await R.unlike({feedId:i});d=o}if(d){const o=m.value.indexOf(e);m.value.splice(o,1)}},oo=()=>{y().closeModal("chronological-modal"),y().closeModal("chronological-feed-modal")},H=v(null),S=v(0),eo=e=>{S.value=e,y().openModal("feed-collection-selection-modal"),H.value.fetchCurrentSaved()},to=e=>{if(e){const l=g.value.indexOf(S.value);g.value.splice(l,1)}else g.value.push(S.value);$o().animate("save-to-collection-button-"+S.value)};return(e,l)=>{const i=xo,d=ko;return r(),T(ho,null,[s(Lo,{"with-footer":!0,"hide-side":e.isMobile()},{"right-side":n(()=>[s(Bo)]),default:n(()=>[w(s(Mo,{id:"copy-alert",text:e.$t("linkCopied"),icon:"i-bi-check-all"},null,8,["text"]),[[f,U.value]]),t("div",No,[t("div",Do,[(r(!0),c(vo,null,mo(V.value,(o,h)=>(r(),c("div",{key:o.id+o.type,class:"rounded-md lg:mx-6"},[t("div",Oo,[t("div",Po,[o.users?(r(),c("div",Uo,[s(i,{to:"/profile/"+o.users.username},{default:n(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.users.avatar_bucket,o.users.avatar_filename),onError:l[0]||(l[0]=(...p)=>e.imageLoadError&&e.imageLoadError(...p))},null,40,zo)]),_:2},1032,["to"]),t("div",Go,[s(i,{to:"/profile/"+o.users.username,class:"fullname hover:href"},{default:n(()=>[_(a(o.users.name),1)]),_:2},1032,["to"]),Ho,s(i,{to:"/profile/"+o.users.username,class:"hover:underline text-xxs"},{default:n(()=>[_(" @"+a(o.users.username),1)]),_:2},1032,["to"]),jo,s(i,{to:(o.type==="artwork"?"/a/":"/feed/")+o.id,class:"hover:underline text-xxs"},{default:n(()=>[_(a(e.formatDate(o.scheduled_post?o.scheduled_post:o.created_at,!0)),1)]),_:2},1032,["to"])])])):u("",!0),o.type==="artwork"?(r(),c("div",Jo,[t("span",Ko,a(o.title),1),w(t("p",null,[t("span",{id:"feed-description-"+o.id},a(o.description.length>300?`${o.description.slice(0,300)}...`:o.description),9,qo),o.description.length>300?(r(),c("a",{key:0,id:"feed-read-more-"+o.id,class:"href",onClick:b(p=>P(o.description,o.id,"feed-read-more-","feed-description-"),["prevent"])},a(e.$t("readMore")),9,Wo)):u("",!0)],512),[[f,o.description]])])):u("",!0),t("div",null,[t("div",null,[o.type==="artwork"&&!e.isMobile()?(r(),c("div",{key:0,class:"cursor-pointer",onClick:b(p=>A(o.id),["prevent"])},[s(L,{class:"p-2 md:p-4",work:o},null,8,["work"])],8,Qo)):u("",!0),o.type==="artwork"&&e.isMobile()?(r(),T(i,{key:1,to:"/a/"+o.id,class:"cursor-pointer"},{default:n(()=>[s(L,{class:"p-2",work:o},null,8,["work"])]),_:2},1032,["to"])):u("",!0)])]),o.type==="feed"?(r(),c("div",Xo,[w(t("p",{class:M(["mt-2",{"mb-2":!o.artwork_share_info}])},a(o.text),3),[[f,o.text]]),o.artwork_share_info?(r(),c("div",Yo,[o.artwork_share_info.user?(r(),c("div",Zo,[s(i,{to:"/profile/"+o.artwork_share_info.user.username},{default:n(()=>[t("img",{class:"avatar",src:e.avatarCoverUrl(o.artwork_share_info.user.avatar_bucket,o.artwork_share_info.user.avatar_filename),onError:l[1]||(l[1]=(...p)=>e.imageLoadError&&e.imageLoadError(...p))},null,40,oe)]),_:2},1032,["to"]),t("div",ee,[s(i,{to:"/profile/"+o.artwork_share_info.user.username,class:"fullname hover:href"},{default:n(()=>[_(a(o.artwork_share_info.user.name),1)]),_:2},1032,["to"]),te,s(i,{to:"/profile/"+o.artwork_share_info.user.username,class:"hover:underline text-xxs"},{default:n(()=>[_(" @"+a(o.artwork_share_info.user.username),1)]),_:2},1032,["to"]),se,s(i,{to:"/a/"+o.artwork_share_info.id,class:"hover:underline text-xxs"},{default:n(()=>[_(a(e.formatDate(o.artwork_share_info.scheduled_post?o.artwork_share_info.scheduled_post:o.artwork_share_info.created_at,!0)),1)]),_:2},1032,["to"])])])):u("",!0),t("div",ie,[t("span",ae,a(o.artwork_share_info.title),1),w(t("p",null,[t("span",{id:"feed-description-"+o.artwork_share_info.id},a(o.artwork_share_info.description.length>300?`${o.artwork_share_info.description.slice(0,300)}...`:o.artwork_share_info.description),9,le),o.artwork_share_info.description.length>300?(r(),c("a",{key:0,id:"feed-read-more-"+o.artwork_share_info.id,class:"href",onClick:b(p=>P(o.artwork_share_info.description,o.artwork_share_info.id,"feed-read-more-","feed-description-"),["prevent"])},a(e.$t("readMore")),9,re)):u("",!0)],512),[[f,o.artwork_share_info.description]])]),t("div",null,[e.isMobile()?u("",!0):(r(),c("div",{key:0,class:M(["p-2",{"cursor-pointer":!o.apply_explicit_filter}]),onClick:b(p=>A(o.artwork_share_info.id,o.apply_explicit_filter,h),["prevent"])},[t("div",{class:M(["overflow-hidden relative p-2 rounded-md",{"md:mx-2":o.apply_explicit_filter}])},[s(L,{class:M([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(r(),c("div",ce,[t("div",null,a(F(x).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",de,a(e.$t("explicitShowMeThisContent")),1)])):u("",!0)],2)],10,ne)),e.isMobile()?(r(),T(i,{key:1,to:o.apply_explicit_filter?null:"/a/"+o.artwork_share_info.id,onClick:b(p=>A(o.artwork_share_info.id,o.apply_explicit_filter,h),["prevent"]),class:"cursor-pointer"},{default:n(()=>[t("div",{class:M(["overflow-hidden relative p-2 rounded-md",{"m-2":o.apply_explicit_filter}])},[s(L,{class:M([{"blur-3xl unclickable":o.apply_explicit_filter},o.apply_explicit_filter?"brightness-50":"brightness-100"]),work:o},null,8,["class","work"]),o.apply_explicit_filter?(r(),c("div",ue,[t("div",null,a(F(x).loggedIn?e.$t("explicitContentAlert"):e.$t("explicitContentAlertForGuest")),1),t("button",pe,a(e.$t("explicitShowMeThisContent")),1)])):u("",!0)],2)]),_:2},1032,["to","onClick"])):u("",!0)])])):u("",!0)])):u("",!0),t("div",_e,[F(x).loggedIn?(r(),c("div",he,[t("span",{onClick:p=>o.type==="artwork"?m.value.includes("a-"+o.id)?G("a-"+o.id,o.type):z("a-"+o.id,o.type):m.value.includes("f-"+o.id)?G("f-"+o.id,o.type):z("f-"+o.id,o.type)},[w(s(k,{id:"feed-like-button-"+o.type+"-"+o.id,name:"i-ion-heart",class:"mr-1 text-red-500 hover:text-red-500"},null,8,["id"]),[[f,o.type==="artwork"?m.value.includes("a-"+o.id):m.value.includes("f-"+o.id)]]),w(s(k,{name:"i-ion-heart-outline",class:"mr-1 icon-color hover:text-red-500"},null,512),[[f,o.type==="artwork"?!m.value.includes("a-"+o.id):!m.value.includes("f-"+o.id)]]),_(" "+a(e.thousand(o._count.likes)),1)],8,me),t("span",{onClick:b(p=>o.type==="artwork"?A(o.id):X(o.id),["prevent"])},[s(k,{name:"i-mdi-comment-multiple-outline",class:"mr-1 icon-color hover:text-blue-500"}),_(" "+a(e.thousand(o._count.comments)),1)],8,ve),o.type==="artwork"?(r(),c("span",{key:0,onClick:p=>eo(o.id)},[w(s(k,{id:"save-to-collection-button-"+o.id,name:"i-ion-bookmark",class:"text-blue-500 hover:text-blue-500"},null,8,["id"]),[[f,g.value.includes(o.id)]]),w(s(k,{name:"i-majesticons-bookmark-line",class:"icon-color hover:text-blue-500"},null,512),[[f,!g.value.includes(o.id)]])],8,ke)):u("",!0),t("div",we,[t("button",fe,[t("span",null,[s(k,{name:"i-uit-ellipsis-v",class:"align-middle icon icon-color"})])]),t("div",xe,[t("div",ge,[t("div",ye,[s(i,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,class:"flex py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:n(()=>[s(k,{name:"i-fluent-arrow-enter-20-filled",class:"mr-2 text-base"}),_(" "+a(e.$t("open")),1)]),_:2},1032,["to"]),s(i,{to:o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id,target:"_blank",class:"flex z-20 py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:n(()=>[s(k,{name:"i-ci-external-link",class:"mr-2 text-base"}),_(" "+a(e.$t("openInNewTab")),1)]),_:2},1032,["to"]),be,t("a",{class:"flex py-2 px-3 w-full leading-4 rounded-md transition-all duration-150 cursor-pointer hover:button-color parent-icon hover:text-white",onClick:p=>Z(o.type==="artwork"?"/a/"+o.id:"/feed/"+o.id)},[s(k,{name:"i-icon-park-outline-copy",class:"mr-2 text-base"}),_(" "+a(e.$t("copySharableLink")),1)],8,Me)])])])])])):u("",!0)])])])]))),128)),s(d,null,{default:n(()=>[s(F(Ro),{class:"mt-6",load:Q},{loading:n(()=>[t("div",Ce,[s(k,{name:"i-line-md-loading-twotone-loop",class:"text-3xl"})])]),"no-results":n(()=>[t("div",Ie,a(e.$t("feeds.nothingToShow")),1)]),"no-more":n(()=>[t("div",$e,[_(a(e.$t("youHaveReachedTheEnd"))+" ",1),Se,_(" "+a(e.$t("feeds.followMorePeople")),1)])]),_:1})]),_:1}),t("div",Ae,[s(Co,{ref_key:"chronologicalModalViewRef",ref:D,section:"chronological"},null,512)]),t("div",Fe,[s(Vo,{ref_key:"chronologicalFeedModalViewRef",ref:O,section:"chronological-feed"},null,512)]),s(Io,{id:"feed-collection-selection-modal","modal-id":"feed-collection-selection-modal",ref_key:"collectionSelectionModalRef",ref:H,"work-id":S.value,class:"modal",onSave:to},null,8,["work-id"])])])]),_:1},8,["hide-side"])],1024)}}},Ge=j(Le,[["__scopeId","data-v-2adc7817"]]);export{Ge as default};
