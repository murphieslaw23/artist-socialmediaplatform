import{K,i as T,j,l as N,r as l,I as H,ad as E,o as v,m as W,p as r,t as m,e as f,w as B,q as R,J as b,s as U,b as y,v as k,G as _,x as Q,c as L,T as X,D as Y,u as Z}from"./entry.0330daa5.js";import{L as $}from"./Layout.95a54192.js";import{u as ee}from"./useArtwork.3ef797ef.js";import{W as oe,M as te}from"./ModalView.e8f58535.js";import{_ as ae}from"./LoadingEmptyErrorMessage.265d2132.js";import{_ as ne}from"./_plugin-vue_export-helper.a1a6add7.js";import{u as ie}from"./useUser.7fe57f48.js";import"./Spinner.bde24df9.js";import"./user-counters-api.f82a6d2e.js";import"./useFeed.e06a7783.js";const se={components:{Icon:K,WorkList:oe,ModalView:te,LoadingEmptyErrorMessage:ae},props:{title:{type:String,default:""},section:{type:String,default:""},paginationProp:{type:Object,default(){return{perPage:{type:Number,default:6},maxLoadMore:{type:Number,default:5}}}},discoverRoute:{type:String,default:"/"}},setup(t){const o=T(),{oApiConfiguration:a,fetchOptions:e}=j(),M=ee(a,e());N(async()=>{await g()});const h=l([]),g=async()=>{const n=await P();if(n){const u=n.works,s=n.pagination;h.value=u,s.record_total<=i.perPage&&x(),s.record_total===0&&z()}else F()},p=l(!0),c=l(void 0),i=H({perPage:t.paginationProp.perPage,page:l(0)}),P=async()=>{i.page===0&&(p.value=!0);try{let n,u;if(t.section==="recent"){const[s,w]=await M.getLatest({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});s?n=s:u=w}else if(t.section==="following"){const[s,w]=await M.getFollowing({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});s?n=s:u=w}else if(t.section==="popular"){const[s,w]=await M.getMostPopular({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value,range:"daily",rangeMode:"none"});s?n=s:u=w}return i.page+=1,G(),n}catch{F()}},d=l({delay:!1,maxLoad:t.paginationProp.maxLoadMore,showDiscoveryButton:!1}),q=async()=>{d.value.delay=!0;const n=await P(),u=n.works,s=n.pagination;u.forEach(w=>{h.value.push(w)}),d.value.delay=!1,s.next_previous.next_page||x(),s.next_previous.next_page&&s.current_page===d.value.maxLoad&&(x(),d.value.showDiscoveryButton=!0)},V=l(!0),x=()=>{V.value=!1},C=l(!1),z=()=>{C.value=!0,x()},A=l(!1),F=()=>{p.value=!1,A.value=!0,x()},G=()=>{p.value=!1,C.value=!1,A.value=!1},J=n=>{c.value=n,i.page=0,V.value=!0,d.value.showDiscoveryButton=!1,g()},I=l(null),S=l(null),O=l(null);return{auth:o,loading:p,explicitMode:c,changeExplicitMode:J,fetchTop:g,pagination:i,works:h,loadMoreOptions:d,showLoadMoreButton:V,loadMore:q,isEmpty:C,isError:A,recentModalViewRef:I,followingModalViewRef:S,popularModalViewRef:O,view:(n,u=!1)=>{t.section==="recent"&&I.value.view(n,u),t.section==="following"&&S.value.view(n,u),t.section==="popular"&&O.value.view(n,u),_().openModal(`${t.section}-modal`)}}}},re={id:"lists"},le={class:"navigations"},ce={class:"title hidden-md-flex"},de={class:"buttons"},ue={key:0,class:"filter-buttons"},pe={class:"hidden-md-flex"},fe=["id"];function ge(t,o,a,e,M,h){const g=E("Icon"),p=Q,c=E("LoadingEmptyErrorMessage"),i=E("WorkList"),P=E("ModalView");return v(),W("div",null,[r("div",re,[r("div",le,[r("div",ce,m(a.title),1),f(p,{to:a.discoverRoute,class:"flex flex-row justify-between title md:hidden"},{default:B(()=>[R(m(a.title)+" ",1),f(g,{name:"i-fluent-arrow-enter-20-filled",class:"text-xl text-colored"})]),_:1},8,["to"]),r("div",de,[e.auth.loggedIn&&e.auth.user.user_settings&&e.auth.user.user_settings.show_explicit?(v(),W("div",ue,[r("p",{class:b(["rounded-l-md button-item",[e.explicitMode===void 0?"button":"theme-color"]]),onClick:o[0]||(o[0]=d=>e.changeExplicitMode(void 0))},m(t.$t("default")),3),r("p",{class:b(["button-item",[e.explicitMode==="safe"?"button":"theme-color"]]),onClick:o[1]||(o[1]=d=>e.changeExplicitMode("safe"))},m(t.$t("safe")),3),r("p",{class:b(["rounded-r-md button-item",[e.explicitMode==="explicit"?"button":"theme-color"]]),onClick:o[2]||(o[2]=d=>e.changeExplicitMode("explicit"))},m(t.$t("explicit")),3)])):U("",!0),r("div",pe,[f(p,{class:"discover-button",to:a.discoverRoute},{default:B(()=>[R(m(t.$t("seeMore")),1)]),_:1},8,["to"])])])]),f(c,{loading:e.loading,empty:e.isEmpty,error:e.isError,fetch:e.fetchTop},null,8,["loading","empty","error","fetch"]),y(r("div",null,[y(f(i,{"section-class":"work-grid",works:e.works,view:e.view},null,8,["works","view"]),[[k,!e.isEmpty]]),y(r("div",{class:b(["primary-button md:mt-4",e.loadMoreOptions.delay?"animate-pulse":""]),onClick:o[3]||(o[3]=(...d)=>e.loadMore&&e.loadMore(...d))},m(t.$t("loadMore")),3),[[k,e.showLoadMoreButton]]),y(r("div",null,[f(p,{to:"/works/"+a.section,class:"flex-row justify-center primary-button md:mt-4"},{default:B(()=>[f(g,{name:"i-fluent-arrow-enter-20-filled",class:"mr-1 text-white hover:text-white"}),R(" "+m(t.$t("seeMore")),1)]),_:1},8,["to"])],512),[[k,e.loadMoreOptions.showDiscoveryButton]])],512),[[k,!e.loading]]),r("div",{id:a.section+"-modal",class:"modal work-view"},[y(f(P,{ref:a.section+"ModalViewRef",section:a.section},null,8,["section"]),[[k,!e.loading]])],8,fe)])])}const D=ne(se,[["render",ge],["__scopeId","data-v-01406299"]]),me={__name:"Recent",setup(t){const o={perPage:20,maxLoadMore:4};return(a,e)=>(v(),L(D,{section:"recent",title:a.$t("artworks.recentArtworks"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/recent"},null,8,["title","pagination-prop"]))}},we={__name:"Following",setup(t){const o={perPage:10,maxLoadMore:4};return(a,e)=>(v(),L(D,{section:"following",title:a.$t("following"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/following","custom-empty-message":a.$t("explores.noFollowing")},null,8,["title","pagination-prop","custom-empty-message"]))}},_e={__name:"Popular",setup(t){const o={perPage:10,maxLoadMore:4};return(a,e)=>(v(),L(D,{section:"popular",title:a.$t("artworks.dailyPopular"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/popular"},null,8,["title","pagination-prop"]))}},ve={class:"flex flex-col mt-2 w-full"},Ce={__name:"index",setup(t){const o=T(),{oApiConfiguration:a,fetchOptions:e}=j(),M=ie(a,e());N(()=>{o.loggedIn&&p()});const h=X();Y(()=>h.query,c=>{setTimeout(()=>{_().closeModal("recent-modal"),_().closeModal("popular-modal"),_().closeModal("following-modal"),_().closeModal("collection-selection-modal"),_().closeModal("album-selection-modal"),_().closeModal("report-modal")},50)});const g=l(!1),p=async()=>{const[c,i]=await M.getFollowingList({userId:o.user.id,pagination:{page:0,perPage:1}});g.value=c.pagination.record_total>0};return(c,i)=>(v(),L($,{"with-footer":!0,"hide-side":!0,"no-right-side":!0,fullscreen:!0},{default:B(()=>[r("div",ve,[f(me,{class:"mb-10"}),Z(o).loggedIn&&g.value?(v(),L(we,{key:0,class:"mb-10"})):U("",!0),f(_e)])]),_:1}))}};export{Ce as default};
