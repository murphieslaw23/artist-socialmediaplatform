import{K,i as T,j,l as N,r as l,I as H,a6 as E,o as M,m as W,p as r,t as w,e as g,w as B,q as R,J as b,s as U,b as y,v as k,G as v,x as Q,c as L,T as X,D as Y,u as Z}from"./entry.5623c43b.js";import{L as $}from"./Layout.9dc0b07b.js";import{u as ee}from"./useArtwork.c6dabd54.js";import{W as oe,M as te}from"./ModalView.e0efa61b.js";import{_ as ae}from"./LoadingEmptyErrorMessage.624c7a79.js";import{_ as ne}from"./_plugin-vue_export-helper.a1a6add7.js";import{u as ie}from"./useUser.a176b840.js";import"./Spinner.9c298f14.js";import"./user-counters-api.61874665.js";import"./useFeed.ffb7a57e.js";const se={components:{Icon:K,WorkList:oe,ModalView:te,LoadingEmptyErrorMessage:ae},props:{title:{type:String,default:""},section:{type:String,default:""},paginationProp:{type:Object,default(){return{perPage:{type:Number,default:6},maxLoadMore:{type:Number,default:5}}}},discoverRoute:{type:String,default:"/"}},setup(t){const o=T(),{oApiConfiguration:a,fetchOptions:e}=j(),m=ee(a,e());N(async()=>{await f()});const h=l([]),f=async()=>{const n=await P();if(n){const u=n.works,s=n.pagination;h.value=u,s.record_total<=i.perPage&&x(),s.record_total===0&&z()}else F()},p=l(!0),c=l(void 0),i=H({perPage:t.paginationProp.perPage,page:l(0)}),P=async()=>{i.page===0&&(p.value=!0);try{let n,u;if(t.section==="recent"){const[s,_]=await m.getLatest({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});s?n=s:u=_}else if(t.section==="following"){const[s,_]=await m.getFollowing({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value});s?n=s:u=_}else if(t.section==="popular"){const[s,_]=await m.getMostPopular({pagination:{page:i.page,perPage:i.perPage},explicitMode:c.value,range:"daily",rangeMode:"none"});s?n=s:u=_}return i.page+=1,G(),n}catch{F()}},d=l({delay:!1,maxLoad:t.paginationProp.maxLoadMore,showDiscoveryButton:!1}),q=async()=>{d.value.delay=!0;const n=await P(),u=n.works,s=n.pagination;u.forEach(_=>{h.value.push(_)}),d.value.delay=!1,s.next_previous.next_page||x(),s.next_previous.next_page&&s.current_page===d.value.maxLoad&&(x(),d.value.showDiscoveryButton=!0)},V=l(!0),x=()=>{V.value=!1},C=l(!1),z=()=>{C.value=!0,x()},A=l(!1),F=()=>{p.value=!1,A.value=!0,x()},G=()=>{p.value=!1,C.value=!1,A.value=!1},J=n=>{c.value=n,i.page=0,V.value=!0,d.value.showDiscoveryButton=!1,f()},I=l(null),S=l(null),O=l(null);return{auth:o,loading:p,explicitMode:c,changeExplicitMode:J,fetchTop:f,pagination:i,works:h,loadMoreOptions:d,showLoadMoreButton:V,loadMore:q,isEmpty:C,isError:A,recentModalViewRef:I,followingModalViewRef:S,popularModalViewRef:O,view:(n,u=!1)=>{t.section==="recent"&&I.value.view(n,u),t.section==="following"&&S.value.view(n,u),t.section==="popular"&&O.value.view(n,u),v().openModal(`${t.section}-modal`)}}}},re={id:"lists"},le={class:"navigations"},ce={class:"title hidden-md-flex"},de={class:"buttons"},ue={key:0,class:"filter-buttons"},pe={class:"hidden-md-flex"},ge=["id"];function fe(t,o,a,e,m,h){const f=E("Icon"),p=Q,c=E("LoadingEmptyErrorMessage"),i=E("WorkList"),P=E("ModalView");return M(),W("div",null,[r("div",re,[r("div",le,[r("div",ce,w(a.title),1),g(p,{to:a.discoverRoute,class:"flex flex-row justify-between title md:hidden"},{default:B(()=>[R(w(a.title)+" ",1),g(f,{name:"i-fluent-arrow-enter-20-filled",class:"text-xl text-colored"})]),_:1},8,["to"]),r("div",de,[e.auth.loggedIn&&e.auth.user.user_settings&&e.auth.user.user_settings.show_explicit?(M(),W("div",ue,[r("p",{class:b(["rounded-l-md button-item",[e.explicitMode===void 0?"button":"theme-color"]]),onClick:o[0]||(o[0]=d=>e.changeExplicitMode(void 0))},w(t.$t("default")),3),r("p",{class:b(["button-item",[e.explicitMode==="safe"?"button":"theme-color"]]),onClick:o[1]||(o[1]=d=>e.changeExplicitMode("safe"))},w(t.$t("safe")),3),r("p",{class:b(["rounded-r-md button-item",[e.explicitMode==="explicit"?"button":"theme-color"]]),onClick:o[2]||(o[2]=d=>e.changeExplicitMode("explicit"))},w(t.$t("explicit")),3)])):U("",!0),r("div",pe,[g(p,{class:"discover-button",to:a.discoverRoute},{default:B(()=>[R(w(t.$t("seeMore")),1)]),_:1},8,["to"])])])]),g(c,{loading:e.loading,empty:e.isEmpty,error:e.isError,fetch:e.fetchTop},null,8,["loading","empty","error","fetch"]),y(r("div",null,[y(g(i,{"section-class":"work-grid",works:e.works,view:e.view},null,8,["works","view"]),[[k,!e.isEmpty]]),y(r("div",{class:b(["primary-button md:mt-4",e.loadMoreOptions.delay?"animate-pulse":""]),onClick:o[3]||(o[3]=(...d)=>e.loadMore&&e.loadMore(...d))},w(t.$t("loadMore")),3),[[k,e.showLoadMoreButton]]),y(r("div",null,[g(p,{to:"/works/"+a.section,class:"flex-row justify-center primary-button md:mt-4"},{default:B(()=>[g(f,{name:"i-fluent-arrow-enter-20-filled",class:"mr-1 text-white hover:text-white"}),R(" "+w(t.$t("seeMore")),1)]),_:1},8,["to"])],512),[[k,e.loadMoreOptions.showDiscoveryButton]])],512),[[k,!e.loading]]),r("div",{id:a.section+"-modal",class:"modal work-view"},[y(g(P,{ref:a.section+"ModalViewRef",section:a.section},null,8,["section"]),[[k,!e.loading]])],8,ge)])])}const D=ne(se,[["render",fe],["__scopeId","data-v-01406299"]]),me={__name:"Recent",setup(t){const o={perPage:12,maxLoadMore:4};return(a,e)=>(M(),L(D,{section:"recent",title:a.$t("artworks.recentArtworks"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/recent"},null,8,["title","pagination-prop"]))}},we={__name:"Following",setup(t){const o={perPage:12,maxLoadMore:4};return(a,e)=>(M(),L(D,{section:"following",title:a.$t("following"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/following","custom-empty-message":a.$t("explores.noFollowing")},null,8,["title","pagination-prop","custom-empty-message"]))}},_e={__name:"Popular",setup(t){const o={perPage:12,maxLoadMore:4};return(a,e)=>(M(),L(D,{section:"popular",title:a.$t("artworks.dailyPopular"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/popular"},null,8,["title","pagination-prop"]))}},ve={class:"flex flex-col mt-2"},Ce={__name:"index",setup(t){const{oApiConfiguration:o,fetchOptions:a}=j(),e=ie(o,a()),m=T();N(()=>{m.loggedIn&&p()});const h=X();Y(()=>h.query,c=>{setTimeout(()=>{v().closeModal("recent-modal"),v().closeModal("popular-modal"),v().closeModal("following-modal"),v().closeModal("collection-selection-modal"),v().closeModal("album-selection-modal"),v().closeModal("report-modal")},50)});const f=l(!1),p=async()=>{const[c,i]=await e.getFollowingList({userId:m.user.id,pagination:{page:0,perPage:1}});f.value=c.pagination.record_total>0};return(c,i)=>(M(),L($,{"with-footer":!0,"hide-side":!0,"no-right-side":!0},{default:B(()=>[r("div",ve,[g(me,{class:"mb-10"}),Z(m).loggedIn&&f.value?(M(),L(we,{key:0,class:"mb-10"})):U("",!0),g(_e)])]),_:1}))}};export{Ce as default};
