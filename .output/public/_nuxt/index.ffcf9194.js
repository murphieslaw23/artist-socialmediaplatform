import{o as f,p as b,q as e,e as x,L as N,k as H,j as O,r as _,t,u as s,b as i,v as d,K as m,x as q,P,Q as B,s as j,F as U,H as z,f as J,a as W,m as X,D as Y,c as T,w as Z,G as V,M as ee,N as se}from"./entry.15cb71bb.js";import{u as G}from"./useReport.6a600d64.js";import{u as L}from"./useI18n.93778397.js";import{L as te}from"./Layout.69b2e7d1.js";import{_ as K}from"./LoadingEmptyErrorMessage.31b597d2.js";import{_ as Q}from"./_plugin-vue_export-helper.a1a6add7.js";import"./client-only.407c3fea.js";import"./Spinner.cb390d69.js";const oe={class:"flex float-right flex-row gap-2 mb-2 cursor-pointer"},le={__name:"CloseModalButton",emits:["close"],setup(k,{emit:u}){const I=()=>{u("close")};return($,R)=>(f(),b("div",oe,[e("div",{class:"modal-close",onClick:R[0]||(R[0]=M=>I())},[x(N,{name:"i-ion-close",class:"text-2xl"})])]))}};const re={class:"w-full modal-layer xl:w-3/12 lg:w-2/5"},ne={class:"flex flex-row justify-between w-full"},ae={class:"title"},ie={class:"report_detail"},de={class:"report_detail__badge"},ue={class:"report_detail__info"},pe={key:0},ce=["href"],ve={class:"tags"},_e={class:"tag"},fe={class:"my-4 custom-divider"},me={class:"flex flex-row gap-2 justify-between"},ge=["placeholder"],he={__name:"ReportDetailModal",emits:["refresh"],setup(k,{expose:u,emit:I}){const $=H(),{oApiConfiguration:R,fetchOptions:M}=O(),c=G(R,M()),g=_(!0),w=_(!1),r=_({}),y=_([]),D=async n=>{g.value=!0,w.value=!1;const[a,v]=await c.getReportById({reportId:n});v?w.value=!0:(r.value=a,y.value=a.reasons.split(",")),g.value=!1},p=_({response:0,description:""}),C=async()=>{const[n,a]=await c.reviewReport({reportId:r.value.id,response:p.value.response,responseDescription:p.value.description});a||(await D(r.value.id),z().closeModal("report-detail-modal"),I("refresh"))};return u({view:D}),(n,a)=>(f(),b("div",null,[e("button",{class:"hidden",onClick:a[0]||(a[0]=v=>D())}),e("div",re,[e("div",ne,[e("span",ae,t(n.$t("reports.reportDetail")),1),x(le,{onClose:a[1]||(a[1]=v=>n.closeModal("report-detail-modal"))})]),x(K,{loading:s(g),error:s(w)},null,8,["loading","error"]),i(e("div",ie,[e("div",de,[e("span",{class:m(s(r).status==="pending"?"bg-yellow-500":"bg-red-500")},t(s(r).status),3)]),e("div",ue,[e("section",null,[e("div",null,[e("label",null,t(n.$t("reports.reportId")),1),e("div",null," #"+t(s(r).id),1)]),e("div",null,[e("label",null,t(n.$t("reports.reportDate")),1),e("div",null,t(n.formatDate(s(r).created_at)),1)]),s(r).user_reported?(f(),b("div",pe,[e("label",null,t(n.$t("reports.userReporting")),1),e("div",null,t(s(r).user_reported.username),1)])):q("",!0),e("div",null,[e("label",null,t(n.$t("reports.reportedPost")),1),e("div",null,[i(e("span",{class:"italic"},t(n.$t("reports.postRemoved")),513),[[d,s(r).is_removed]]),i(e("a",{href:(s(r).type==="artwork"?"/a/":"/feed/")+s(r).post_id,target:"blank",class:"href"},t(n.$t("reports.viewPost")),9,ce),[[d,!s(r).is_removed]])])]),e("div",null,[e("label",null,t(n.$t("reports.reportDescription")),1),e("div",null,t(s(r).description),1)]),e("div",null,[e("label",null,t(n.$t("reports.selectedReasons")),1),e("div",ve,[(f(!0),b(P,null,B(s(y),v=>(f(),b("span",_e,t(n.$t("reports.reasons."+v)),1))),256))])])]),i(e("div",fe,null,512),[[d,(s($).user.is_admin||s($).user.is_moderator)&&s(r).status==="pending"||s(r).status==="closed"]]),i(e("section",null,[e("div",me,[e("span",{class:m(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-green-500 cursor-pointer",{"bg-green-500 text-white":s(p).response===0}]),onClick:a[2]||(a[2]=v=>s(p).response=0)},[i(x(N,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[d,s(p).response===0]]),j(" "+t(n.$t("reports.decisions.doNotRemove")),1)],2),e("span",{class:m(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-red-500 cursor-pointer",{"bg-red-500 text-white":s(p).response===1}]),onClick:a[3]||(a[3]=v=>s(p).response=1)},[i(x(N,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[d,s(p).response===1]]),j(" "+t(n.$t("reports.decisions.remove")),1)],2)]),e("div",null,[i(e("textarea",{"onUpdate:modelValue":a[4]||(a[4]=v=>s(p).description=v),class:"form-input input textarea",rows:"5",cols:"0",placeholder:n.$t("description"),"data-gramm":"false"},null,8,ge),[[U,s(p).description]])]),e("button",{class:m(s(p).description?"primary-button":"disabled-button"),onClick:a[5]||(a[5]=v=>C())},t(n.$t("reports.submitReviewAndClose")),3)],512),[[d,(s($).user.is_admin||s($).user.is_moderator)&&s(r).status==="pending"]]),i(e("section",null,[e("div",null,[e("label",null,t(n.$t("reports.decision")),1),e("div",null,[e("span",{class:m(["font-bold uppercase",s(r).response?"text-green-500":"text-red-500"])},t(s(r).response?"Removed":"Not removed"),3)])]),e("div",null,[e("label",null,t(n.$t("description")),1),e("div",null,t(s(r).response_description),1)]),e("div",null,[e("label",null,t(n.$t("reports.decisionMadeAt")),1),e("div",null,t(n.formatDate(s(r).responded_at)),1)])],512),[[d,s(r).status==="closed"]])])],512),[[d,!s(g)]])])]))}},be=Q(he,[["__scopeId","data-v-229fbd6f"]]);const E=k=>(ee("data-v-63658e62"),k=k(),se(),k),$e={class:"reports"},we={class:"reports__title"},ye=E(()=>e("div",{class:"reports__filters"},null,-1)),ke={class:"reports__list"},Re={class:"hidden-md-flex"},De={class:"reports__table",cellspacing:"0",cellpadding:"0"},Ce={class:"rounded-l-md"},xe=E(()=>e("th",null,[e("div",{class:"rounded-r-md"},"\xA0")],-1)),Ie={class:"rounded-l-md"},Me=["onClick"],Ae=["href"],Ne=["href"],Pe={class:"font-bold uppercase"},Be={class:"font-bold uppercase"},Ee={class:"rounded-r-md"},Fe=["onClick"],Se=["href"],je={class:"text-right md:text-left"},Te={class:"font-bold uppercase"},Ve={class:"font-bold uppercase"},Le=E(()=>e("label",null,"\xA0",-1)),He=["href"],Oe=["onClick"],qe={class:"reports__pagination"},ze={__name:"index",setup(k){const u=H(),{oApiConfiguration:I,fetchOptions:$}=O(),R=G(I,$());J({title:u.user.is_admin||u.user.is_moderator?L().tl("reports.reports"):L().tl("reports.yourReports")});const{$router:M}=W();X(async()=>{u.loggedIn?await y():M.push("/")});const c=_({loading:!1,pagination:{page:0,perPage:10}}),g=_({status:"all",filterDateFrom:void 0,filterDateTo:void 0,userId:Y(()=>{if(u.loggedIn&&!u.user.is_admin&&!u.user.is_moderator)return u.user.id}),selectedReasons:void 0}),w=_([]),r=_({}),y=async()=>{p(),c.value.loading=!0;const[l,h,o]=await R.getReports({status:g.value.status,createdAtFrom:g.value.filterDateFrom,createdAtTo:g.value.filterDateTo,userId:g.value.userId,reasons:g.value.selectedReasons,pagination:{page:c.value.pagination.page,perPage:c.value.pagination.perPage}});o?v():(h.record_total<=0&&n(),w.value=l,r.value=h),c.value.loading=!1},D=async l=>{l==="next"?c.value.pagination.page++:c.value.pagination.page--,await y()},p=()=>{C.value=!1,a.value=!1},C=_(!1),n=()=>{C.value=!0},a=_(!1),v=()=>{a.value=!0},F=_(null),A=l=>{F.value.view(l),z().openModal("report-detail-modal")};return(l,h)=>(f(),T(te,{"hide-side":!0,"no-right-side":!0},{default:Z(()=>[e("div",$e,[e("div",we,t(s(u).user.is_admin||s(u).user.is_moderator?l.$t("reports.reports"):l.$t("reports.yourReports")),1),ye,e("div",ke,[i(e("div",null,[e("div",Re,[e("table",De,[e("thead",null,[e("tr",null,[e("th",null,[e("div",Ce,t(l.$t("reports.reportId")),1)]),e("th",null,[e("div",null,t(l.$t("reports.reportDate")),1)]),i(e("th",null,[e("div",null,t(l.$t("reports.user")),1)],512),[[d,s(u).user.is_moderator&&s(u).user.is_admin]]),e("th",null,[e("div",null,t(l.$t("reports.post")),1)]),e("th",null,[e("div",null,t(l.$t("reports.description")),1)]),e("th",null,[e("div",null,t(l.$t("reports.status")),1)]),e("th",null,[e("div",null,t(l.$t("reports.decision")),1)]),xe])]),e("tbody",null,[(f(!0),b(P,null,B(s(w),o=>(f(),b("tr",{key:o.id},[e("td",null,[e("div",Ie,[e("a",{class:"font-bold hover:underline href",onClick:V(S=>A(o.id),["prevent"])}," #"+t(o.id),9,Me)])]),e("td",null,[e("div",null,t(l.formatDate(o.created_at)),1)]),i(e("td",null,[e("div",null,[e("a",{href:"/profile/"+o.user_reported.username,target:"blank",class:"font-bold href"},t(o.user_reported.username),9,Ae)])],512),[[d,s(u).user.is_moderator&&s(u).user.is_admin]]),e("td",null,[e("div",null,[i(e("span",{class:"italic"},t(l.$t("reports.postRemoved")),513),[[d,o.is_removed]]),i(e("a",{href:(o.type==="artwork"?"/a/":"/feed/")+o.post_id,target:"blank",class:"href"},t(l.$t("reports.viewPost")),9,Ne),[[d,!o.is_removed]])])]),e("td",null,[e("div",null,t(o.description.length>300?`${o.description.slice(0,300)}...`:o.description),1)]),e("td",Pe,[e("div",null,[e("span",{class:m(["text-white uppercase badge text-xxs",o.status==="pending"?"bg-yellow-500":"bg-red-500"])},t(o.status),3)])]),e("td",null,[e("div",Be,[i(e("span",null,"-",512),[[d,o.status==="pending"]]),i(e("span",{class:m(["text-white uppercase badge text-xxs",o.response?"bg-green-500":"bg-red-500"])},t(o.response?"Removed":"Not removed"),3),[[d,o.status==="closed"]])])]),e("td",Ee,[e("div",null,[e("a",{class:"underline href",onClick:V(S=>A(o.id),["prevent"])},t(l.$t("reports.moreInfo")),9,Fe)])])]))),128))])])]),(f(!0),b(P,null,B(s(w),o=>(f(),b("div",{key:o.id,class:"reports__cards"},[e("div",null,[e("label",null,t(l.$t("reports.user")),1),e("div",null,[e("a",{href:"/profile/"+o.user_reported.username,target:"blank",class:"font-bold href"},t(o.user_reported.username),9,Se)])]),e("div",null,[e("label",null,t(l.$t("reports.description")),1),e("div",je,t(o.description),1)]),e("div",null,[e("label",null,t(l.$t("reports.reportDate")),1),e("div",null,t(l.formatDate(o.created_at)),1)]),e("div",null,[e("label",null,t(l.$t("reports.status")),1),e("div",Te,[e("div",{class:m(["text-white uppercase badge text-xxs",o.status==="pending"?"bg-yellow-500":"bg-red-500"])},t(o.status),3)])]),e("div",null,[e("label",null,t(l.$t("reports.decision")),1),e("div",Ve,[e("span",{class:m(["text-white uppercase badge text-xxs",o.response?"bg-green-500":"bg-red-500"])},t(o.response?"Removed":"Not removed"),3)])]),e("div",null,[Le,e("div",null,[i(e("span",{class:"mr-2 italic"},t(l.$t("reports.postRemoved")),513),[[d,o.is_removed]]),i(e("a",{href:(o.type==="artwork"?"/a/":"/feed/")+o.post_id,target:"blank",class:"mr-2 underline href"},t(l.$t("reports.viewReportedPost")),9,He),[[d,!o.is_removed]]),e("div",{class:"underline href",onClick:S=>A(o.id)},t(l.$t("reports.moreInfo")),9,Oe)])])]))),128)),i(e("div",qe,[e("button",{class:m(s(r).next_previous&&s(r).next_previous.prev_page!==null?"primary-button":"disabled-button"),onClick:h[0]||(h[0]=o=>D("prev"))},t(l.$t("pagination.previous")),3),e("button",{class:m(s(r).next_previous&&s(r).next_previous.next_page!==null?"primary-button":"disabled-button"),onClick:h[1]||(h[1]=o=>D("next"))},t(l.$t("pagination.next")),3)],512),[[d,s(r).total_page>0]])],512),[[d,!s(c).loading&&!s(C)&&!s(a)]]),x(K,{loading:s(c).loading,empty:s(C),error:s(a),fetch:y},null,8,["loading","empty","error"])])]),s(c).loading?q("",!0):(f(),T(be,{key:0,id:"report-detail-modal",ref_key:"reportDetailModalRef",ref:F,class:"modal",onRefresh:h[2]||(h[2]=o=>y())},null,512))]),_:1}))}},Ze=Q(ze,[["__scopeId","data-v-63658e62"]]);export{Ze as default};
