import{o as c,l as b,m as e,b as D,h as j,i as L,r as m,t as s,J as _,q as O,s as r,v as i,M as A,N,u as g,p as S,E as K,G as q,a as U,k as H,C as Q,c as T,w as W,F as V,K as X,L as Y}from"./entry.6223ed1a.js";import{u as z,_ as Z}from"./ErrorMessages.bfcaa420.js";import{L as ee}from"./Layout.a1c8316b.js";import{_ as P}from"./Icon.afd4aa38.js";import{_ as G}from"./_plugin-vue_export-helper.a1a6add7.js";import"./Spinner.970c3495.js";const se={class:"flex float-right flex-row gap-2 mb-2 cursor-pointer"},te={__name:"CloseModalButton",emits:["close"],setup(w,{emit:u}){const R=()=>{u("close")};return($,y)=>(c(),b("div",se,[e("div",{class:"modal-close",onClick:y[0]||(y[0]=C=>R())},[D(P,{name:"i-ion-close",class:"text-2xl"})])]))}},le={class:"w-full modal-layer xl:w-3/12 lg:w-2/5"},oe={class:"flex flex-row justify-between w-full"},ne={class:"title"},ae={class:"report_detail"},re={class:"report_detail__badge"},ie={class:"report_detail__info"},de={key:0},ue=["href"],pe={class:"tags"},ve={class:"tag"},ce={class:"my-4 custom-divider"},_e={class:"flex flex-row gap-2 justify-between"},fe=["placeholder"],me={__name:"ReportDetailModal",emits:["refresh"],setup(w,{expose:u,emit:R}){const $=j(),{oApiConfiguration:y,fetchOptions:C}=L(),p=z(y,C()),o=m({}),k=m([]),f=async n=>{const[a,v]=await p.getReportById({reportId:n});v||(o.value=a,k.value=a.reasons.split(","))},d=m({response:0,description:""}),I=async()=>{const[n,a]=await p.reviewReport({reportId:o.value.id,response:d.value.response,responseDescription:d.value.description});a||(await f(o.value.id),q().closeModal("report-detail-modal"),R("refresh"))};return u({view:f}),(n,a)=>(c(),b("div",null,[e("button",{class:"hidden",onClick:a[0]||(a[0]=v=>f())}),e("div",le,[e("div",oe,[e("span",ne,s(n.$t("reports.reportDetail")),1),D(te,{onClose:a[1]||(a[1]=v=>n.closeModal("report-detail-modal"))})]),e("div",ae,[e("div",re,[e("span",{class:_(o.value.status==="pending"?"bg-yellow-500":"bg-red-500")},s(o.value.status),3)]),e("div",ie,[e("section",null,[e("div",null,[e("label",null,s(n.$t("reports.reportId")),1),e("div",null," #"+s(o.value.id),1)]),e("div",null,[e("label",null,s(n.$t("reports.reportDate")),1),e("div",null,s(n.formatDate(o.value.created_at)),1)]),o.value.user_reported?(c(),b("div",de,[e("label",null,s(n.$t("reports.userReporting")),1),e("div",null,s(o.value.user_reported.username),1)])):O("",!0),e("div",null,[e("label",null,s(n.$t("reports.reportedPost")),1),e("div",null,[r(e("span",{class:"italic"},s(n.$t("reports.postRemoved")),513),[[i,o.value.is_removed]]),r(e("a",{href:(o.value.type==="artwork"?"/a/":"/feed/")+o.value.post_id,target:"blank",class:"href"},s(n.$t("reports.viewPost")),9,ue),[[i,!o.value.is_removed]])])]),e("div",null,[e("label",null,s(n.$t("reports.reportDescription")),1),e("div",null,s(o.value.description),1)]),e("div",null,[e("label",null,s(n.$t("reports.selectedReasons")),1),e("div",pe,[(c(!0),b(A,null,N(k.value,v=>(c(),b("span",ve,s(n.$t("reports.reasons."+v)),1))),256))])])]),r(e("div",ce,null,512),[[i,(g($).user.is_admin||g($).user.is_moderator)&&o.value.status==="pending"||o.value.status==="closed"]]),r(e("section",null,[e("div",_e,[e("span",{class:_(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-green-500 cursor-pointer",{"bg-green-500 text-white":d.value.response===0}]),onClick:a[2]||(a[2]=v=>d.value.response=0)},[r(D(P,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,d.value.response===0]]),S(" "+s(n.$t("reports.decisions.doNotRemove")),1)],2),e("span",{class:_(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-red-500 cursor-pointer",{"bg-red-500 text-white":d.value.response===1}]),onClick:a[3]||(a[3]=v=>d.value.response=1)},[r(D(P,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,d.value.response===1]]),S(" "+s(n.$t("reports.decisions.remove")),1)],2)]),e("div",null,[r(e("textarea",{"onUpdate:modelValue":a[4]||(a[4]=v=>d.value.description=v),class:"form-input input textarea",rows:"5",cols:"0",placeholder:n.$t("description"),"data-gramm":"false"},null,8,fe),[[K,d.value.description]])]),e("button",{class:_(d.value.description?"primary-button":"disabled-button"),onClick:a[5]||(a[5]=v=>I())},s(n.$t("reports.submitReviewAndClose")),3)],512),[[i,(g($).user.is_admin||g($).user.is_moderator)&&o.value.status==="pending"]]),r(e("section",null,[e("div",null,[e("label",null,s(n.$t("reports.decision")),1),e("div",null,[e("span",{class:_(["font-bold uppercase",o.value.response?"text-green-500":"text-red-500"])},s(o.value.response?"Removed":"Not removed"),3)])]),e("div",null,[e("label",null,s(n.$t("description")),1),e("div",null,s(o.value.response_description),1)]),e("div",null,[e("label",null,s(n.$t("reports.decisionMadeAt")),1),e("div",null,s(n.formatDate(o.value.responded_at)),1)])],512),[[i,o.value.status==="closed"]])])])])]))}},ge=G(me,[["__scopeId","data-v-5dc58e33"]]);const B=w=>(X("data-v-b857b2ab"),w=w(),Y(),w),he={class:"reports"},be={class:"reports__title"},$e=B(()=>e("div",{class:"reports__filters"},null,-1)),we={class:"reports__list"},ye={class:"hidden-md-flex"},ke={class:"reports__table",cellspacing:"0",cellpadding:"0"},Re={class:"rounded-l-md"},De=B(()=>e("th",null,[e("div",{class:"rounded-r-md"},"\xA0")],-1)),Ce={class:"rounded-l-md"},Ie=["onClick"],xe=["href"],Me=["href"],Ae={class:"font-bold uppercase"},Ne={class:"font-bold uppercase"},Pe={class:"rounded-r-md"},Be=["onClick"],Ee=["href"],Fe={class:"font-bold uppercase"},Se={class:"font-bold uppercase"},Te=B(()=>e("label",null,"\xA0",-1)),Ve=["href"],je=["onClick"],Le={class:"reports__pagination"},Oe={__name:"index",setup(w){const u=j(),{oApiConfiguration:R,fetchOptions:$}=L(),y=z(R,$()),{$router:C}=U();H(async()=>{u.loggedIn?await d():C.push("/")});const p=m({loading:!1,pagination:{page:0,perPage:10}}),o=m({status:"all",filterDateFrom:void 0,filterDateTo:void 0,userId:Q(()=>{if(u.loggedIn&&!u.user.is_admin&&!u.user.is_moderator)return u.user.id}),selectedReasons:void 0}),k=m([]),f=m({}),d=async()=>{n(),p.value.loading=!0;const[l,h,t]=await y.getReports({status:o.value.status,createdAtFrom:o.value.filterDateFrom,createdAtTo:o.value.filterDateTo,userId:o.value.userId,reasons:o.value.selectedReasons,pagination:{page:p.value.pagination.page,perPage:p.value.pagination.perPage}});t?J():(h.record_total<=0&&v(),k.value=l,f.value=h),p.value.loading=!1},I=async l=>{l==="next"?p.value.pagination.page++:p.value.pagination.page--,await d()},n=()=>{a.value=!1,x.value=!1},a=m(!1),v=()=>{a.value=!0},x=m(!1),J=()=>{x.value=!0},E=m(null),M=l=>{E.value.view(l),q().openModal("report-detail-modal")};return(l,h)=>(c(),T(ee,{"hide-side":!0,"no-right-side":!0},{default:W(()=>[e("div",he,[e("div",be,s(g(u).user.is_admin||g(u).user.is_moderator?l.$t("reports.reports"):l.$t("reports.yourReports")),1),$e,e("div",we,[r(e("div",null,[e("div",ye,[e("table",ke,[e("thead",null,[e("tr",null,[e("th",null,[e("div",Re,s(l.$t("reports.reportId")),1)]),e("th",null,[e("div",null,s(l.$t("reports.reportDate")),1)]),r(e("th",null,[e("div",null,s(l.$t("reports.user")),1)],512),[[i,g(u).user.is_moderator&&g(u).user.is_admin]]),e("th",null,[e("div",null,s(l.$t("reports.post")),1)]),e("th",null,[e("div",null,s(l.$t("reports.description")),1)]),e("th",null,[e("div",null,s(l.$t("reports.status")),1)]),e("th",null,[e("div",null,s(l.$t("reports.decision")),1)]),De])]),e("tbody",null,[(c(!0),b(A,null,N(k.value,t=>(c(),b("tr",{key:t.id},[e("td",null,[e("div",Ce,[e("a",{class:"font-bold hover:underline href",onClick:V(F=>M(t.id),["prevent"])}," #"+s(t.id),9,Ie)])]),e("td",null,[e("div",null,s(l.formatDate(t.created_at)),1)]),r(e("td",null,[e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,xe)])],512),[[i,g(u).user.is_moderator&&g(u).user.is_admin]]),e("td",null,[e("div",null,[r(e("span",{class:"italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),r(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"href"},s(l.$t("reports.viewPost")),9,Me),[[i,!t.is_removed]])])]),e("td",null,[e("div",null,s(t.description.length>300?`${t.description.slice(0,300)}...`:t.description),1)]),e("td",Ae,[e("div",null,[e("span",{class:_(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("td",null,[e("div",Ne,[r(e("span",null,"-",512),[[i,t.status==="pending"]]),r(e("span",{class:_(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3),[[i,t.status==="closed"]])])]),e("td",Pe,[e("div",null,[e("a",{class:"underline href",onClick:V(F=>M(t.id),["prevent"])},s(l.$t("reports.moreInfo")),9,Be)])])]))),128))])])]),(c(!0),b(A,null,N(k.value,t=>(c(),b("div",{key:t.id,class:"reports__cards"},[e("div",null,[e("label",null,s(l.$t("reports.user")),1),e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,Ee)])]),e("div",null,[e("label",null,s(l.$t("reports.description")),1),e("div",null,s(t.description),1)]),e("div",null,[e("label",null,s(l.$t("reports.reportDate")),1),e("div",null,s(l.formatDate(t.created_at)),1)]),e("div",null,[e("label",null,s(l.$t("reports.status")),1),e("div",Fe,[e("div",{class:_(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("div",null,[e("label",null,s(l.$t("reports.decision")),1),e("div",Se,[e("span",{class:_(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3)])]),e("div",null,[Te,e("div",null,[r(e("span",{class:"mr-2 italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),r(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"mr-2 underline href"},s(l.$t("reports.viewReportedPost")),9,Ve),[[i,!t.is_removed]]),e("div",{class:"underline href",onClick:F=>M(t.id)},s(l.$t("reports.moreInfo")),9,je)])])]))),128)),r(e("div",Le,[e("button",{class:_(f.value.next_previous&&f.value.next_previous.prev_page!==null?"primary-button":"disabled-button"),onClick:h[0]||(h[0]=t=>I("prev"))},s(l.$t("pagination.previous")),3),e("button",{class:_(f.value.next_previous&&f.value.next_previous.next_page!==null?"primary-button":"disabled-button"),onClick:h[1]||(h[1]=t=>I("next"))},s(l.$t("pagination.next")),3)],512),[[i,f.value.total_page>0]])],512),[[i,!p.value.loading&&!a.value&&!x.value]]),D(Z,{loading:p.value.loading,empty:a.value,error:x.value,fetch:d},null,8,["loading","empty","error"])])]),p.value.loading?O("",!0):(c(),T(ge,{key:0,id:"report-detail-modal",ref_key:"reportDetailModalRef",ref:E,class:"modal",onRefresh:h[2]||(h[2]=t=>d())},null,512))]),_:1}))}},He=G(Oe,[["__scopeId","data-v-b857b2ab"]]);export{He as default};
