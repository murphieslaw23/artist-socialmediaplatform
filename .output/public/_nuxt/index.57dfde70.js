import{k as Y,o as n,p as d,q as o,e as i,L as m,t as l,K as f,Z as de,j as ue,f as pe,I as _e,l as he,O as me,Y as ke,m as ve,E as K,r as k,u,c as Q,w as _,x as p,s as h,Q as we,P as fe,T as ge,b as R,v as V,H as x,G as S,M as ye,N as xe,y as be}from"./entry.ae51314b.js";import{u as Me,J as $e}from"./ProBadge.de1f3ff6.js";import{u as Ce}from"./useFeed.607ee023.js";import{u as Ie}from"./useI18n.cfe5bfdd.js";import{M as Se,a as Le,S as Fe,u as Te,b as Ae,c as Re}from"./ModalView.7fc791b0.js";import{u as Ve}from"./WorkList.3a9e5f28.js";import{L as Ee}from"./Layout.288d44a5.js";import{F as He,I as W}from"./FeedModalView.486a4728.js";import{_ as D}from"./_plugin-vue_export-helper.a1a6add7.js";import"./useReport.9e4f9eb9.js";import"./LoadingEmptyErrorMessage.b2b53b6c.js";import"./Spinner.96f551a8.js";import"./user-counters-api.7503204d.js";import"./useSetting.f194dec2.js";const Oe={class:"feed__left-buttons"},Pe={class:"hidden ml-3 lg:block"},Be={class:"hidden ml-3 lg:block"},Ne={class:"hidden ml-3 lg:block"},De={__name:"FeedLeftSide",props:{currentView:{type:String,default:"feed"}},emits:["refetch"],setup(g,{emit:v}){Y();const F=b=>{v("refetch",b)};return(b,y)=>(n(),d("div",Oe,[o("button",{onClick:y[0]||(y[0]=T=>F("feed")),class:f(["left-button",g.currentView=="feed"?"theme-colored":"theme-color"])},[i(m,{name:"i-akar-icons-home",class:"text-lg hover:text-white"}),o("span",Pe,l(b.$t("feeds.all")),1)],2),o("button",{onClick:y[1]||(y[1]=T=>F("text")),class:f(["left-button",g.currentView=="text"?"theme-colored":"theme-color"])},[i(m,{name:"i-ion-text-sharp",class:"text-lg hover:text-white"}),o("span",Be,l(b.$t("feeds.textOnly")),1)],2),o("button",{onClick:y[2]||(y[2]=T=>F("artwork")),class:f(["left-button",g.currentView=="artwork"?"theme-colored":"theme-color"])},[i(m,{name:"i-gg-image",class:"text-lg hover:text-white"}),o("span",Ne,l(b.$t("feeds.artworkOnly")),1)],2)]))}},Ue=D(De,[["__scopeId","data-v-94c3ddab"]]),ze={};function je(g,v){return n(),d("div")}const Ge=D(ze,[["render",je]]);const L=g=>(ye("data-v-2d83edfa"),g=g(),xe(),g),qe={class:"mx-auto w-full xl:w-9/12"},Je={key:0,class:"flex flex-row gap-x-2 justify-center mb-4"},Ke={class:"grid grid-cols-1 gap-1 mx-auto md:gap-2"},Qe={class:"flex flex-row rounded-md theme-color"},We={class:"w-full"},Ye={key:0,class:"p-2 md:p-4 user-info"},Ze=["src"],Xe={class:"name"},et=L(()=>o("br",null,null,-1)),tt=L(()=>o("span",{class:"mx-1"},"\xB7",-1)),ot={key:1,class:"px-2 md:px-4"},st={class:"title"},it={key:0},rt=["id","innerHTML"],lt=["id","onClick"],at={key:2,class:"px-2 mt-2 -mb-2 md:px-4"},nt=["href"],ct={class:"text-xs"},dt={class:"inline-block flex-row w-full rounded-md"},ut=["src"],pt={class:"title"},_t=["onClick"],ht={key:3,class:"px-2 md:px-4"},mt=["innerHTML","id"],kt=["id","onClick"],vt={key:2,class:"my-2 w-full rounded-md theme-color-secondary"},wt={key:0,class:"p-2 md:p-4 user-info"},ft=["src"],gt={class:"name"},yt=L(()=>o("br",null,null,-1)),xt=L(()=>o("span",{class:"mx-1"},"\xB7",-1)),bt={class:"px-2 mt-2 md:px-4"},Mt={class:"title"},$t={key:0},Ct=["id","innerHTML"],It=["id","onClick"],St=["onClick"],Lt={key:0},Ft={key:1},Tt={class:"mx-auto mt-2 light-bordered-button"},At={class:"float-right mx-4 mt-2 interactions"},Rt={key:0,class:"reactions"},Vt=["onClick"],Et=["onClick"],Ht=["onClick"],Ot={class:"option dropdown"},Pt={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"option-dropdown-items"},Bt={class:"option-dropdown dropdown-menu"},Nt={id:"option-dropdown-items",class:"w-52 toggler","aria-labelledby":"option-dropdown-buttons",role:"menu"},Dt={class:"menu-wrapper"},Ut=L(()=>o("div",{class:"custom-divider"},null,-1)),zt=["onClick"],jt={class:"mx-auto text-center"},Gt={class:"mx-auto text-center"},qt={class:"mx-auto text-center"},Jt=L(()=>o("br",null,null,-1)),Kt={id:"chronological-modal",class:"modal work-view"},Qt={id:"chronological-feed-modal",class:"z-30 modal work-view"},Wt={__name:"index",props:{changeMode:{type:Function,default:()=>{}}},setup(g){const v=Y(),{generateArtworkThumb:F}=de(),{oApiConfiguration:b,fetchOptions:y}=ue(),T=Me(b,y()),O=Ce(b,y());pe({title:Ie().tl("meta.title.feed.feed")});const Z=_e(),X=he(),ee=me();ke(()=>{v.loggedIn||X.push({path:"/explore"})}),ve(()=>{}),K(()=>ee.query,()=>{le(),x().closeModal("feed-collection-selection-modal"),x().closeModal("collection-selection-modal"),x().closeModal("album-selection-modal"),x().closeModal("report-modal")});const M=k({explicitMode:void 0,pagination:{page:0,perPage:10}}),E=k(!1),$=k(!1),C=k([]),H=k("feed"),te=async({loaded:t})=>{const[r,a]=await O.getChronologicalFeeds({fetchMode:H.value,explicitMode:M.value.explicitMode,showAllTextPost:$.value,pagination:{page:M.value.pagination.page,perPage:M.value.pagination.perPage}});if(M.value.pagination.page+=1,r.feeds.length)for(let e=0;e<r.feeds.length;e++){const s=r.feeds[e];if(s.liked&&(s.type==="artwork"?w.value.push("a-"+s.id):w.value.push("f-"+s.id)),s.images=[],s.apply_explicit_filter=!1,s.apply_gore_filter=!1,s.type==="artwork"||s.type==="feed"&&s.artwork_share_info!=null){s.type==="artwork"&&s.saved&&I.value.push(s.id);for(let c=0;c<s.artwork_assets.length;c++)if(c<=3){const ce=await F(s.artwork_assets[c].bucket,s.artwork_assets[c].filename,"feed");s.images.push(ce)}s.artwork_share_info!=null&&(!v.loggedIn&&s.artwork_share_info.is_explicit||s.artwork_share_info.is_explicit&&!v.user.user_settings.show_explicit)&&(s.apply_explicit_filter=!0),s.artwork_share_info!=null&&(!v.loggedIn&&s.artwork_share_info.is_gore||s.artwork_share_info.is_gore&&!v.user.user_settings.show_gore)&&(s.apply_gore_filter=!0)}C.value.push(s)}t(r.feeds.length,M.value.pagination.perPage)};K(()=>$.value,()=>{U()});const oe=t=>{H.value=t,U()},U=()=>{M.value.pagination.page=0,C.value=[],E.value=!0},z=k(null),P=(t,r,a)=>{r?(C.value[a].apply_explicit_filter=!1,C.value[a].apply_gore_filter=!1):(z.value.view(t),x().openModal("chronological-modal"))},j=k(null),se=t=>{j.value.view(t),x().openModal("chronological-feed-modal")},B=(t,r,a,e)=>{Ae().readMore(t,r,a,e)},G=k(!1);let ie;const re=t=>{const r=k(Z.public.appUrl+t),{copy:a}=Ve({source:r});a(),Re().splash(ie,G,"copy-alert")},I=k([]),w=k([]),q=async(t,r)=>{const a=parseInt(t.split("-")[1]);let e=!1;if(r==="artwork"){const[s,c]=await T.like({workId:a});e=s}else if(r==="feed"){const[s,c]=await O.like({feedId:a});e=s}if(e){w.value.push(t);const s=document.getElementById(`feed-like-button-${r}-${a}`);s.classList.add("animate-bounce"),setInterval(()=>{s.classList.remove("animate-bounce")},2500)}},J=async(t,r)=>{const a=parseInt(t.split("-")[1]);let e=!1;if(r==="artwork"){const[s,c]=await T.unlike({workId:a});e=s}else if(r==="feed"){const[s,c]=await O.unlike({feedId:a});e=s}if(e){const s=w.value.indexOf(t);w.value.splice(s,1)}},le=()=>{x().closeModal("chronological-modal"),x().closeModal("chronological-feed-modal")},N=k(null),A=k(0),ae=t=>{A.value=t,x().openModal("feed-collection-selection-modal"),N.value.fetchCollection(),N.value.fetchCurrentSaved()},ne=t=>{if(t){const r=I.value.indexOf(A.value);I.value.splice(r,1)}else I.value.push(A.value);Te().animate("save-to-collection-button-"+A.value)};return(t,r)=>{const a=be;return u(v).loggedIn?(n(),Q(Ee,{key:0,"with-footer":!0,"hide-side":t.isMobileDevice(),"no-right-side":t.isMobile()},{"left-side":_(()=>[u(C).length?(n(),Q(Ue,{key:0,"current-view":u(H),onRefetch:oe},null,8,["current-view"])):p("",!0)]),"right-side":_(()=>[i(Ge)]),default:_(()=>[o("div",qe,[u(H)=="text"?(n(),d("div",Je,[o("button",{onClick:r[0]||(r[0]=e=>$.value=!1),class:f(u($)==!1?"primary-button":"light-button")},[i(m,{name:"i-fluent-people-checkmark-24-regular"}),h(" "+l(t.$t("followings.followingOnly")),1)],2),o("button",{onClick:r[1]||(r[1]=e=>$.value=!0),class:f(u($)==!0?"primary-button":"light-button")},[i(m,{name:"i-heroicons-globe-asia-australia"}),h(" "+l(t.$t("followings.global")),1)],2)])):p("",!0),o("div",Ke,[(n(!0),d(fe,null,we(u(C),(e,s)=>(n(),d("div",{key:e.id+e.type,class:"relative rounded-md lg:mx-6"},[o("div",Qe,[o("div",We,[e.users?(n(),d("div",Ye,[i(a,{to:"/profile/"+e.users.username},{default:_(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.users.avatar_bucket,e.users.avatar_filename),onError:r[2]||(r[2]=(...c)=>t.imageLoadError&&t.imageLoadError(...c))},null,40,Ze)]),_:2},1032,["to"]),o("div",Xe,[i(a,{to:"/profile/"+e.users.username,class:"fullname hover:href"},{default:_(()=>[h(l(e.users.name),1)]),_:2},1032,["to"]),et,i(a,{to:"/profile/"+e.users.username,class:"hover:underline text-xxs"},{default:_(()=>[h(" @"+l(e.users.username),1)]),_:2},1032,["to"]),tt,i(a,{to:(e.type==="artwork"?"/a/":"/feed/")+e.id,class:"hover:underline text-xxs"},{default:_(()=>[h(l(t.formatDate(e.scheduled_post?e.scheduled_post:e.created_at,!0)),1)]),_:2},1032,["to"])])])):p("",!0),e.type==="artwork"?(n(),d("div",ot,[o("span",st,l(e.title),1),e.description?(n(),d("p",it,[o("span",{id:"feed-description-"+e.id,innerHTML:e.description.length>300?`${e.description.slice(0,300)}...`:e.description},null,8,rt),e.description.length>300?(n(),d("a",{key:0,id:"feed-read-more-"+e.id,class:"href",onClick:S(c=>B(e.description,e.id,"feed-read-more-","feed-description-"),["prevent"])},l(t.$t("readMore")),9,lt)):p("",!0)])):p("",!0)])):p("",!0),e.redraw_of&&e.redrawed_artwork_info?(n(),d("div",at,[o("a",{href:"/a/"+e.redraw_of,target:"_blank",class:"flex flex-col gap-2 p-2 w-full rounded-md theme-color-secondary hover:theme-colored"},[o("i",ct,l(t.$t("artworks.redrawed")),1),o("div",dt,[o("img",{preload:"",loading:"lazy",class:"inline-block mr-2 w-10 rounded-md",src:t.artworkThumb(e.redrawed_artwork_info.artwork_assets.bucket,e.redrawed_artwork_info.artwork_assets.filename,"thumbnail",!1),onError:r[3]||(r[3]=(...c)=>t.imageLoadError&&t.imageLoadError(...c))},null,40,ut),o("span",pt,l(e.redrawed_artwork_info.title),1)])],8,nt)])):p("",!0),o("div",null,[e.type==="artwork"?(n(),d("div",{key:0,class:"cursor-pointer",onClick:S(c=>P(e.id),["prevent"])},[i(W,{class:"p-2 md:p-4",work:e},null,8,["work"])],8,_t)):p("",!0)]),e.type==="feed"?(n(),d("div",ht,[e.text?(n(),d("p",{key:0,innerHTML:e.text.split("<br>").length>3&&e.text.length>300?`${e.text.slice(0,300)}...`:e.text,id:"feed-text-"+e.id,class:f(["mt-2",{"mb-2":!e.artwork_share_info}])},null,10,mt)):p("",!0),e.text&&e.text.split("<br>").length>3&&e.text.length>300?(n(),d("a",{key:1,id:"feed-read-more-"+e.id,class:"href",onClick:S(c=>B(e.text,e.id,"feed-read-more-","feed-text-"),["prevent"])},l(t.$t("readMore")),9,kt)):p("",!0),e.artwork_share_info?(n(),d("div",vt,[e.artwork_share_info.user?(n(),d("div",wt,[i(a,{to:"/profile/"+e.artwork_share_info.user.username},{default:_(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.artwork_share_info.user.avatar_bucket,e.artwork_share_info.user.avatar_filename),onError:r[4]||(r[4]=(...c)=>t.imageLoadError&&t.imageLoadError(...c))},null,40,ft)]),_:2},1032,["to"]),o("div",gt,[i(a,{to:"/profile/"+e.artwork_share_info.user.username,class:"fullname hover:href"},{default:_(()=>[h(l(e.artwork_share_info.user.name),1)]),_:2},1032,["to"]),yt,i(a,{to:"/profile/"+e.artwork_share_info.user.username,class:"hover:underline text-xxs"},{default:_(()=>[h(" @"+l(e.artwork_share_info.user.username),1)]),_:2},1032,["to"]),xt,i(a,{to:"/a/"+e.artwork_share_info.id,class:"hover:underline text-xxs"},{default:_(()=>[h(l(t.formatDate(e.artwork_share_info.scheduled_post?e.artwork_share_info.scheduled_post:e.artwork_share_info.created_at,!0)),1)]),_:2},1032,["to"])])])):p("",!0),o("div",bt,[o("span",Mt,l(e.artwork_share_info.title),1),e.artwork_share_info.description?(n(),d("p",$t,[o("span",{id:"feed-description-"+e.artwork_share_info.id,innerHTML:e.artwork_share_info.description.length>300?`${e.artwork_share_info.description.slice(0,300)}...`:e.artwork_share_info.description},null,8,Ct),e.artwork_share_info.description.length>300?(n(),d("a",{key:0,id:"feed-read-more-"+e.artwork_share_info.id,class:"href",onClick:S(c=>B(e.artwork_share_info.description,e.artwork_share_info.id,"feed-read-more-","feed-description-"),["prevent"])},l(t.$t("readMore")),9,It)):p("",!0)])):p("",!0)]),o("div",null,[o("div",{class:f(["p-2",{"cursor-pointer":!e.apply_explicit_filter||e.apply_gore_filter}]),onClick:S(c=>P(e.artwork_share_info.id,e.apply_explicit_filter?e.apply_gore_filter:e.apply_explicit_filter,s),["prevent"])},[o("div",{class:f(["overflow-hidden relative md:p-2 rounded-md",{"md:mx-2":e.apply_explicit_filter||e.apply_gore_filter}])},[i(W,{class:f([{"blur-3xl unclickable":e.apply_explicit_filter||e.apply_gore_filter},e.apply_explicit_filter||e.apply_gore_filter?"brightness-50":"brightness-100"]),work:e},null,8,["class","work"]),e.apply_explicit_filter||e.apply_gore_filter?(n(),d("div",{key:0,class:f(["p-2 mx-auto w-full text-center rounded-md opacity-90",e.apply_gore_filter?"bg-red-200":"bg-yellow-200"])},[e.apply_explicit_filter&&!e.apply_gore_filter?(n(),d("div",Lt,l(u(v).loggedIn?t.$t("explicitContentAlert"):t.$t("explicitContentAlertForGuest")),1)):p("",!0),e.apply_gore_filter?(n(),d("div",Ft,l(u(v).loggedIn?t.$t("goreContentAlert"):t.$t("goreContentAlertForGuest")),1)):p("",!0),o("button",Tt,l(t.$t("explicitShowMeThisContent")),1)],2)):p("",!0)],2)],10,St)])])):p("",!0)])):p("",!0),o("div",At,[u(v).loggedIn?(n(),d("div",Rt,[o("span",{onClick:c=>e.type==="artwork"?u(w).includes("a-"+e.id)?J("a-"+e.id,e.type):q("a-"+e.id,e.type):u(w).includes("f-"+e.id)?J("f-"+e.id,e.type):q("f-"+e.id,e.type)},[R(i(m,{id:"feed-like-button-"+e.type+"-"+e.id,name:"i-ion-heart",class:"mr-1 text-red-500 hover:text-red-500"},null,8,["id"]),[[V,e.type==="artwork"?u(w).includes("a-"+e.id):u(w).includes("f-"+e.id)]]),R(i(m,{name:"i-ri-heart-3-line",class:"mr-1 icon-color hover:text-red-500"},null,512),[[V,e.type==="artwork"?!u(w).includes("a-"+e.id):!u(w).includes("f-"+e.id)]]),h(" "+l(t.thousand(e._count.likes)),1)],8,Vt),o("span",{onClick:S(c=>e.type==="artwork"?P(e.id):se(e.id),["prevent"])},[i(m,{name:"i-mdi-comment-multiple-outline",class:"mr-1 icon-color hover:text-blue-500"}),h(" "+l(t.thousand(e._count.comments)),1)],8,Et),e.type==="artwork"?(n(),d("span",{key:0,onClick:c=>ae(e.id)},[R(i(m,{id:"save-to-collection-button-"+e.id,name:"i-ion-bookmark",class:"text-blue-500 hover:text-blue-500"},null,8,["id"]),[[V,u(I).includes(e.id)]]),R(i(m,{name:"i-majesticons-bookmark-line",class:"icon-color hover:text-blue-500"},null,512),[[V,!u(I).includes(e.id)]])],8,Ht)):p("",!0),o("div",Ot,[o("button",Pt,[o("span",null,[i(m,{name:"i-uit-ellipsis-v",class:"align-middle icon icon-color"})])]),o("div",Bt,[o("div",Nt,[o("div",Dt,[i(a,{to:e.type==="artwork"?"/a/"+e.id:"/feed/"+e.id,class:"flex py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:_(()=>[i(m,{name:"i-fluent-arrow-enter-20-filled",class:"mr-2 text-base"}),h(" "+l(t.$t("open")),1)]),_:2},1032,["to"]),i(a,{to:e.type==="artwork"?"/a/"+e.id:"/feed/"+e.id,target:"_blank",class:"flex z-20 py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:_(()=>[i(m,{name:"i-ci-external-link",class:"mr-2 text-base"}),h(" "+l(t.$t("openInNewTab")),1)]),_:2},1032,["to"]),Ut,o("div",null,[o("a",{class:"flex py-2 px-3 w-full leading-4 rounded-md transition-all duration-150 cursor-pointer hover:button-color parent-icon hover:text-white",onClick:c=>re(e.type==="artwork"?"/a/"+e.id:"/feed/"+e.id)},[i(m,{name:"i-icon-park-outline-copy",class:"mr-2 text-base"}),h(" "+l(t.$t("copySharableLink")),1)],8,zt)])])])])])])):p("",!0)])])])]))),128)),i(u($e),{class:"mt-6",load:te,"is-initial":u(E),"onUpdate:is-initial":r[5]||(r[5]=e=>ge(E)?E.value=e:null)},{loading:_(()=>[o("div",jt,[i(m,{name:"i-line-md-loading-twotone-loop",class:"text-3xl"})])]),"no-results":_(()=>[o("div",Gt,l(t.$t("feeds.nothingToShow")),1)]),"no-more":_(()=>[o("div",qt,[h(l(t.$t("youHaveReachedTheEnd"))+" ",1),Jt,h(" "+l(t.$t("feeds.followMorePeople")),1)])]),_:1},8,["is-initial"]),o("div",Kt,[i(Se,{ref_key:"chronologicalModalViewRef",ref:z,section:"chronological"},null,512)]),o("div",Qt,[i(He,{ref_key:"chronologicalFeedModalViewRef",ref:j,section:"chronological-feed"},null,512)]),i(Le,{id:"feed-collection-selection-modal","modal-id":"feed-collection-selection-modal",ref_key:"collectionSelectionModalRef",ref:N,"work-id":u(A),class:"modal",onSave:ne},null,8,["work-id"]),R(i(Fe,{id:"copy-alert",text:t.$t("linkCopied"),icon:"i-bi-check-all"},null,8,["text"]),[[V,u(G)]])])])]),_:1},8,["hide-side","no-right-side"])):p("",!0)}}},po=D(Wt,[["__scopeId","data-v-2d83edfa"]]);export{po as default};
