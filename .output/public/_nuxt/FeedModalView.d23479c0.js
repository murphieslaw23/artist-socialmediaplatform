import{o as a,p as n,q as r,x as c,P as F,Q as V,K as C,t as u,j as ae,l as ne,a as le,k as ie,Z as de,m as ue,H,r as k,D as ce,a2 as me,u as e,e as f,w as g,s as $,L as S,b as _,v as E,G as P,c as fe,F as we,T as pe,y as ve,M as ke,N as he}from"./entry.e86746f3.js";import{a as ge}from"./useFeed.1ec68f4a.js";import{M as _e,_ as ye}from"./ModalView.e487b658.js";import{S as xe}from"./Spinner.cfab8439.js";import{_ as Y}from"./_plugin-vue_export-helper.a1a6add7.js";const be=["images"],$e=["src"],Ee=["images"],Ce=["src"],Le=["images"],Me=["src"],Ie=["images"],Te=["src"],Se={key:4,class:"imgrid"},Ae=["src"],Fe={key:1,class:"relative text-center"},Ve={class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-3xl font-semibold text-white"},Be=["src"],De={__name:"ImageList",props:{work:{type:Object,default:()=>{}}},setup(l){const D={1:"col-start-1 row-start-1 col-span-4 row-span-4",2:["col-start-1 row-start-1 col-span-1 row-span-2","col-start-2 row-start-1 col-span-1 row-span-2"],3:["col-start-1 row-start-1 col-span-1 row-span-4","col-start-2 row-start-1 col-span-1 row-span-2","col-start-2 row-start-3 col-span-1 row-span-2"]};return(w,p)=>(a(),n("div",null,[l.work.artwork_assets.length===1?(a(),n("div",{key:0,images:[w.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]},[r("img",{src:w.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed"),class:"object-contain w-full rounded",style:{"max-height":"1000px"},onError:p[0]||(p[0]=(...i)=>w.imageLoadError&&w.imageLoadError(...i))},null,40,$e)],8,be)):c("",!0),l.work.artwork_assets.length===2?(a(),n("div",{key:1,images:l.work.images,class:"imgrid"},[(a(!0),n(F,null,V(l.work.images,(i,h)=>(a(),n("img",{key:i,class:C(D[2][h]),src:i,onError:p[1]||(p[1]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,42,Ce))),128))],8,Ee)):c("",!0),l.work.artwork_assets.length===3?(a(),n("div",{key:2,images:l.work.images,class:"imgrid"},[(a(!0),n(F,null,V(l.work.images,(i,h)=>(a(),n("img",{key:i,class:C(D[3][h]),src:i,onError:p[2]||(p[2]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,42,Me))),128))],8,Le)):c("",!0),l.work.artwork_assets.length===4?(a(),n("div",{key:3,images:l.work.images,class:"imgrid"},[(a(!0),n(F,null,V(l.work.images,i=>(a(),n("img",{key:i,src:i,onError:p[3]||(p[3]=(...h)=>w.imageLoadError&&w.imageLoadError(...h))},null,40,Te))),128))],8,Ie)):c("",!0),l.work.artwork_assets.length>4?(a(),n("div",Se,[(a(!0),n(F,null,V(l.work.images,(i,h)=>(a(),n("div",{key:h},[h<3?(a(),n("img",{key:0,src:i,onError:p[4]||(p[4]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,40,Ae)):(a(),n("div",Fe,[r("span",Ve,"+"+u(l.work.artwork_assets.length-4),1),r("img",{src:i,class:"z-0 brightness-50",onError:p[5]||(p[5]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,40,Be)]))]))),128))])):c("",!0)]))}},W=Y(De,[["__scopeId","data-v-e2758a99"]]);const B=l=>(ke("data-v-fbed183f"),l=l(),he(),l),je={class:"z-40 work-container work-view"},Pe={class:"p-4 mb-4 rounded-md theme-color"},ze={class:"flex flex-row justify-between w-full"},Ne={key:0,class:"user-info"},Oe=["src"],Ue={class:"name"},Re=B(()=>r("br",null,null,-1)),Ge=B(()=>r("span",{class:"mx-1"},"\xB7",-1)),He={class:"text-xxs"},We={key:1,class:"flex float-right flex-row gap-2 mb-4 cursor-pointer"},Ye=["innerHTML"],qe={key:1,class:"mt-4 rounded-md theme-color-secondary"},Ke={key:0,class:"p-2 md:p-4 user-info"},Qe=["src"],Ze={class:"name"},Je=B(()=>r("br",null,null,-1)),Xe=B(()=>r("span",{class:"mx-1"},"\xB7",-1)),et={class:"px-2 md:px-4"},tt={class:"text-xs font-semibold"},st=["id"],ot=["id"],rt={class:"px-2"},at={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},nt={class:"mx-auto mt-2 primary-button"},lt={key:0,class:"flex flex-row justify-between"},it={key:0},dt={key:1},ut={key:2,class:"flex flex-row gap-x-2"},ct={class:"inline-block relative z-30 dropdown"},mt={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"headlessui-menu-items-feed-more-options"},ft={class:"invisible rounded-md opacity-0 transition-all duration-300 transform origin-top-right scale-95 -translate-y-2 dropdown-menu"},wt={id:"headlessui-menu-items-feed-more-options",class:"absolute right-0 p-1 mt-2 w-56 rounded-md shadow-lg origin-top-right outline-none theme-color","aria-labelledby":"headlessui-menu-button-1",role:"menu"},pt=["to"],vt={class:"mt-6 mb-2"},kt={key:0,class:"comment-box"},ht={class:"flex flex-col"},gt={class:"flex relative flex-col"},_t=["readonly","rows","placeholder"],yt={key:1,class:"p-4 mb-4 text-center rounded-md theme-color-secondary"},xt=["src"],bt={class:"w-full"},$t={class:"flex justify-between"},Et={class:"comment-time"},Ct={key:0,class:"hidden reactions"},Lt=B(()=>r("div",{class:"flex flex-row"},null,-1)),Mt=[Lt],It={key:1,class:"mt-4 w-full text-xs italic text-center"},Tt={id:"chronological-modal",class:"modal work-view"},St={__name:"FeedModalView",props:{id:{type:String,default:""},section:{type:String,default:""}},emits:["setMeta","showEmpty","showError"],setup(l,{expose:D,emit:w}){const p=l,i=ae(),h=ne();le();const{oApiConfiguration:y,fetchOptions:q}=ie(),M=ge(y,q()),{generateArtworkThumb:K}=de();ue(()=>{p.id!==0&&U(p.id),window.addEventListener("keydown",o=>{const s=document.getElementById("chronological-modal");o.key==="Escape"&&(!s||s.style.display!="flex")&&H().closeModal(`${p.section}-modal`)})});const L=p.id===0,O=k(!0),t=k({}),I=k(!1),U=async o=>{O.value=!0,b.value=[],A.value.page=0;const[s,m]=await M.feedDetail({id:o});if(m)m=="Post not found"?w("showEmpty"):w("showError");else{if(s.feed.artworks){s.feed.artworks.images=[];for(let x=0;x<s.feed.artworks.artwork_assets.length;x++)if(x<=3){const d=await K(s.feed.artworks.artwork_assets[x].bucket,s.feed.artworks.artwork_assets[x].filename,"feed");s.feed.artworks.images.push(d)}(!i.loggedIn&&s.feed.artworks.is_explicit||s.feed.artworks.is_explicit&&!i.user.user_settings.show_explicit)&&(s.feed.artworks.apply_explicit_filter=!0)}t.value=s.feed,I.value=s.feed.liked,await X(o),L||w("setMeta",{title:s.feed.text.length>20?`${s.feed.text.substring(0,20)}..`:s.feed.text})}O.value=!1},R=k(null),Q=async(o,s)=>{s?t.value.artworks.apply_explicit_filter=!1:(R.value.view(o),H().openModal("chronological-modal"))},Z=async()=>{const[o,s]=await M.like({feedId:t.value.id});if(o){I.value=!0,t.value._count.feed_likes++;const m=document.getElementById("feedLikeButton"+t.value.id);m.classList.add("animate-bounce"),setInterval(()=>{m.classList.remove("animate-bounce")},2500)}},J=async()=>{const[o,s]=await M.unlike({feedId:t.value.id});o&&(I.value=!1,t.value._count.feed_likes--)},b=k([]),A=k({perPage:5,page:0}),z=k([]),G=async o=>{try{const[s,m]=await M.fetchComments({feedId:o,pagination:{page:A.value.page,perPage:A.value.perPage}});return s.pagination.current_page===s.pagination.first_last.last_page?j.value=!1:j.value=!0,s.comments.forEach(x=>{z.value.push(x.id)}),s.comments}catch{}},X=async o=>{try{(await G(o)).forEach(m=>b.value.push(m))}catch{}},j=k(!1),ee=async o=>{try{A.value.page+=1,(await G(o)).forEach(m=>b.value.push(m))}catch{}},v=k(),N=200,te=ce(()=>v.value!=null&&v.value!==""?N-v.value.length:N),T=k(!1),se=async()=>{T.value=!0;try{const[o,s,m]=await M.comment({feedId:t.value.id,comment:v.value});o&&(v.value="",b.value.splice(0,0,s),b.value.join(),z.value.splice(0,0,s.id),z.value.join())}catch{}T.value=!1};k([]);const oe=async o=>{const[s,m]=await M.remove(o);s&&setTimeout(()=>{h.push({path:"/"})},1e3)};return D({view:U}),(o,s)=>{const m=ve,x=me("auto-animate");return a(),n("div",je,[r("div",{class:C(["w-full",{"overflow-y-scroll pr-4":L}])},[r("div",Pe,[r("div",ze,[e(t).users?(a(),n("div",Ne,[f(m,{to:"/profile/"+e(t).users.username},{default:g(()=>[r("img",{class:"avatar",src:o.avatarCoverUrl(e(t).users.avatar_bucket,e(t).users.avatar_filename),onError:s[0]||(s[0]=(...d)=>o.imageLoadError&&o.imageLoadError(...d))},null,40,Oe)]),_:1},8,["to"]),r("div",Ue,[f(m,{to:"/profile/"+e(t).users.username,class:"fullname"},{default:g(()=>[$(u(e(t).users.name),1)]),_:1},8,["to"]),Re,f(m,{to:"/profile/"+e(t).users.username,class:"username"},{default:g(()=>[$(" @"+u(e(t).users.username),1)]),_:1},8,["to"]),Ge,r("span",He,u(o.formatDate(e(t).created_at,!0)),1)])])):c("",!0),L?(a(),n("div",We,[r("div",{class:"modal-close",onClick:s[1]||(s[1]=d=>o.closeModal(l.section+"-modal"))},[f(S,{name:"i-ion-close",class:"text-2xl"})])])):c("",!0)]),e(t).text?(a(),n("div",{key:0,innerHTML:e(t).text},null,8,Ye)):c("",!0),e(t).artworks?(a(),n("div",qe,[e(t).artworks.users?(a(),n("div",Ke,[f(m,{to:"/profile/"+e(t).artworks.users.username},{default:g(()=>[r("img",{class:"avatar",src:o.avatarCoverUrl(e(t).artworks.users.avatar_bucket,e(t).artworks.users.avatar_filename),onError:s[2]||(s[2]=(...d)=>o.imageLoadError&&o.imageLoadError(...d))},null,40,Qe)]),_:1},8,["to"]),r("div",Ze,[f(m,{to:"/profile/"+e(t).artworks.users.username,class:"fullname hover:href"},{default:g(()=>[$(u(e(t).artworks.users.name),1)]),_:1},8,["to"]),Je,f(m,{to:"/profile/"+e(t).artworks.users.username,class:"hover:underline text-xxs"},{default:g(()=>[$(" @"+u(e(t).artworks.users.username),1)]),_:1},8,["to"]),Xe,f(m,{to:"/a/"+e(t).artworks.id,class:"hover:underline text-xxs"},{default:g(()=>[$(u(o.formatDate(e(t).artworks.scheduled_post?e(t).artworks.scheduled_post:e(t).artworks.created_at,!0)),1)]),_:1},8,["to"])])])):c("",!0),r("div",et,[r("span",tt,u(e(t).artworks.title),1),_(r("p",null,[r("span",{id:"feed-description-"+e(t).artworks.id},u(e(t).artworks.description.length>300?`${e(t).artworks.description.slice(0,300)}...`:e(t).artworks.description),9,st),e(t).artworks.description.length>300?(a(),n("a",{key:0,id:"feed-read-more-"+e(t).artworks.id,class:"href",onClick:s[3]||(s[3]=P(d=>o.readMore(e(t).artworks.description,e(t).artworks.id,"feed-read-more-","feed-description-"),["prevent"]))},u(o.$t("readMore")),9,ot)):c("",!0)],512),[[E,e(t).artworks.description]])]),r("div",rt,[e(t).artworks&&!o.isMobile()?(a(),n("div",{key:0,class:"cursor-pointer",onClick:s[4]||(s[4]=P(d=>Q(e(t).artworks.id,e(t).artworks.apply_explicit_filter),["prevent"]))},[r("div",{class:C(["overflow-hidden relative p-2 rounded-md",{"m-2":e(t).artworks.apply_explicit_filter}])},[f(W,{class:C(["mb-2",{"blur-3xl unclickable":e(t).artworks.apply_explicit_filter},e(t).artworks.apply_explicit_filter?"brightness-50":"brightness-100"]),work:e(t).artworks},null,8,["class","work"]),e(t).artworks.apply_explicit_filter?(a(),n("div",at,[r("div",null,u(e(i).loggedIn?o.$t("explicitContentAlert"):o.$t("explicitContentAlertForGuest")),1),r("button",nt,u(o.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)])):c("",!0),e(t).artworks&&o.isMobile()?(a(),fe(m,{key:1,to:"/a/"+e(t).id,class:"cursor-pointer"},{default:g(()=>[f(W,{class:"p-2",work:e(t).artworks},null,8,["work"])]),_:1},8,["to"])):c("",!0)])])):c("",!0)]),e(t)._count?(a(),n("div",lt,[e(t)._count.feed_comments?(a(),n("div",it,[r("b",null,u(o.thousand(e(t)._count.feed_comments)),1),$(" "+u(e(t)._count.feed_comments>1?o.$t("count.comments"):o.$t("count.comment")),1)])):c("",!0),e(t)._count.feed_comments?c("",!0):(a(),n("div",dt)),e(i).loggedIn?(a(),n("div",ut,[r("div",{class:"flex flex-row",onClick:s[5]||(s[5]=d=>e(I)?J():Z())},[_(f(S,{id:"feedLikeButton"+e(t).id,name:"i-ion-heart",class:"mr-2 text-xl text-red-500 cursor-pointer hover:text-red-500"},null,8,["id"]),[[E,e(I)]]),_(f(S,{name:"i-ri-heart-3-line",class:"mr-2 text-xl cursor-pointer hover:text-red-500"},null,512),[[E,!e(I)]]),r("span",null,u(o.thousand(e(t)._count.feed_likes)),1)]),r("div",ct,[r("button",mt,[r("span",null,[f(S,{name:"i-ion-ellipsis-vertical-outline",class:"align-middle icon icon-color"})])]),r("div",ft,[r("div",wt,[e(i).loggedIn&&e(t).user_id&&e(i).user.id===e(t).user_id?(a(),n("div",{key:0,to:"/feed/"+e(t).id,class:"flex z-50 py-2 px-3 w-full rounded-md transition-all duration-150 cursor-pointer bg-danger hover:button-color parent-icon hover:text-white",onClick:s[6]||(s[6]=d=>o.openModal("feed-deletion-confirm-modal"))},[f(S,{name:"i-ion-trash-outline",class:"mr-2 text-base"}),$(" "+u(o.$t("delete")),1)],8,pt)):c("",!0)])])])])):c("",!0)])):c("",!0),r("div",vt,[e(i).loggedIn?(a(),n("div",kt,[r("div",ht,[r("div",gt,[_(r("textarea",{"onUpdate:modelValue":s[7]||(s[7]=d=>pe(v)?v.value=d:null),class:C(["input form-input",[{"cursor-not-allowed":e(T)},{"theme-color-secondary textarea":L}]]),readonly:e(T),cols:"20",rows:e(v)!=null&&e(v)!=""?"4":"0",placeholder:o.$t("comments.inputPlaceholder"),maxlength:N,"data-gramm":"false"},null,10,_t),[[we,e(v)]]),_(r("span",{class:"absolute left-4 bottom-6 py-1 px-2 text-white rounded-md button-color"},u(e(te)),513),[[E,e(v)!=null&&e(v)!=""]]),r("span",{class:"absolute right-2 bottom-5 py-1 px-2",onClick:s[8]||(s[8]=P(d=>se(),["prevent"]))},[_(f(S,{name:"i-carbon-send-filled",class:"text-xl transition-all duration-100 cursor-pointer text-colored"},null,512),[[E,e(v)!=null&&e(v)!=""&&!e(T)]]),_(f(xe,null,null,512),[[E,e(T)]])])])])])):c("",!0),e(i).loggedIn?c("",!0):(a(),n("div",yt,u(o.$t("comments.loginOrRegisterToLeaveComment")),1))]),r("div",{class:C(["comment-content",[{"pr-3 overflow-x-hidden":L},{"mb-20":!L}]])},[(a(!0),n(F,null,V(e(b),d=>_((a(),n("div",{key:d.id,class:"flex flex-row w-full comment-item"},[f(m,{class:"mr-2",to:"/profile/"+d.users.username},{default:g(()=>[r("img",{class:"w-10 h-10 avatar",src:o.avatarCoverUrl(d.users.avatar_bucket,d.users.avatar_filename),onError:s[9]||(s[9]=(...re)=>o.imageLoadError&&o.imageLoadError(...re))},null,40,xt)]),_:2},1032,["to"]),r("div",bt,[r("div",{class:C(["p-4 w-full rounded-md",L?"theme-color-secondary":"theme-color"])},[r("div",$t,[f(m,{to:"/profile/"+d.users.username,class:"mb-2 text-xs font-medium transition-all duration-150 cursor-pointer hover:font-bold"},{default:g(()=>[$(u(d.users.name),1)]),_:2},1032,["to"]),r("div",Et,u(o.formatDate(d.created_at,!0)),1)]),r("div",null,u(d.comment),1),e(i).loggedIn?(a(),n("div",Ct,Mt)):c("",!0)],2)])])),[[x]])),128)),e(t)._count?_((a(),n("div",{key:0,class:"text-center capitalize href",onClick:s[10]||(s[10]=P(d=>ee(e(t).id),["prevent"]))},u(o.$t("comments.loadOlder")),513)),[[E,e(t)._count.feed_comments>e(A).perPage&&e(j)]]):c("",!0),_(r("div",{class:"w-full text-xs italic text-center"},u(o.$t("comments.reachedTheEnd")),513),[[E,e(b).length&&!e(j)]]),e(i).loggedIn&&!e(b).length?(a(),n("div",It,u(o.$t("comments.noCommentYet")),1)):c("",!0)],2)],2),r("div",Tt,[f(_e,{ref_key:"sharedWorkModalViewRef",ref:R,section:"chronological"},null,512)]),f(ye,{id:"feed-deletion-confirm-modal","modal-id":"feed-deletion-confirm-modal",message:`${o.$t("alert.areYouSure")} ${o.$t("alert.youCannotUndoThisAction")}`,class:"modal",onOnAccept:s[11]||(s[11]=d=>oe(e(t).id))},null,8,["message"])])}}},jt=Y(St,[["__scopeId","data-v-fbed183f"]]);export{jt as F,W as I};
