import{L as G,k as N,j as T,m as q,r as c,J as Q,a1 as b,o as M,p as W,q as r,t as g,e as p,w as V,s as B,K as k,x as H,b as L,v as P,H as v,y as X,c as E,f as Y,O as Z,E as $,u as j}from"./entry.ae51314b.js";import{u as ee}from"./useI18n.cfe5bfdd.js";import{L as oe}from"./Layout.288d44a5.js";import{u as te}from"./ProBadge.de1f3ff6.js";import{W as ae}from"./WorkList.3a9e5f28.js";import{M as ne}from"./ModalView.7fc791b0.js";import{_ as ie}from"./LoadingEmptyErrorMessage.b2b53b6c.js";import{_ as se}from"./_plugin-vue_export-helper.a1a6add7.js";import{u as le}from"./useUser.9e6a9c73.js";import"./useReport.9e4f9eb9.js";import"./Spinner.96f551a8.js";import"./user-counters-api.7503204d.js";import"./useSetting.f194dec2.js";import"./useFeed.607ee023.js";const re={components:{Icon:G,WorkList:ae,ModalView:ne,LoadingEmptyErrorMessage:ie},props:{title:{type:String,default:""},section:{type:String,default:""},paginationProp:{type:Object,default(){return{perPage:{type:Number,default:6},maxLoadMore:{type:Number,default:5}}}},discoverRoute:{type:String,default:"/"}},setup(t){const o=N(),{oApiConfiguration:a,fetchOptions:e}=T(),h=te(a,e());q(async()=>{await f()});const x=c([]),f=async()=>{const n=await _();if(n){const u=n.works,s=n.pagination;x.value=u,s.record_total<=i.perPage&&y(),s.record_total===0&&J()}else O()},l=c(!0),m=c(void 0),i=Q({perPage:t.paginationProp.perPage,page:c(0)}),_=async()=>{i.page===0&&(l.value=!0);try{let n,u;if(t.section==="recent"){const[s,w]=await h.getLatest({pagination:{page:i.page,perPage:i.perPage},explicitMode:m.value});s?n=s:u=w}else if(t.section==="following"){const[s,w]=await h.getFollowing({pagination:{page:i.page,perPage:i.perPage},explicitMode:m.value});s?n=s:u=w}else if(t.section==="popular"){const[s,w]=await h.getMostPopular({pagination:{page:i.page,perPage:i.perPage},explicitMode:m.value,range:"daily",rangeMode:"views"});s?n=s:u=w}return i.page+=1,K(),n}catch{O()}},d=c({delay:!1,maxLoad:t.paginationProp.maxLoadMore,showDiscoveryButton:!1}),z=async()=>{d.value.delay=!0;const n=await _(),u=n.works,s=n.pagination;u.forEach(w=>{x.value.push(w)}),d.value.delay=!1,s.next_previous.next_page||y(),s.next_previous.next_page&&s.current_page===d.value.maxLoad&&(y(),d.value.showDiscoveryButton=!0)},C=c(!0),y=()=>{C.value=!1},A=c(!1),J=()=>{A.value=!0,y()},R=c(!1),O=()=>{l.value=!1,R.value=!0,y()},K=()=>{l.value=!1,A.value=!1,R.value=!1},U=n=>{m.value=n,i.page=0,C.value=!0,d.value.showDiscoveryButton=!1,f()},S=c(null),D=c(null),I=c(null);return{auth:o,loading:l,explicitMode:m,changeExplicitMode:U,fetchTop:f,pagination:i,works:x,loadMoreOptions:d,showLoadMoreButton:C,loadMore:z,isEmpty:A,isError:R,recentModalViewRef:S,followingModalViewRef:D,popularModalViewRef:I,view:(n,u=!1)=>{t.section==="recent"&&S.value.view(n,u),t.section==="following"&&D.value.view(n,u),t.section==="popular"&&I.value.view(n,u),v().openModal(`${t.section}-modal`)}}}},ce={id:"lists"},de={class:"navigations"},ue={class:"title hidden-md-flex"},pe={class:"buttons"},fe={key:0,class:"filter-buttons"},me={class:"hidden-md-flex"},ge=["id"];function _e(t,o,a,e,h,x){const f=b("Icon"),l=X,m=b("LoadingEmptyErrorMessage"),i=b("WorkList"),_=b("ModalView");return M(),W("div",null,[r("div",ce,[r("div",de,[r("div",ue,g(a.title),1),p(l,{to:a.discoverRoute,class:"flex flex-row justify-between title md:hidden"},{default:V(()=>[B(g(a.title)+" ",1),p(f,{name:"i-fluent-arrow-enter-20-filled",class:"text-xl text-colored"})]),_:1},8,["to"]),r("div",pe,[e.auth.loggedIn&&e.auth.user.user_settings&&e.auth.user.user_settings.show_explicit?(M(),W("div",fe,[r("p",{class:k(["rounded-l-md button-item",[e.explicitMode===void 0?"button":"theme-color"]]),onClick:o[0]||(o[0]=d=>e.changeExplicitMode(void 0))},g(t.$t("default")),3),r("p",{class:k(["button-item",[e.explicitMode==="safe"?"button":"theme-color"]]),onClick:o[1]||(o[1]=d=>e.changeExplicitMode("safe"))},g(t.$t("safe")),3),r("p",{class:k(["rounded-r-md button-item",[e.explicitMode==="explicit"?"button":"theme-color"]]),onClick:o[2]||(o[2]=d=>e.changeExplicitMode("explicit"))},[p(f,{name:"i-material-symbols-explicit-outline",class:k({"text-white":e.explicitMode==="explicit"})},null,8,["class"]),B(" "+g(t.$t("explicit")),1)],2)])):H("",!0),r("div",me,[p(l,{class:"discover-button",to:a.discoverRoute},{default:V(()=>[B(g(t.$t("seeMore")),1)]),_:1},8,["to"])])])]),p(m,{loading:e.loading,empty:e.isEmpty,error:e.isError,fetch:e.fetchTop},null,8,["loading","empty","error","fetch"]),L(r("div",null,[L(p(i,{"section-class":"work-grid",works:e.works,view:e.view},null,8,["works","view"]),[[P,!e.isEmpty]]),L(r("div",{class:k(["primary-button",e.loadMoreOptions.delay?"animate-pulse":""]),onClick:o[3]||(o[3]=(...d)=>e.loadMore&&e.loadMore(...d))},g(t.$t("loadMore")),3),[[P,e.showLoadMoreButton]]),L(r("div",null,[p(l,{to:"/works/"+a.section,class:"flex-row justify-center primary-button md:mt-4"},{default:V(()=>[p(f,{name:"i-fluent-arrow-enter-20-filled",class:"mr-1 text-white hover:text-white"}),B(" "+g(t.$t("seeMore")),1)]),_:1},8,["to"])],512),[[P,e.loadMoreOptions.showDiscoveryButton]])],512),[[P,!e.loading]]),r("div",{id:a.section+"-modal",class:"modal work-view"},[L(p(_,{ref:a.section+"ModalViewRef",section:a.section},null,8,["section"]),[[P,!e.loading]])],8,ge)])])}const F=se(re,[["render",_e],["__scopeId","data-v-85e91293"]]),we={__name:"Recent",setup(t){const o={perPage:20,maxLoadMore:4};return(a,e)=>(M(),E(F,{section:"recent",title:a.$t("artworks.latestArtworks"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/recent"},null,8,["title","pagination-prop"]))}},ve={__name:"Following",setup(t){const o={perPage:10,maxLoadMore:4};return(a,e)=>(M(),E(F,{section:"following",title:a.$t("followings.followings"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/following","custom-empty-message":a.$t("explores.noFollowing")},null,8,["title","pagination-prop","custom-empty-message"]))}},Me={__name:"Popular",setup(t){const o={perPage:10,maxLoadMore:4};return(a,e)=>(M(),E(F,{section:"popular",title:a.$t("artworks.dailyPopular"),"pagination-prop":{perPage:o.perPage,maxLoadMore:o.maxLoadMore},"discover-route":"/works/popular"},null,8,["title","pagination-prop"]))}},he={class:"flex flex-col mt-2 w-full"},De={__name:"index",setup(t){const o=N(),{oApiConfiguration:a,fetchOptions:e}=T(),h=le(a,e()),{t:x}=ee();Y({title:x("explore")}),q(()=>{o.loggedIn&&m()});const f=Z();$(()=>f.query,i=>{setTimeout(()=>{v().closeModal("recent-modal"),v().closeModal("popular-modal"),v().closeModal("following-modal"),v().closeModal("collection-selection-modal"),v().closeModal("album-selection-modal"),v().closeModal("report-modal")},50)});const l=c(!1),m=async()=>{l.value=!1;const[i,_]=await h.countFollowings(o.user.id);_?l.value=!1:l.value=i>0};return(i,_)=>(M(),E(oe,{"with-footer":!0,"hide-side":!0,"no-right-side":!0,fullscreen:!0},{default:V(()=>[r("div",he,[p(we,{class:"mb-10"}),j(o).loggedIn&&j(l)?(M(),E(ve,{key:0,class:"mb-10"})):H("",!0),p(Me)])]),_:1}))}};export{De as default};
