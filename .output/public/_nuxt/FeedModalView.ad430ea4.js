import{o as a,m as r,p as o,s as d,U as A,V as B,J as C,t as u,i as re,k as le,a as ne,j as ie,aa as de,l as ue,G,r as k,ah as ce,C as me,ae as ve,e as m,w as h,q as E,K as T,b as g,v as $,F as z,c as fe,u as L,E as we,x as ke,L as pe,M as he}from"./entry.0330daa5.js";import{a as ge}from"./useFeed.e06a7783.js";import{S as _e}from"./Spinner.bde24df9.js";import{_ as Y}from"./_plugin-vue_export-helper.a1a6add7.js";import{M as ye,_ as be}from"./ModalView.e8f58535.js";const xe=["images"],Ee=["src"],$e=["images"],Le=["src"],Ce=["images"],Me=["src"],Ie=["images"],Se=["src"],Te={key:4,class:"imgrid"},Ve=["src"],Ae={key:1,class:"relative text-center"},Be={class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-3xl font-semibold text-white"},Fe=["src"],je={__name:"ImageList",props:{work:{type:Object,default:()=>{}}},setup(l){const j={1:"col-start-1 row-start-1 col-span-4 row-span-4",2:["col-start-1 row-start-1 col-span-1 row-span-2","col-start-2 row-start-1 col-span-1 row-span-2"],3:["col-start-1 row-start-1 col-span-1 row-span-4","col-start-2 row-start-1 col-span-1 row-span-2","col-start-2 row-start-3 col-span-1 row-span-2"]};return(v,f)=>(a(),r("div",null,[l.work.artwork_assets.length===1?(a(),r("div",{key:0,images:[v.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]},[o("img",{src:v.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed"),class:"object-contain w-full rounded",style:{"max-height":"1000px"},onError:f[0]||(f[0]=(...c)=>v.imageLoadError&&v.imageLoadError(...c))},null,40,Ee)],8,xe)):d("",!0),l.work.artwork_assets.length===2?(a(),r("div",{key:1,images:l.work.images,class:"imgrid"},[(a(!0),r(A,null,B(l.work.images,(c,p)=>(a(),r("img",{key:c,class:C(j[2][p]),src:c,onError:f[1]||(f[1]=(..._)=>v.imageLoadError&&v.imageLoadError(..._))},null,42,Le))),128))],8,$e)):d("",!0),l.work.artwork_assets.length===3?(a(),r("div",{key:2,images:l.work.images,class:"imgrid"},[(a(!0),r(A,null,B(l.work.images,(c,p)=>(a(),r("img",{key:c,class:C(j[3][p]),src:c,onError:f[2]||(f[2]=(..._)=>v.imageLoadError&&v.imageLoadError(..._))},null,42,Me))),128))],8,Ce)):d("",!0),l.work.artwork_assets.length===4?(a(),r("div",{key:3,images:l.work.images,class:"imgrid"},[(a(!0),r(A,null,B(l.work.images,c=>(a(),r("img",{key:c,src:c,onError:f[3]||(f[3]=(...p)=>v.imageLoadError&&v.imageLoadError(...p))},null,40,Se))),128))],8,Ie)):d("",!0),l.work.artwork_assets.length>4?(a(),r("div",Te,[(a(!0),r(A,null,B(l.work.images,(c,p)=>(a(),r("div",{key:p},[p<3?(a(),r("img",{key:0,src:c,onError:f[4]||(f[4]=(..._)=>v.imageLoadError&&v.imageLoadError(..._))},null,40,Ve)):(a(),r("div",Ae,[o("span",Be,"+"+u(l.work.artwork_assets.length-4),1),o("img",{src:c,class:"z-0 brightness-50",onError:f[5]||(f[5]=(..._)=>v.imageLoadError&&v.imageLoadError(..._))},null,40,Fe)]))]))),128))])):d("",!0)]))}},H=Y(je,[["__scopeId","data-v-fc24c6c4"]]),F=l=>(pe("data-v-d058ff8a"),l=l(),he(),l),De={class:"flex flex-row justify-between mb-2 w-full"},ze={key:0,class:"user-info"},Pe=["src"],Ue={class:"name"},Oe=F(()=>o("br",null,null,-1)),Ne=F(()=>o("span",{class:"mx-1"},"\xB7",-1)),Re={class:"text-xxs"},We={key:1,class:"flex float-right flex-row gap-2 mb-4 cursor-pointer"},Ge=["innerHTML"],He={key:0,class:"p-2 md:p-4 user-info"},Ye=["src"],qe={class:"name"},Je=F(()=>o("br",null,null,-1)),Ke=F(()=>o("span",{class:"mx-1"},"\xB7",-1)),Qe={class:"px-2 mt-2 md:px-4"},Xe={class:"text-xs font-semibold"},Ze=["id"],es=["id"],ss={key:2,class:"flex flex-row justify-between"},ts={key:0},os={key:1},as={key:2,class:"flex flex-row gap-x-2"},rs={class:"inline-block relative z-30 dropdown"},ls={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"headlessui-menu-items-feed-more-options"},ns={class:"invisible rounded-md opacity-0 transition-all duration-300 transform origin-top-right scale-95 -translate-y-2 dropdown-menu"},is={id:"headlessui-menu-items-feed-more-options",class:"absolute right-0 p-1 mt-2 w-56 rounded-md shadow-lg origin-top-right outline-none theme-color","aria-labelledby":"headlessui-menu-button-1",role:"menu"},ds=["to"],us={class:"mt-6 mb-2"},cs={key:0,class:"comment-box"},ms={class:"flex flex-col"},vs={class:"flex relative flex-col"},fs=["readonly","rows","placeholder"],ws={key:1,class:"p-4 mb-4 text-center rounded-md theme-color-secondary"},ks=["src"],ps={class:"w-full"},hs={class:"flex justify-between"},gs={class:"comment-time"},_s={key:0,class:"hidden reactions"},ys=F(()=>o("div",{class:"flex flex-row"},null,-1)),bs=[ys],xs={key:1,class:"mt-4 w-full text-xs italic text-center"},Es={id:"chronological-modal",class:"modal work-view"},$s={__name:"FeedModalView",props:{id:{type:String,default:""},section:{type:String,default:""}},emits:["showEmpty","showError"],setup(l,{expose:j,emit:v}){const f=l,c=re(),p=le();ne();const{oApiConfiguration:_,fetchOptions:q}=ie(),M=ge(_,q()),{generateArtworkThumb:J}=de();ue(()=>{f.id!==""&&N(f.id),window.addEventListener("keydown",t=>{const s=document.getElementById("chronological-modal");t.key==="Escape"&&(!s||s.style.display!="flex")&&G().closeModal(`${f.section}-modal`)})});const b=f.id==="",O=k(!0),e=k({}),I=k(!1),N=async t=>{O.value=!0,x.value=[],V.value.page=0;try{const[s,i]=await M.feedDetail({id:t});if(i)i=="Post not found"?v("showEmpty"):v("showError");else{if(s.feed.artworks){s.feed.artworks.images=[];for(let y=0;y<s.feed.artworks.artwork_assets.length;y++)if(y<=3){const n=await J(s.feed.artworks.artwork_assets[y].bucket,s.feed.artworks.artwork_assets[y].filename,"feed");s.feed.artworks.images.push(n)}}e.value=s.feed,I.value=s.feed.liked,await Z(t)}}catch{ce()}O.value=!1},R=k(null),K=async t=>{R.value.view(t),G().openModal("chronological-modal")},Q=async()=>{const[t,s]=await M.like({feedId:e.value.id});if(t){I.value=!0,e.value._count.feed_likes++;const i=document.getElementById("feedLikeButton"+e.value.id);i.classList.add("animate-bounce"),setInterval(()=>{i.classList.remove("animate-bounce")},2500)}},X=async()=>{const[t,s]=await M.unlike({feedId:e.value.id});t&&(I.value=!1,e.value._count.feed_likes--)},x=k([]),V=k({perPage:5,page:0}),P=k([]),W=async t=>{try{const[s,i]=await M.fetchComments({feedId:t,pagination:{page:V.value.page,perPage:V.value.perPage}});return s.pagination.current_page===s.pagination.first_last.last_page?D.value=!1:D.value=!0,s.comments.forEach(y=>{P.value.push(y.id)}),s.comments}catch{}},Z=async t=>{try{(await W(t)).forEach(i=>x.value.push(i))}catch{}},D=k(!1),ee=async t=>{try{V.value.page+=1,(await W(t)).forEach(i=>x.value.push(i))}catch{}},w=k(),U=200,se=me(()=>w.value!=null&&w.value!==""?U-w.value.length:U),S=k(!1),te=async()=>{S.value=!0;try{const[t,s,i]=await M.comment({feedId:e.value.id,comment:w.value});t&&(w.value="",x.value.splice(0,0,s),x.value.join(),P.value.splice(0,0,s.id),P.value.join())}catch{}S.value=!1};k([]);const oe=async t=>{const[s,i]=await M.remove(t);s&&setTimeout(()=>{p.push({path:"/"})},1e3)};return j({view:N}),(t,s)=>{const i=ke,y=ve("auto-animate");return a(),r("div",{class:C(["z-40 work-container work-view",b?"w-full md:w-9/12 lg:w-2/5 mx-auto md:p-6 p-4 theme-color":"w-full"])},[o("div",{class:C(["w-full",{"overflow-y-scroll pr-4":b}])},[o("div",De,[e.value.users?(a(),r("div",ze,[m(i,{to:"/profile/"+e.value.users.username},{default:h(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.value.users.avatar_bucket,e.value.users.avatar_filename),onError:s[0]||(s[0]=(...n)=>t.imageLoadError&&t.imageLoadError(...n))},null,40,Pe)]),_:1},8,["to"]),o("div",Ue,[m(i,{to:"/profile/"+e.value.users.username,class:"fullname"},{default:h(()=>[E(u(e.value.users.name),1)]),_:1},8,["to"]),Oe,m(i,{to:"/profile/"+e.value.users.username,class:"username"},{default:h(()=>[E(" @"+u(e.value.users.username),1)]),_:1},8,["to"]),Ne,o("span",Re,u(t.formatDate(e.value.created_at,!0)),1)])])):d("",!0),b?(a(),r("div",We,[o("div",{class:"modal-close",onClick:s[1]||(s[1]=n=>t.closeModal(l.section+"-modal"))},[m(T,{name:"i-ion-close",class:"text-2xl"})])])):d("",!0)]),e.value.text?(a(),r("div",{key:0,innerHTML:e.value.text,class:"p-4 mb-4 rounded-md theme-color"},null,8,Ge)):d("",!0),e.value.artworks?(a(),r("div",{key:1,class:C(["mb-4 w-full rounded-md",b?"theme-color-secondary":"theme-color"])},[e.value.artworks.users?(a(),r("div",He,[m(i,{to:"/profile/"+e.value.artworks.users.username},{default:h(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.value.artworks.users.avatar_bucket,e.value.artworks.users.avatar_filename),onError:s[2]||(s[2]=(...n)=>t.imageLoadError&&t.imageLoadError(...n))},null,40,Ye)]),_:1},8,["to"]),o("div",qe,[m(i,{to:"/profile/"+e.value.artworks.users.username,class:"fullname hover:href"},{default:h(()=>[E(u(e.value.artworks.users.name),1)]),_:1},8,["to"]),Je,m(i,{to:"/profile/"+e.value.artworks.users.username,class:"hover:underline text-xxs"},{default:h(()=>[E(" @"+u(e.value.artworks.users.username),1)]),_:1},8,["to"]),Ke,m(i,{to:"/a/"+e.value.artworks.id,class:"hover:underline text-xxs"},{default:h(()=>[E(u(t.formatDate(e.value.artworks.scheduled_post?e.value.artworks.scheduled_post:e.value.artworks.created_at,!0)),1)]),_:1},8,["to"])])])):d("",!0),o("div",Qe,[o("span",Xe,u(e.value.artworks.title),1),g(o("p",null,[o("span",{id:"feed-description-"+e.value.artworks.id},u(e.value.artworks.description.length>300?`${e.value.artworks.description.slice(0,300)}...`:e.value.artworks.description),9,Ze),e.value.artworks.description.length>300?(a(),r("a",{key:0,id:"feed-read-more-"+e.value.artworks.id,class:"href",onClick:s[3]||(s[3]=z(n=>t.readMore(e.value.artworks.description,e.value.artworks.id,"feed-read-more-","feed-description-"),["prevent"]))},u(t.$t("readMore")),9,es)):d("",!0)],512),[[$,e.value.artworks.description]])]),o("div",null,[e.value.artworks&&t.isMobile()?(a(),fe(i,{key:0,to:"/a/"+e.value.id,class:"cursor-pointer"},{default:h(()=>[m(H,{class:"p-2",work:e.value.artworks},null,8,["work"])]),_:1},8,["to"])):d("",!0),e.value.artworks&&!t.isMobile()?(a(),r("div",{key:1,class:"cursor-pointer",onClick:s[4]||(s[4]=z(n=>K(e.value.artworks.id),["prevent"]))},[m(H,{class:"p-2 md:p-4",work:e.value.artworks},null,8,["work"])])):d("",!0)])],2)):d("",!0),e.value._count?(a(),r("div",ss,[e.value._count.feed_comments?(a(),r("div",ts,[o("b",null,u(t.thousand(e.value._count.feed_comments)),1),E(" "+u(e.value._count.feed_comments>1?t.$t("count.comments"):t.$t("count.comment")),1)])):d("",!0),e.value._count.feed_comments?d("",!0):(a(),r("div",os)),L(c).loggedIn?(a(),r("div",as,[o("div",{class:"flex flex-row",onClick:s[5]||(s[5]=n=>I.value?X():Q())},[g(m(T,{id:"feedLikeButton"+e.value.id,name:"i-ion-heart",class:"mr-2 text-xl text-red-500 cursor-pointer hover:text-red-500"},null,8,["id"]),[[$,I.value]]),g(m(T,{name:"i-ri-heart-3-line",class:"mr-2 text-xl cursor-pointer hover:text-red-500"},null,512),[[$,!I.value]]),o("span",null,u(t.thousand(e.value._count.feed_likes)),1)]),o("div",rs,[o("button",ls,[o("span",null,[m(T,{name:"i-ion-ellipsis-vertical-outline",class:"align-middle icon icon-color"})])]),o("div",ns,[o("div",is,[L(c).loggedIn&&e.value.user_id&&L(c).user.id===e.value.user_id?(a(),r("div",{key:0,to:"/feed/"+e.value.id,class:"flex z-50 py-2 px-3 w-full rounded-md transition-all duration-150 cursor-pointer bg-danger hover:button-color parent-icon hover:text-white",onClick:s[6]||(s[6]=n=>t.openModal("feed-deletion-confirm-modal"))},[m(T,{name:"i-ion-trash-outline",class:"mr-2 text-base"}),E(" "+u(t.$t("delete")),1)],8,ds)):d("",!0)])])])])):d("",!0)])):d("",!0),o("div",us,[L(c).loggedIn?(a(),r("div",cs,[o("div",ms,[o("div",vs,[g(o("textarea",{"onUpdate:modelValue":s[7]||(s[7]=n=>w.value=n),class:C(["input form-input",[{"cursor-not-allowed":S.value},{"theme-color-secondary textarea":b}]]),readonly:S.value,cols:"20",rows:w.value!=null&&w.value!=""?"6":"0",placeholder:t.$t("comments.inputPlaceholder"),maxlength:U,"data-gramm":"false"},null,10,fs),[[we,w.value]]),g(o("span",{class:"absolute left-4 bottom-6 py-1 px-2 text-white rounded-md button-color"},u(L(se)),513),[[$,w.value!=null&&w.value!=""]]),o("span",{class:"absolute right-2 bottom-5 py-1 px-2",onClick:s[8]||(s[8]=z(n=>te(),["prevent"]))},[g(m(T,{name:"i-ion-prism",class:"text-xl transition-all duration-100 rotate-90 cursor-pointer text-colored"},null,512),[[$,w.value!=null&&w.value!=""&&!S.value]]),g(m(_e,null,null,512),[[$,S.value]])])])])])):d("",!0),L(c).loggedIn?d("",!0):(a(),r("div",ws,u(t.$t("comments.loginOrRegisterToLeaveComment")),1))]),o("div",{class:C(["comment-content",[{"pr-3 overflow-x-hidden":b},{"mb-20":!b}]])},[(a(!0),r(A,null,B(x.value,n=>g((a(),r("div",{key:n.id,class:"flex flex-row w-full comment-item"},[m(i,{class:"mr-2",to:"/profile/"+n.users.username},{default:h(()=>[o("img",{class:"w-10 h-10 avatar",src:t.avatarCoverUrl(n.users.avatar_bucket,n.users.avatar_filename),onError:s[9]||(s[9]=(...ae)=>t.imageLoadError&&t.imageLoadError(...ae))},null,40,ks)]),_:2},1032,["to"]),o("div",ps,[o("div",{class:C(["p-4 w-full rounded-md",b?"theme-color-secondary":"theme-color"])},[o("div",hs,[m(i,{to:"/profile/"+n.users.username,class:"mb-2 text-xs font-medium transition-all duration-150 cursor-pointer hover:font-bold"},{default:h(()=>[E(u(n.users.name),1)]),_:2},1032,["to"]),o("div",gs,u(t.formatDate(n.created_at,!0)),1)]),o("div",null,u(n.comment),1),L(c).loggedIn?(a(),r("div",_s,bs)):d("",!0)],2)])])),[[y]])),128)),e.value._count?g((a(),r("div",{key:0,class:"text-center capitalize href",onClick:s[10]||(s[10]=z(n=>ee(e.value.id),["prevent"]))},u(t.$t("comments.loadOlder")),513)),[[$,e.value._count.feed_comments>V.value.perPage&&D.value]]):d("",!0),g(o("div",{class:"w-full text-xs italic text-center"},u(t.$t("comments.reachedTheEnd")),513),[[$,x.value.length&&!D.value]]),L(c).loggedIn&&!x.value.length?(a(),r("div",xs,u(t.$t("comments.noCommentYet")),1)):d("",!0)],2)],2),o("div",Es,[m(ye,{ref_key:"sharedWorkModalViewRef",ref:R,section:"chronological"},null,512)]),m(be,{id:"feed-deletion-confirm-modal","modal-id":"feed-deletion-confirm-modal",message:`${t.$t("alert.areYouSure")} ${t.$t("alert.youCannotUndoThisAction")}`,class:"modal",onOnAccept:s[11]||(s[11]=n=>oe(e.value.id))},null,8,["message"])],2)}}},Ts=Y($s,[["__scopeId","data-v-d058ff8a"]]);export{Ts as F,H as I};
