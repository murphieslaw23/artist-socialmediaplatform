import{o as a,p as n,q as r,x as c,P as S,Q as V,K as _,t as u,k as re,l as ae,a as ne,j as le,Z as ie,m as de,H,r as k,D as ue,a2 as ce,u as e,e as f,w as $,s as C,L as A,b as g,v as L,G as P,F as me,T as fe,y as we,M as pe,N as ve}from"./entry.ae51314b.js";import{u as ke}from"./useFeed.607ee023.js";import{M as he,_ as ge}from"./ModalView.7fc791b0.js";import{S as _e}from"./Spinner.96f551a8.js";import{_ as W}from"./_plugin-vue_export-helper.a1a6add7.js";const ye=["images"],xe=["src"],be=["images"],$e=["src"],Ee=["images"],Ce=["src"],Le=["images"],Me=["src"],Ie={key:4,class:"imgrid"},Te=["src"],Ae={key:1,class:"relative text-center"},Fe={class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-3xl font-semibold text-white"},Se=["src"],Ve={__name:"ImageList",props:{work:{type:Object,default:()=>{}}},setup(l){const j={1:"col-start-1 row-start-1 col-span-4 row-span-4",2:["col-start-1 row-start-1 col-span-1 row-span-2","col-start-2 row-start-1 col-span-1 row-span-2"],3:["col-start-1 row-start-1 col-span-1 row-span-4","col-start-2 row-start-1 col-span-1 row-span-2","col-start-2 row-start-3 col-span-1 row-span-2"]};return(w,p)=>(a(),n("div",null,[l.work.artwork_assets.length===1?(a(),n("div",{key:0,images:[w.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]},[r("img",{src:w.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed"),class:"object-contain w-full rounded",style:{"max-height":"1000px"},onError:p[0]||(p[0]=(...i)=>w.imageLoadError&&w.imageLoadError(...i))},null,40,xe)],8,ye)):c("",!0),l.work.artwork_assets.length===2?(a(),n("div",{key:1,images:l.work.images,class:"imgrid"},[(a(!0),n(S,null,V(l.work.images,(i,h)=>(a(),n("img",{key:i,class:_(j[2][h]),src:i,onError:p[1]||(p[1]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,42,$e))),128))],8,be)):c("",!0),l.work.artwork_assets.length===3?(a(),n("div",{key:2,images:l.work.images,class:"imgrid"},[(a(!0),n(S,null,V(l.work.images,(i,h)=>(a(),n("img",{key:i,class:_(j[3][h]),src:i,onError:p[2]||(p[2]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,42,Ce))),128))],8,Ee)):c("",!0),l.work.artwork_assets.length===4?(a(),n("div",{key:3,images:l.work.images,class:"imgrid"},[(a(!0),n(S,null,V(l.work.images,i=>(a(),n("img",{key:i,src:i,onError:p[3]||(p[3]=(...h)=>w.imageLoadError&&w.imageLoadError(...h))},null,40,Me))),128))],8,Le)):c("",!0),l.work.artwork_assets.length>4?(a(),n("div",Ie,[(a(!0),n(S,null,V(l.work.images,(i,h)=>(a(),n("div",{key:h},[h<3?(a(),n("img",{key:0,src:i,onError:p[4]||(p[4]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,40,Te)):(a(),n("div",Ae,[r("span",Fe,"+"+u(l.work.artwork_assets.length-4),1),r("img",{src:i,class:"z-0 brightness-50",onError:p[5]||(p[5]=(...y)=>w.imageLoadError&&w.imageLoadError(...y))},null,40,Se)]))]))),128))])):c("",!0)]))}},De=W(Ve,[["__scopeId","data-v-27854ef2"]]);const D=l=>(pe("data-v-f6e96280"),l=l(),ve(),l),je={class:"flex flex-row justify-between w-full"},Be={key:0,class:"user-info"},Pe=["src"],Ne={class:"name"},ze=D(()=>r("br",null,null,-1)),Oe=D(()=>r("span",{class:"mx-1"},"\xB7",-1)),Ue={class:"text-xxs"},Re={key:1,class:"flex float-right flex-row gap-2 mb-4 cursor-pointer"},Ge=["innerHTML"],He={key:1,class:"mt-4 rounded-md theme-color-secondary"},We={key:0,class:"p-2 md:p-4 user-info"},Ye=["src"],qe={class:"name"},Ke=D(()=>r("br",null,null,-1)),Qe=D(()=>r("span",{class:"mx-1"},"\xB7",-1)),Ze={class:"px-2 md:px-4"},Je={class:"text-xs font-semibold"},Xe=["id"],et=["id"],tt={class:"px-2"},st={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},ot={class:"mx-auto mt-2 primary-button"},rt={key:0,class:"flex flex-row justify-between"},at={key:0},nt={key:1},lt={key:2,class:"flex flex-row gap-x-2"},it={class:"inline-block relative z-30 dropdown"},dt={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"headlessui-menu-items-feed-more-options"},ut={class:"invisible rounded-md opacity-0 transition-all duration-300 transform origin-top-right scale-95 -translate-y-2 dropdown-menu"},ct={id:"headlessui-menu-items-feed-more-options",class:"absolute right-0 p-1 mt-2 w-56 rounded-md shadow-lg origin-top-right outline-none theme-color","aria-labelledby":"headlessui-menu-button-1",role:"menu"},mt=["to"],ft={class:"mt-6 mb-2"},wt={key:0,class:"comment-box"},pt={class:"flex flex-col"},vt={class:"flex relative flex-col"},kt=["readonly","rows","placeholder"],ht={key:1,class:"p-4 mb-4 text-center rounded-md theme-color-secondary"},gt=["src"],_t={class:"w-full"},yt={class:"flex justify-between"},xt={class:"comment-time"},bt={key:0,class:"hidden reactions"},$t=D(()=>r("div",{class:"flex flex-row"},null,-1)),Et=[$t],Ct={key:1,class:"mt-4 w-full text-xs italic text-center"},Lt={id:"chronological-modal",class:"modal work-view"},Mt={__name:"FeedModalView",props:{id:{type:Number,default:0},section:{type:String,default:""}},emits:["setMeta","showEmpty","showError"],setup(l,{expose:j,emit:w}){const p=l,i=re(),h=ae();ne();const{oApiConfiguration:y,fetchOptions:Y}=le(),M=ke(y,Y()),{generateArtworkThumb:q}=ie();de(()=>{p.id!==0&&U(p.id),window.addEventListener("keydown",o=>{const s=document.getElementById("chronological-modal");o.key==="Escape"&&(!s||s.style.display!="flex")&&H().closeModal(`${p.section}-modal`)})});const x=p.id===0,O=k(!0),t=k({}),I=k(!1),U=async o=>{O.value=!0,E.value=[],F.value.page=0;const[s,m]=await M.feedDetail({id:o});if(m)m=="Post not found"?w("showEmpty"):w("showError");else{if(s.feed.artworks){s.feed.artworks.images=[];for(let b=0;b<s.feed.artworks.artwork_assets.length;b++)if(b<=3){const d=await q(s.feed.artworks.artwork_assets[b].bucket,s.feed.artworks.artwork_assets[b].filename,"feed");s.feed.artworks.images.push(d)}(!i.loggedIn&&s.feed.artworks.is_explicit||s.feed.artworks.is_explicit&&!i.user.user_settings.show_explicit)&&(s.feed.artworks.apply_explicit_filter=!0)}t.value=s.feed,I.value=s.feed.liked,await J(o),x||w("setMeta",{title:s.feed.text.length>20?`${s.feed.text.substring(0,20)}..`:s.feed.text})}O.value=!1},R=k(null),K=async(o,s)=>{s?t.value.artworks.apply_explicit_filter=!1:(R.value.view(o),H().openModal("chronological-modal"))},Q=async()=>{const[o,s]=await M.like({feedId:t.value.id});if(o){I.value=!0,t.value._count.feed_likes++;const m=document.getElementById("feedLikeButton"+t.value.id);m.classList.add("animate-bounce"),setInterval(()=>{m.classList.remove("animate-bounce")},2500)}},Z=async()=>{const[o,s]=await M.unlike({feedId:t.value.id});o&&(I.value=!1,t.value._count.feed_likes--)},E=k([]),F=k({perPage:10,page:0}),N=k([]),G=async o=>{try{const[s,m]=await M.fetchComments({feedId:o,pagination:{page:F.value.page,perPage:F.value.perPage}});return s.pagination.current_page===s.pagination.first_last.last_page?B.value=!1:B.value=!0,s.comments.forEach(b=>{N.value.push(b.id)}),s.comments}catch{}},J=async o=>{try{(await G(o)).forEach(m=>E.value.push(m))}catch{}},B=k(!1),X=async o=>{try{F.value.page+=1,(await G(o)).forEach(m=>E.value.push(m))}catch{}},v=k(),z=200,ee=ue(()=>v.value!=null&&v.value!==""?z-v.value.length:z),T=k(!1),te=async()=>{T.value=!0;try{const[o,s,m]=await M.comment({feedId:t.value.id,comment:v.value});o&&(v.value="",E.value.splice(0,0,s),E.value.join(),N.value.splice(0,0,s.id),N.value.join())}catch{}T.value=!1};k([]);const se=async o=>{const[s,m]=await M.remove(o);s&&setTimeout(()=>{h.push({path:"/"})},1e3)};return j({view:U}),(o,s)=>{const m=we,b=ce("auto-animate");return a(),n("div",{class:_(["z-40 work-container work-view mx-auto",{"w-full xl:w-1/2 py-4 pl-4 md:p-6 theme-color":x}])},[r("div",{class:_(["w-full",{"overflow-y-scroll pr-4":x}])},[r("div",{class:_(["mb-4 rounded-md theme-color",{"p-4":!x}])},[r("div",je,[e(t).users?(a(),n("div",Be,[f(m,{to:"/profile/"+e(t).users.username},{default:$(()=>[r("img",{class:"avatar",src:o.avatarCoverUrl(e(t).users.avatar_bucket,e(t).users.avatar_filename),onError:s[0]||(s[0]=(...d)=>o.imageLoadError&&o.imageLoadError(...d))},null,40,Pe)]),_:1},8,["to"]),r("div",Ne,[f(m,{to:"/profile/"+e(t).users.username,class:"fullname"},{default:$(()=>[C(u(e(t).users.name),1)]),_:1},8,["to"]),ze,f(m,{to:"/profile/"+e(t).users.username,class:"username"},{default:$(()=>[C(" @"+u(e(t).users.username),1)]),_:1},8,["to"]),Oe,r("span",Ue,u(o.formatDate(e(t).created_at,!0)),1)])])):c("",!0),x?(a(),n("div",Re,[r("div",{class:"modal-close",onClick:s[1]||(s[1]=d=>o.closeModal(l.section+"-modal"))},[f(A,{name:"i-ion-close",class:"text-2xl"})])])):c("",!0)]),e(t).text?(a(),n("div",{key:0,innerHTML:e(t).text},null,8,Ge)):c("",!0),e(t).artworks?(a(),n("div",He,[e(t).artworks.users?(a(),n("div",We,[f(m,{to:"/profile/"+e(t).artworks.users.username},{default:$(()=>[r("img",{class:"avatar",src:o.avatarCoverUrl(e(t).artworks.users.avatar_bucket,e(t).artworks.users.avatar_filename),onError:s[2]||(s[2]=(...d)=>o.imageLoadError&&o.imageLoadError(...d))},null,40,Ye)]),_:1},8,["to"]),r("div",qe,[f(m,{to:"/profile/"+e(t).artworks.users.username,class:"fullname hover:href"},{default:$(()=>[C(u(e(t).artworks.users.name),1)]),_:1},8,["to"]),Ke,f(m,{to:"/profile/"+e(t).artworks.users.username,class:"hover:underline text-xxs"},{default:$(()=>[C(" @"+u(e(t).artworks.users.username),1)]),_:1},8,["to"]),Qe,f(m,{to:"/a/"+e(t).artworks.id,class:"hover:underline text-xxs"},{default:$(()=>[C(u(o.formatDate(e(t).artworks.scheduled_post?e(t).artworks.scheduled_post:e(t).artworks.created_at,!0)),1)]),_:1},8,["to"])])])):c("",!0),r("div",Ze,[r("span",Je,u(e(t).artworks.title),1),g(r("p",null,[r("span",{id:"feed-description-"+e(t).artworks.id},u(e(t).artworks.description.length>300?`${e(t).artworks.description.slice(0,300)}...`:e(t).artworks.description),9,Xe),e(t).artworks.description.length>300?(a(),n("a",{key:0,id:"feed-read-more-"+e(t).artworks.id,class:"href",onClick:s[3]||(s[3]=P(d=>o.readMore(e(t).artworks.description,e(t).artworks.id,"feed-read-more-","feed-description-"),["prevent"]))},u(o.$t("readMore")),9,et)):c("",!0)],512),[[L,e(t).artworks.description]])]),r("div",tt,[e(t).artworks?(a(),n("div",{key:0,class:"cursor-pointer",onClick:s[4]||(s[4]=P(d=>K(e(t).artworks.id,e(t).artworks.apply_explicit_filter),["prevent"]))},[r("div",{class:_(["overflow-hidden relative rounded-md",o.isMobile()?"pt-2":"p-2",{"m-2":e(t).artworks.apply_explicit_filter}])},[f(De,{class:_(["mb-2",{"blur-3xl unclickable":e(t).artworks.apply_explicit_filter},e(t).artworks.apply_explicit_filter?"brightness-50":"brightness-100"]),work:e(t).artworks},null,8,["class","work"]),e(t).artworks.apply_explicit_filter?(a(),n("div",st,[r("div",null,u(e(i).loggedIn?o.$t("explicitContentAlert"):o.$t("explicitContentAlertForGuest")),1),r("button",ot,u(o.$t("explicitShowMeThisContent")),1)])):c("",!0)],2)])):c("",!0)])])):c("",!0)],2),e(t)._count?(a(),n("div",rt,[e(t)._count.feed_comments?(a(),n("div",at,[r("b",null,u(o.thousand(e(t)._count.feed_comments)),1),C(" "+u(e(t)._count.feed_comments>1?o.$t("count.comments"):o.$t("count.comment")),1)])):c("",!0),e(t)._count.feed_comments?c("",!0):(a(),n("div",nt)),e(i).loggedIn?(a(),n("div",lt,[r("div",{class:"flex flex-row",onClick:s[5]||(s[5]=d=>e(I)?Z():Q())},[g(f(A,{id:"feedLikeButton"+e(t).id,name:"i-ion-heart",class:"mr-2 text-xl text-red-500 cursor-pointer hover:text-red-500"},null,8,["id"]),[[L,e(I)]]),g(f(A,{name:"i-ri-heart-3-line",class:"mr-2 text-xl cursor-pointer hover:text-red-500"},null,512),[[L,!e(I)]]),r("span",null,u(o.thousand(e(t)._count.feed_likes)),1)]),r("div",it,[r("button",dt,[r("span",null,[f(A,{name:"i-ion-ellipsis-vertical-outline",class:"align-middle icon icon-color"})])]),r("div",ut,[r("div",ct,[e(i).loggedIn&&e(t).user_id&&e(i).user.id===e(t).user_id?(a(),n("div",{key:0,to:"/feed/"+e(t).id,class:"flex z-50 py-2 px-3 w-full rounded-md transition-all duration-150 cursor-pointer bg-danger hover:button-color parent-icon hover:text-white",onClick:s[6]||(s[6]=d=>o.openModal("feed-deletion-confirm-modal"))},[f(A,{name:"i-ion-trash-outline",class:"mr-2 text-base"}),C(" "+u(o.$t("delete")),1)],8,mt)):c("",!0)])])])])):c("",!0)])):c("",!0),r("div",ft,[e(i).loggedIn?(a(),n("div",wt,[r("div",pt,[r("div",vt,[g(r("textarea",{"onUpdate:modelValue":s[7]||(s[7]=d=>fe(v)?v.value=d:null),class:_(["input form-input",[{"cursor-not-allowed":e(T)},{"theme-color-secondary textarea":x}]]),readonly:e(T),cols:"20",rows:e(v)!=null&&e(v)!=""?"4":"0",placeholder:o.$t("comments.inputPlaceholder"),maxlength:z,"data-gramm":"false"},null,10,kt),[[me,e(v)]]),g(r("span",{class:"absolute left-4 bottom-6 py-1 px-2 text-white rounded-md button-color"},u(e(ee)),513),[[L,e(v)!=null&&e(v)!=""]]),r("span",{class:"absolute right-2 bottom-5 py-1 px-2",onClick:s[8]||(s[8]=P(d=>te(),["prevent"]))},[g(f(A,{name:"i-carbon-send-filled",class:"text-xl transition-all duration-100 cursor-pointer text-colored"},null,512),[[L,e(v)!=null&&e(v)!=""&&!e(T)]]),g(f(_e,null,null,512),[[L,e(T)]])])])])])):c("",!0),e(i).loggedIn?c("",!0):(a(),n("div",ht,u(o.$t("comments.loginOrRegisterToLeaveComment")),1))]),r("div",{class:_(["comment-content",[{"overflow-x-hidden":x},{"mb-20":!x}]])},[(a(!0),n(S,null,V(e(E),d=>g((a(),n("div",{key:d.id,class:"comment-item"},[f(m,{class:"mr-2",to:"/profile/"+d.users.username},{default:$(()=>[r("img",{class:"w-10 h-10 avatar",src:o.avatarCoverUrl(d.users.avatar_bucket,d.users.avatar_filename),onError:s[9]||(s[9]=(...oe)=>o.imageLoadError&&o.imageLoadError(...oe))},null,40,gt)]),_:2},1032,["to"]),r("div",_t,[r("div",{class:_(["p-4 w-full rounded-md",x?"theme-color-secondary":"theme-color"])},[r("div",yt,[f(m,{to:"/profile/"+d.users.username,class:"mb-2 text-xs font-medium transition-all duration-150 cursor-pointer hover:font-bold"},{default:$(()=>[C(u(d.users.name),1)]),_:2},1032,["to"]),r("div",xt,u(o.formatDate(d.created_at,!0)),1)]),r("div",null,u(d.comment),1),e(i).loggedIn?(a(),n("div",bt,Et)):c("",!0)],2)])])),[[b]])),128)),e(t)._count?g((a(),n("div",{key:0,class:"mx-auto w-full md:w-fit primary-button",onClick:s[10]||(s[10]=P(d=>X(e(t).id),["prevent"]))},u(o.$t("comments.loadOlder")),513)),[[L,e(t)._count.feed_comments>e(F).perPage&&e(B)]]):c("",!0),g(r("div",{class:"w-full text-xs italic text-center"},u(o.$t("comments.reachedTheEnd")),513),[[L,e(E).length&&!e(B)]]),e(i).loggedIn&&!e(E).length?(a(),n("div",Ct,u(o.$t("comments.noCommentYet")),1)):c("",!0)],2)],2),r("div",Lt,[f(he,{ref_key:"sharedWorkModalViewRef",ref:R,section:"chronological"},null,512)]),f(ge,{id:"feed-deletion-confirm-modal","modal-id":"feed-deletion-confirm-modal",message:`${o.$t("alert.areYouSure")} ${o.$t("alert.youCannotUndoThisAction")}`,class:"modal",onOnAccept:s[11]||(s[11]=d=>se(e(t).id))},null,8,["message"])],2)}}},Vt=W(Mt,[["__scopeId","data-v-f6e96280"]]);export{Vt as F,De as I};
