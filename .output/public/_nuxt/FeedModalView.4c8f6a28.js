import{a4 as J,o,l as r,s as w,m as a,q as u,M as V,N as B,J as L,t as i,h as re,a as le,i as ne,a0 as ie,k as ue,G,r as g,C as de,b as f,w as p,p as C,v as E,F as j,c as ce,u as z,E as me,x as ve,K as fe,L as we}from"./entry.8fb17908.js";import{u as ke}from"./useFeed.fc8b36b0.js";import{_ as A}from"./Icon.286d8e9a.js";import{S as ge}from"./Spinner.72e82bb8.js";import{_ as K}from"./_plugin-vue_export-helper.a1a6add7.js";import{M as he}from"./ModalView.cae1a3ae.js";const pe=["images"],_e=["src"],ye=["images"],be=["src"],xe=["images"],Ee=["src"],Le=["images"],$e=["src"],Ce={key:4,class:"imgrid"},Ie=["src"],Me={key:1,class:"relative text-center"},ze={class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-3xl font-semibold text-white"},Se=["src"],Ve={__name:"ImageList",props:{work:{type:Object,default:()=>{}}},setup(l){const F={1:"col-start-1 row-start-1 col-span-4 row-span-4",2:["col-start-1 row-start-1 col-span-1 row-span-2","col-start-2 row-start-1 col-span-1 row-span-2"],3:["col-start-1 row-start-1 col-span-1 row-span-4","col-start-2 row-start-1 col-span-1 row-span-2","col-start-2 row-start-3 col-span-1 row-span-2"]};return(d,v)=>{const b=J("lazy");return o(),r("div",null,[l.work.artwork_assets.length===1?(o(),r("div",{key:0,images:[d.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]},[w(a("img",{src:d.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed"),class:"object-contain w-full rounded",style:{"max-height":"1000px"},loading:"lazy",onError:v[0]||(v[0]=(...c)=>d.imageLoadError&&d.imageLoadError(...c))},null,40,_e),[[b,d.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]])],8,pe)):u("",!0),l.work.artwork_assets.length===2?(o(),r("div",{key:1,images:l.work.images,class:"imgrid"},[(o(!0),r(V,null,B(l.work.images,(c,k)=>w((o(),r("img",{key:c,class:L(F[2][k]),src:c,loading:"lazy",onError:v[1]||(v[1]=(..._)=>d.imageLoadError&&d.imageLoadError(..._))},null,42,be)),[[b,c]])),128))],8,ye)):u("",!0),l.work.artwork_assets.length===3?(o(),r("div",{key:2,images:l.work.images,class:"imgrid"},[(o(!0),r(V,null,B(l.work.images,(c,k)=>w((o(),r("img",{key:c,class:L(F[3][k]),src:c,loading:"lazy",onError:v[2]||(v[2]=(..._)=>d.imageLoadError&&d.imageLoadError(..._))},null,42,Ee)),[[b,c]])),128))],8,xe)):u("",!0),l.work.artwork_assets.length===4?(o(),r("div",{key:3,images:l.work.images,class:"imgrid"},[(o(!0),r(V,null,B(l.work.images,c=>w((o(),r("img",{key:c,src:c,loading:"lazy",onError:v[3]||(v[3]=(...k)=>d.imageLoadError&&d.imageLoadError(...k))},null,40,$e)),[[b,c]])),128))],8,Le)):u("",!0),l.work.artwork_assets.length>4?(o(),r("div",Ce,[(o(!0),r(V,null,B(l.work.images,(c,k)=>(o(),r("div",{key:k},[k<3?w((o(),r("img",{key:0,src:c,loading:"lazy",onError:v[4]||(v[4]=(..._)=>d.imageLoadError&&d.imageLoadError(..._))},null,40,Ie)),[[b,c]]):(o(),r("div",Me,[a("span",ze,"+"+i(l.work.artwork_assets.length-4),1),w(a("img",{src:c,class:"z-0 brightness-50",loading:"lazy",onError:v[5]||(v[5]=(..._)=>d.imageLoadError&&d.imageLoadError(..._))},null,40,Se),[[b,c]])]))]))),128))])):u("",!0)])}}},q=K(Ve,[["__scopeId","data-v-433644ba"]]),D=l=>(fe("data-v-33b27862"),l=l(),we(),l),Be={class:"flex flex-row justify-between mb-2 w-full"},De={key:0,class:"user-info"},Fe=["src"],Te={class:"name"},je=D(()=>a("br",null,null,-1)),Ae=D(()=>a("span",{class:"mx-1"},"\xB7",-1)),Ne={class:"text-xxs"},Pe={key:1,class:"flex float-right flex-row gap-2 mb-4 cursor-pointer"},Oe={key:1,class:"mb-4 w-full rounded-md theme-color-secondary"},Ue={key:0,class:"p-2 md:p-4 user-info"},Re=["src"],We={class:"name"},Ge=D(()=>a("br",null,null,-1)),qe=D(()=>a("span",{class:"mx-1"},"\xB7",-1)),Je={class:"px-2 mt-2 md:px-4"},Ke={class:"text-xs font-semibold"},Ye=["id"],He=["id"],Qe={key:2,class:"flex flex-row justify-between"},Xe={key:0},Ze={key:1},es={key:2},ss={class:"mt-6 mb-2"},ts={key:0,class:"comment-box"},as={class:"flex flex-col"},os={class:"flex relative flex-col"},rs=["readonly","rows","placeholder"],ls={key:1,class:"p-4 mb-4 text-center rounded-md theme-color-secondary"},ns=["src"],is={class:"w-full"},us={class:"flex justify-between"},ds={class:"comment-time"},cs={key:0,class:"hidden reactions"},ms=D(()=>a("div",{class:"flex flex-row"},null,-1)),vs=[ms],fs={key:1,class:"mt-4 w-full text-xs italic text-center"},ws={id:"chronological-modal",class:"modal work-view"},ks={__name:"FeedModalView",props:{id:{type:String,default:""},section:{type:String,default:""}},setup(l,{expose:F}){const d=l,v=re();le();const{oApiConfiguration:b,fetchOptions:c}=ne(),k=ke(b,c()),{generateArtworkThumb:_}=ie();ue(()=>{d.id!==""&&U(d.id),window.addEventListener("keydown",t=>{const s=document.getElementById("chronological-modal");t.key==="Escape"&&(!s||s.style.display!="flex")&&G().closeModal(`${d.section}-modal`)})});const $=d.id==="",O=g(!0),e=g({}),I=g(!1),U=async t=>{O.value=!0,x.value=[],S.value.page=0;try{const[s,m]=await k.feedDetail({id:t});if(s.feed.artworks){s.feed.artworks.images=[];for(let y=0;y<s.feed.artworks.artwork_assets.length;y++)if(y<=3){const n=await _(s.feed.artworks.artwork_assets[y].bucket,s.feed.artworks.artwork_assets[y].filename,"feed");s.feed.artworks.images.push(n)}}e.value=s.feed,I.value=s.feed.liked,await X(t)}catch{ae()}O.value=!1},R=g(null),Y=async t=>{R.value.view(t),G().openModal("chronological-modal")},H=async()=>{const[t,s]=await k.like({feedId:e.value.id});if(t){I.value=!0,e.value._count.feed_likes++;const m=document.getElementById("feedLikeButton"+e.value.id);m.classList.add("animate-bounce"),setInterval(()=>{m.classList.remove("animate-bounce")},2500)}},Q=async()=>{const[t,s]=await k.unlike({feedId:e.value.id});t&&(I.value=!1,e.value._count.feed_likes--)},x=g([]),S=g({perPage:5,page:0}),N=g([]),W=async t=>{try{const[s,m]=await k.fetchComments({feedId:t,pagination:{page:S.value.page,perPage:S.value.perPage}});return s.pagination.current_page===s.pagination.first_last.last_page?T.value=!1:T.value=!0,s.comments.forEach(y=>{N.value.push(y.id)}),s.comments}catch{}},X=async t=>{try{(await W(t)).forEach(m=>x.value.push(m))}catch{}},T=g(!1),Z=async t=>{try{S.value.page+=1,(await W(t)).forEach(m=>x.value.push(m))}catch{}},h=g(),P=200,ee=de(()=>h.value!=null&&h.value!==""?P-h.value.length:P),M=g(!1),se=async()=>{M.value=!0;try{const[t,s,m]=await k.comment({feedId:e.value.id,comment:h.value});t&&(h.value="",x.value.splice(0,0,s),x.value.join(),N.value.splice(0,0,s.id),N.value.join())}catch{}M.value=!1};g([]);const te=g(!1),ae=()=>{te.value=!0};return g(!1),g(!1),F({view:U}),(t,s)=>{const m=ve,y=J("auto-animate");return o(),r("div",{class:L(["work-container work-view z-40",$?"w-full md:w-9/12 lg:w-2/5 mx-auto md:p-6 p-4 theme-color":"w-full"])},[a("div",{class:L(["w-full",{"overflow-y-scroll pr-4":$}])},[a("div",Be,[e.value.users?(o(),r("div",De,[f(m,{to:"/profile/"+e.value.users.username},{default:p(()=>[a("img",{class:"avatar",src:t.avatarCoverUrl(e.value.users.avatar_bucket,e.value.users.avatar_filename),onError:s[0]||(s[0]=(...n)=>t.imageLoadError&&t.imageLoadError(...n))},null,40,Fe)]),_:1},8,["to"]),a("div",Te,[f(m,{to:"/profile/"+e.value.users.username,class:"fullname"},{default:p(()=>[C(i(e.value.users.name),1)]),_:1},8,["to"]),je,f(m,{to:"/profile/"+e.value.users.username,class:"username"},{default:p(()=>[C(" @"+i(e.value.users.username),1)]),_:1},8,["to"]),Ae,a("span",Ne,i(t.formatDate(e.value.created_at,!0)),1)])])):u("",!0),$?(o(),r("div",Pe,[a("div",{class:"modal-close",onClick:s[1]||(s[1]=n=>t.closeModal(l.section+"-modal"))},[f(A,{name:"i-ion-close",class:"text-2xl"})])])):u("",!0)]),e.value.text?(o(),r("div",{key:0,class:L(["mb-4",e.value.text.length<=300?"text-lg":""])},i(e.value.text),3)):u("",!0),e.value.artworks?(o(),r("div",Oe,[e.value.artworks.users?(o(),r("div",Ue,[f(m,{to:"/profile/"+e.value.artworks.users.username},{default:p(()=>[a("img",{class:"avatar",src:t.avatarCoverUrl(e.value.artworks.users.avatar_bucket,e.value.artworks.users.avatar_filename),onError:s[2]||(s[2]=(...n)=>t.imageLoadError&&t.imageLoadError(...n))},null,40,Re)]),_:1},8,["to"]),a("div",We,[f(m,{to:"/profile/"+e.value.artworks.users.username,class:"fullname hover:href"},{default:p(()=>[C(i(e.value.artworks.users.name),1)]),_:1},8,["to"]),Ge,f(m,{to:"/profile/"+e.value.artworks.users.username,class:"hover:underline text-xxs"},{default:p(()=>[C(" @"+i(e.value.artworks.users.username),1)]),_:1},8,["to"]),qe,f(m,{to:"/a/"+e.value.artworks.id,class:"hover:underline text-xxs"},{default:p(()=>[C(i(t.formatDate(e.value.artworks.scheduled_post?e.value.artworks.scheduled_post:e.value.artworks.created_at,!0)),1)]),_:1},8,["to"])])])):u("",!0),a("div",Je,[a("span",Ke,i(e.value.artworks.title),1),w(a("p",null,[a("span",{id:"feed-description-"+e.value.artworks.id},i(e.value.artworks.description.length>300?`${e.value.artworks.description.slice(0,300)}...`:e.value.artworks.description),9,Ye),e.value.artworks.description.length>300?(o(),r("a",{key:0,id:"feed-read-more-"+e.value.artworks.id,class:"href",onClick:s[3]||(s[3]=j(n=>t.readMore(e.value.artworks.description,e.value.artworks.id,"feed-read-more-","feed-description-"),["prevent"]))},i(t.$t("readMore")),9,He)):u("",!0)],512),[[E,e.value.artworks.description]])]),a("div",null,[e.value.artworks&&t.isMobile()?(o(),ce(m,{key:0,to:"/a/"+e.value.id,class:"cursor-pointer"},{default:p(()=>[f(q,{class:"p-2",work:e.value.artworks},null,8,["work"])]),_:1},8,["to"])):u("",!0),e.value.artworks&&!t.isMobile()?(o(),r("div",{key:1,class:"cursor-pointer",onClick:s[4]||(s[4]=j(n=>Y(e.value.artworks.id),["prevent"]))},[f(q,{class:"p-2 md:p-4",work:e.value.artworks},null,8,["work"])])):u("",!0)])])):u("",!0),e.value._count?(o(),r("div",Qe,[e.value._count.feed_comments?(o(),r("div",Xe,[a("b",null,i(t.thousand(e.value._count.feed_comments)),1),C(" "+i(e.value._count.feed_comments>1?t.$t("count.comments"):t.$t("count.comment")),1)])):u("",!0),e.value._count.feed_comments?u("",!0):(o(),r("div",Ze)),z(v).loggedIn?(o(),r("div",es,[a("div",{class:"flex flex-row",onClick:s[5]||(s[5]=n=>I.value?Q():H())},[w(f(A,{id:"feedLikeButton"+e.value.id,name:"i-ion-heart",class:"mr-2 text-xl text-red-500 cursor-pointer hover:text-red-500"},null,8,["id"]),[[E,I.value]]),w(f(A,{name:"i-ion-heart-outline",class:"mr-2 text-xl cursor-pointer hover:text-red-500"},null,512),[[E,!I.value]]),a("span",null,i(t.thousand(e.value._count.feed_likes)),1)])])):u("",!0)])):u("",!0),a("div",ss,[z(v).loggedIn?(o(),r("div",ts,[a("div",as,[a("div",os,[w(a("textarea",{"onUpdate:modelValue":s[6]||(s[6]=n=>h.value=n),class:L(["input form-input",[{"cursor-not-allowed":M.value},{"theme-color-secondary textarea":$}]]),readonly:M.value,cols:"20",rows:h.value!=null&&h.value!=""?"6":"0",placeholder:t.$t("comments.inputPlaceholder"),maxlength:P,"data-gramm":"false"},null,10,rs),[[me,h.value]]),w(a("span",{class:"absolute left-4 bottom-6 py-1 px-2 text-white rounded-md button-color"},i(z(ee)),513),[[E,h.value!=null&&h.value!=""]]),a("span",{class:"absolute right-2 bottom-5 py-1 px-2",onClick:s[7]||(s[7]=j(n=>se(),["prevent"]))},[w(f(A,{name:"i-ion-prism",class:"text-xl transition-all duration-100 rotate-90 cursor-pointer text-colored"},null,512),[[E,h.value!=null&&h.value!=""&&!M.value]]),w(f(ge,null,null,512),[[E,M.value]])])])])])):u("",!0),z(v).loggedIn?u("",!0):(o(),r("div",ls,i(t.$t("comments.loginOrRegisterToLeaveComment")),1))]),a("div",{class:L(["comment-content",[{"pr-3 overflow-x-hidden":$},{"mb-20":!$}]])},[(o(!0),r(V,null,B(x.value,n=>w((o(),r("div",{key:n.id,class:"flex flex-row w-full comment-item"},[f(m,{class:"mr-2",to:"/profile/"+n.users.username},{default:p(()=>[a("img",{class:"w-10 h-10 avatar",src:t.avatarCoverUrl(n.users.avatar_bucket,n.users.avatar_filename),onError:s[8]||(s[8]=(...oe)=>t.imageLoadError&&t.imageLoadError(...oe))},null,40,ns)]),_:2},1032,["to"]),a("div",is,[a("div",{class:L(["p-4 w-full rounded-md",$?"theme-color-secondary":"theme-color"])},[a("div",us,[f(m,{to:"/profile/"+n.users.username,class:"mb-2 text-xs font-medium transition-all duration-150 cursor-pointer hover:font-bold"},{default:p(()=>[C(i(n.users.name),1)]),_:2},1032,["to"]),a("div",ds,i(t.formatDate(n.created_at,!0)),1)]),a("div",null,i(n.comment),1),z(v).loggedIn?(o(),r("div",cs,vs)):u("",!0)],2)])])),[[y]])),128)),e.value._count?w((o(),r("div",{key:0,class:"text-center capitalize href",onClick:s[9]||(s[9]=j(n=>Z(e.value.id),["prevent"]))},i(t.$t("comments.loadOlder")),513)),[[E,e.value._count.feed_comments>S.value.perPage&&T.value]]):u("",!0),w(a("div",{class:"w-full text-xs italic text-center"},i(t.$t("comments.reachedTheEnd")),513),[[E,x.value.length&&!T.value]]),z(v).loggedIn&&!x.value.length?(o(),r("div",fs,i(t.$t("comments.noCommentYet")),1)):u("",!0)],2)],2),a("div",ws,[f(he,{ref_key:"sharedWorkModalViewRef",ref:R,section:"chronological"},null,512)])],2)}}},xs=K(ks,[["__scopeId","data-v-33b27862"]]);export{xs as F,q as I};
