import{o as _,m as b,p as e,e as x,K as N,i as L,j as O,r as c,t as s,b as r,v as i,J as f,s as U,U as P,V as E,u as g,q as V,E as K,G as q,a as H,l as Q,C as W,c as j,w as X,F as T,L as Y,M as Z}from"./entry.92edb670.js";import{u as z,_ as G}from"./LoadingEmptyErrorMessage.28898bf3.js";import{L as ee}from"./Layout.b3d0a815.js";import{_ as J}from"./_plugin-vue_export-helper.a1a6add7.js";import"./Spinner.57763af3.js";import"./useArtwork.e93c25cb.js";const se={class:"flex float-right flex-row gap-2 mb-2 cursor-pointer"},te={__name:"CloseModalButton",emits:["close"],setup(k,{emit:d}){const I=()=>{d("close")};return($,R)=>(_(),b("div",se,[e("div",{class:"modal-close",onClick:R[0]||(R[0]=M=>I())},[x(N,{name:"i-ion-close",class:"text-2xl"})])]))}},le={class:"w-full modal-layer xl:w-3/12 lg:w-2/5"},oe={class:"flex flex-row justify-between w-full"},ae={class:"title"},ne={class:"report_detail"},re={class:"report_detail__badge"},ie={class:"report_detail__info"},de={key:0},ue=["href"],pe={class:"tags"},ve={class:"tag"},ce={class:"my-4 custom-divider"},_e={class:"flex flex-row gap-2 justify-between"},fe=["placeholder"],me={__name:"ReportDetailModal",emits:["refresh"],setup(k,{expose:d,emit:I}){const $=L(),{oApiConfiguration:R,fetchOptions:M}=O(),p=z(R,M()),m=c(!0),w=c(!1),o=c({}),y=c([]),D=async a=>{m.value=!0,w.value=!1;const[n,v]=await p.getReportById({reportId:a});v?w.value=!0:(o.value=n,y.value=n.reasons.split(",")),m.value=!1},u=c({response:0,description:""}),C=async()=>{const[a,n]=await p.reviewReport({reportId:o.value.id,response:u.value.response,responseDescription:u.value.description});n||(await D(o.value.id),q().closeModal("report-detail-modal"),I("refresh"))};return d({view:D}),(a,n)=>(_(),b("div",null,[e("button",{class:"hidden",onClick:n[0]||(n[0]=v=>D())}),e("div",le,[e("div",oe,[e("span",ae,s(a.$t("reports.reportDetail")),1),x(te,{onClose:n[1]||(n[1]=v=>a.closeModal("report-detail-modal"))})]),x(G,{loading:m.value,error:w.value},null,8,["loading","error"]),r(e("div",ne,[e("div",re,[e("span",{class:f(o.value.status==="pending"?"bg-yellow-500":"bg-red-500")},s(o.value.status),3)]),e("div",ie,[e("section",null,[e("div",null,[e("label",null,s(a.$t("reports.reportId")),1),e("div",null," #"+s(o.value.id),1)]),e("div",null,[e("label",null,s(a.$t("reports.reportDate")),1),e("div",null,s(a.formatDate(o.value.created_at)),1)]),o.value.user_reported?(_(),b("div",de,[e("label",null,s(a.$t("reports.userReporting")),1),e("div",null,s(o.value.user_reported.username),1)])):U("",!0),e("div",null,[e("label",null,s(a.$t("reports.reportedPost")),1),e("div",null,[r(e("span",{class:"italic"},s(a.$t("reports.postRemoved")),513),[[i,o.value.is_removed]]),r(e("a",{href:(o.value.type==="artwork"?"/a/":"/feed/")+o.value.post_id,target:"blank",class:"href"},s(a.$t("reports.viewPost")),9,ue),[[i,!o.value.is_removed]])])]),e("div",null,[e("label",null,s(a.$t("reports.reportDescription")),1),e("div",null,s(o.value.description),1)]),e("div",null,[e("label",null,s(a.$t("reports.selectedReasons")),1),e("div",pe,[(_(!0),b(P,null,E(y.value,v=>(_(),b("span",ve,s(a.$t("reports.reasons."+v)),1))),256))])])]),r(e("div",ce,null,512),[[i,(g($).user.is_admin||g($).user.is_moderator)&&o.value.status==="pending"||o.value.status==="closed"]]),r(e("section",null,[e("div",_e,[e("span",{class:f(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-green-500 cursor-pointer",{"bg-green-500 text-white":u.value.response===0}]),onClick:n[2]||(n[2]=v=>u.value.response=0)},[r(x(N,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,u.value.response===0]]),V(" "+s(a.$t("reports.decisions.doNotRemove")),1)],2),e("span",{class:f(["flex flex-row justify-center p-2 w-full rounded-md border-2 border-red-500 cursor-pointer",{"bg-red-500 text-white":u.value.response===1}]),onClick:n[3]||(n[3]=v=>u.value.response=1)},[r(x(N,{name:"i-ion-checkmark-outline",class:"mr-2 font-bold text-white"},null,512),[[i,u.value.response===1]]),V(" "+s(a.$t("reports.decisions.remove")),1)],2)]),e("div",null,[r(e("textarea",{"onUpdate:modelValue":n[4]||(n[4]=v=>u.value.description=v),class:"form-input input textarea",rows:"5",cols:"0",placeholder:a.$t("description"),"data-gramm":"false"},null,8,fe),[[K,u.value.description]])]),e("button",{class:f(u.value.description?"primary-button":"disabled-button"),onClick:n[5]||(n[5]=v=>C())},s(a.$t("reports.submitReviewAndClose")),3)],512),[[i,(g($).user.is_admin||g($).user.is_moderator)&&o.value.status==="pending"]]),r(e("section",null,[e("div",null,[e("label",null,s(a.$t("reports.decision")),1),e("div",null,[e("span",{class:f(["font-bold uppercase",o.value.response?"text-green-500":"text-red-500"])},s(o.value.response?"Removed":"Not removed"),3)])]),e("div",null,[e("label",null,s(a.$t("description")),1),e("div",null,s(o.value.response_description),1)]),e("div",null,[e("label",null,s(a.$t("reports.decisionMadeAt")),1),e("div",null,s(a.formatDate(o.value.responded_at)),1)])],512),[[i,o.value.status==="closed"]])])],512),[[i,!m.value]])])]))}},ge=J(me,[["__scopeId","data-v-9102dd9e"]]);const B=k=>(Y("data-v-5371471a"),k=k(),Z(),k),he={class:"reports"},be={class:"reports__title"},$e=B(()=>e("div",{class:"reports__filters"},null,-1)),we={class:"reports__list"},ye={class:"hidden-md-flex"},ke={class:"reports__table",cellspacing:"0",cellpadding:"0"},Re={class:"rounded-l-md"},De=B(()=>e("th",null,[e("div",{class:"rounded-r-md"},"\xA0")],-1)),Ce={class:"rounded-l-md"},xe=["onClick"],Ie=["href"],Me=["href"],Ae={class:"font-bold uppercase"},Ne={class:"font-bold uppercase"},Pe={class:"rounded-r-md"},Ee=["onClick"],Be=["href"],Fe={class:"text-right md:text-left"},Se={class:"font-bold uppercase"},Ve={class:"font-bold uppercase"},je=B(()=>e("label",null,"\xA0",-1)),Te=["href"],Le=["onClick"],Oe={class:"reports__pagination"},Ue={__name:"index",setup(k){const d=L(),{oApiConfiguration:I,fetchOptions:$}=O(),R=z(I,$()),{$router:M}=H();Q(async()=>{d.loggedIn?await y():M.push("/")});const p=c({loading:!1,pagination:{page:0,perPage:10}}),m=c({status:"all",filterDateFrom:void 0,filterDateTo:void 0,userId:W(()=>{if(d.loggedIn&&!d.user.is_admin&&!d.user.is_moderator)return d.user.id}),selectedReasons:void 0}),w=c([]),o=c({}),y=async()=>{u(),p.value.loading=!0;const[l,h,t]=await R.getReports({status:m.value.status,createdAtFrom:m.value.filterDateFrom,createdAtTo:m.value.filterDateTo,userId:m.value.userId,reasons:m.value.selectedReasons,pagination:{page:p.value.pagination.page,perPage:p.value.pagination.perPage}});t?v():(h.record_total<=0&&a(),w.value=l,o.value=h),p.value.loading=!1},D=async l=>{l==="next"?p.value.pagination.page++:p.value.pagination.page--,await y()},u=()=>{C.value=!1,n.value=!1},C=c(!1),a=()=>{C.value=!0},n=c(!1),v=()=>{n.value=!0},F=c(null),A=l=>{F.value.view(l),q().openModal("report-detail-modal")};return(l,h)=>(_(),j(ee,{"hide-side":!0,"no-right-side":!0},{default:X(()=>[e("div",he,[e("div",be,s(g(d).user.is_admin||g(d).user.is_moderator?l.$t("reports.reports"):l.$t("reports.yourReports")),1),$e,e("div",we,[r(e("div",null,[e("div",ye,[e("table",ke,[e("thead",null,[e("tr",null,[e("th",null,[e("div",Re,s(l.$t("reports.reportId")),1)]),e("th",null,[e("div",null,s(l.$t("reports.reportDate")),1)]),r(e("th",null,[e("div",null,s(l.$t("reports.user")),1)],512),[[i,g(d).user.is_moderator&&g(d).user.is_admin]]),e("th",null,[e("div",null,s(l.$t("reports.post")),1)]),e("th",null,[e("div",null,s(l.$t("reports.description")),1)]),e("th",null,[e("div",null,s(l.$t("reports.status")),1)]),e("th",null,[e("div",null,s(l.$t("reports.decision")),1)]),De])]),e("tbody",null,[(_(!0),b(P,null,E(w.value,t=>(_(),b("tr",{key:t.id},[e("td",null,[e("div",Ce,[e("a",{class:"font-bold hover:underline href",onClick:T(S=>A(t.id),["prevent"])}," #"+s(t.id),9,xe)])]),e("td",null,[e("div",null,s(l.formatDate(t.created_at)),1)]),r(e("td",null,[e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,Ie)])],512),[[i,g(d).user.is_moderator&&g(d).user.is_admin]]),e("td",null,[e("div",null,[r(e("span",{class:"italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),r(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"href"},s(l.$t("reports.viewPost")),9,Me),[[i,!t.is_removed]])])]),e("td",null,[e("div",null,s(t.description.length>300?`${t.description.slice(0,300)}...`:t.description),1)]),e("td",Ae,[e("div",null,[e("span",{class:f(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("td",null,[e("div",Ne,[r(e("span",null,"-",512),[[i,t.status==="pending"]]),r(e("span",{class:f(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3),[[i,t.status==="closed"]])])]),e("td",Pe,[e("div",null,[e("a",{class:"underline href",onClick:T(S=>A(t.id),["prevent"])},s(l.$t("reports.moreInfo")),9,Ee)])])]))),128))])])]),(_(!0),b(P,null,E(w.value,t=>(_(),b("div",{key:t.id,class:"reports__cards"},[e("div",null,[e("label",null,s(l.$t("reports.user")),1),e("div",null,[e("a",{href:"/profile/"+t.user_reported.username,target:"blank",class:"font-bold href"},s(t.user_reported.username),9,Be)])]),e("div",null,[e("label",null,s(l.$t("reports.description")),1),e("div",Fe,s(t.description),1)]),e("div",null,[e("label",null,s(l.$t("reports.reportDate")),1),e("div",null,s(l.formatDate(t.created_at)),1)]),e("div",null,[e("label",null,s(l.$t("reports.status")),1),e("div",Se,[e("div",{class:f(["text-white uppercase badge text-xxs",t.status==="pending"?"bg-yellow-500":"bg-red-500"])},s(t.status),3)])]),e("div",null,[e("label",null,s(l.$t("reports.decision")),1),e("div",Ve,[e("span",{class:f(["text-white uppercase badge text-xxs",t.response?"bg-green-500":"bg-red-500"])},s(t.response?"Removed":"Not removed"),3)])]),e("div",null,[je,e("div",null,[r(e("span",{class:"mr-2 italic"},s(l.$t("reports.postRemoved")),513),[[i,t.is_removed]]),r(e("a",{href:(t.type==="artwork"?"/a/":"/feed/")+t.post_id,target:"blank",class:"mr-2 underline href"},s(l.$t("reports.viewReportedPost")),9,Te),[[i,!t.is_removed]]),e("div",{class:"underline href",onClick:S=>A(t.id)},s(l.$t("reports.moreInfo")),9,Le)])])]))),128)),r(e("div",Oe,[e("button",{class:f(o.value.next_previous&&o.value.next_previous.prev_page!==null?"primary-button":"disabled-button"),onClick:h[0]||(h[0]=t=>D("prev"))},s(l.$t("pagination.previous")),3),e("button",{class:f(o.value.next_previous&&o.value.next_previous.next_page!==null?"primary-button":"disabled-button"),onClick:h[1]||(h[1]=t=>D("next"))},s(l.$t("pagination.next")),3)],512),[[i,o.value.total_page>0]])],512),[[i,!p.value.loading&&!C.value&&!n.value]]),x(G,{loading:p.value.loading,empty:C.value,error:n.value,fetch:y},null,8,["loading","empty","error"])])]),p.value.loading?U("",!0):(_(),j(ge,{key:0,id:"report-detail-modal",ref_key:"reportDetailModalRef",ref:F,class:"modal",onRefresh:h[2]||(h[2]=t=>y())},null,512))]),_:1}))}},Qe=J(Ue,[["__scopeId","data-v-5371471a"]]);export{Qe as default};
