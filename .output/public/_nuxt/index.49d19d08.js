import{l as j,k as q,p as U,r as c,P as J,o as x,q as L,b as n,t as _,f as l,w as B,s as V,Q as S,u as t,I as $,x as z,e as A,v as R,y as K,U as D,O as w,h as X,a as Z,L as ee,c as T}from"./entry.e59d1677.js";import{u as oe}from"./useI18n.afc07abc.js";import{L as te}from"./Layout.38bbd337.js";import{u as ae}from"./ProBadge.e613df9a.js";import{W as se}from"./WorkList.15e244e9.js";import{_ as le}from"./LoadingEmptyErrorMessage.81ae6689.js";import{_ as ne}from"./_plugin-vue_export-helper.a1a6add7.js";import{M as I}from"./ModalView.7f38a5de.js";import{u as ie}from"./useUser.6aeea3ba.js";import"./useReport.1b995e30.js";import"./index.6cdba04a.js";import"./MiniArtworkPreview.23fe0d3b.js";import"./user-counters-api.efc5c534.js";import"./useSetting.3e22411d.js";import"./useFeed.6f185801.js";const re={id:"lists"},ce={class:"navigations"},ue={class:"title hidden-md-flex"},pe={class:"buttons"},de={key:0,class:"filter-buttons"},fe={class:"hidden-md-flex"},me={__name:"List",props:{title:{type:String,default:""},section:{type:String,default:""},paginationProp:{type:Object,default(){return{perPage:{type:Number,default:10},maxLoadMore:{type:Number,default:5}}}},discoverRoute:{type:String,default:"/"}},emits:["view"],setup(d,{emit:i}){const a=d,u=j(),{oApiConfiguration:s,fetchOptions:y}=q(),M=ae(s,y());U(async()=>{await k()});const v=c([]),k=async()=>{const e=await O();if(e){const r=e.works,o=e.pagination;v.value=r,o.record_total<=f.perPage&&P(),o.record_total===0&&Q()}else W()},g=c(!0),p=c(void 0),f=J({perPage:a.paginationProp.perPage,page:c(0)}),O=async()=>{f.page===0&&(g.value=!0);try{let e,r;if(a.section==="recent"){const[o,m]=await M.getLatest({pagination:{page:f.page,perPage:f.perPage},explicitMode:p.value});o?e=o:r=m}else if(a.section==="following"){const[o,m]=await M.getFollowing({pagination:{page:f.page,perPage:f.perPage},explicitMode:p.value});o?e=o:r=m}else if(a.section==="popular"){const[o,m]=await M.getMostPopular({pagination:{page:f.page,perPage:f.perPage},explicitMode:p.value,range:"daily",rangeMode:"views"});o?e=o:r=m}return f.page+=1,Y(),e}catch{W()}},h=c({delay:!1,maxLoad:a.paginationProp.maxLoadMore,showDiscoveryButton:!1}),H=async()=>{h.value.delay=!0;const e=await O(),r=e.works,o=e.pagination;r.forEach(m=>{v.value.push(m)}),h.value.delay=!1,o.next_previous.next_page||P(),o.next_previous.next_page&&o.current_page===h.value.maxLoad&&(P(),h.value.showDiscoveryButton=!0)},E=c(!0),P=()=>{E.value=!1},b=c(!1),Q=()=>{b.value=!0,P()},C=c(!1),W=()=>{g.value=!1,C.value=!0,P()},Y=()=>{g.value=!1,b.value=!1,C.value=!1},F=e=>{p.value=e,f.page=0,E.value=!0,h.value.showDiscoveryButton=!1,k()},G=e=>{i("view",e)};return(e,r)=>{const o=K;return x(),L("div",null,[n("div",re,[n("div",ce,[n("div",ue,_(d.title),1),l(o,{to:d.discoverRoute,class:"flex flex-row justify-between title md:hidden"},{default:B(()=>[V(_(d.title)+" ",1),l(S,{name:"i-fluent-arrow-enter-20-filled",class:"text-xl text-colored"})]),_:1},8,["to"]),n("div",pe,[t(u).loggedIn&&t(u).user.user_settings&&t(u).user.user_settings.show_explicit?(x(),L("div",de,[n("p",{class:$(["rounded-l-md button-item",[t(p)===void 0?"button":"theme-color"]]),onClick:r[0]||(r[0]=m=>F(void 0))},_(e.$t("default")),3),n("p",{class:$(["button-item",[t(p)==="safe"?"button":"theme-color"]]),onClick:r[1]||(r[1]=m=>F("safe"))},_(e.$t("safe")),3),n("p",{class:$(["rounded-r-md button-item",[t(p)==="explicit"?"button":"theme-color"]]),onClick:r[2]||(r[2]=m=>F("explicit"))},[l(S,{name:"i-material-symbols-explicit-outline",class:$({"text-white":t(p)==="explicit"})},null,8,["class"]),V(" "+_(e.$t("explicit")),1)],2)])):z("",!0),n("div",fe,[l(o,{class:"discover-button",to:d.discoverRoute},{default:B(()=>[V(_(e.$t("seeMore")),1)]),_:1},8,["to"])])])]),l(le,{loading:t(g),empty:t(b),"empty-message":e.$t("artworks.noArtworkYet"),error:t(C),fetch:k},null,8,["loading","empty","empty-message","error"]),A(n("div",null,[A(l(se,{"section-class":"work-grid-10",works:t(v),view:G},null,8,["works"]),[[R,!t(b)]]),A(n("div",{class:$(["w-full primary-button",t(h).delay?"animate-pulse":""]),onClick:H},_(e.$t("loadMore")),3),[[R,t(E)]]),A(n("div",null,[l(o,{to:"/artworks/"+d.section,class:"w-full primary-button"},{default:B(()=>[l(S,{name:"i-fluent-arrow-enter-20-filled",class:"mr-1 text-white hover:text-white"}),V(" "+_(e.$t("seeMore")),1)]),_:1},8,["to"])],512),[[R,t(h).showDiscoveryButton]])],512),[[R,!t(g)]])])])}}},N=ne(me,[["__scopeId","data-v-a01236f2"]]),ge={id:"recent-modal",class:"modal work-view"},we={__name:"Recent",setup(d){const i={perPage:30,maxLoadMore:2},a=c(null),u=s=>{a.value.view(s),w().openModal("recent-modal")};return(s,y)=>(x(),L(D,null,[l(N,{section:"recent",title:s.$t("artworks.latestArtworks"),"pagination-prop":{perPage:i.perPage,maxLoadMore:i.maxLoadMore},"discover-route":"/artworks/recent",onView:u},null,8,["title","pagination-prop"]),n("div",ge,[l(I,{ref_key:"recentModalViewRef",ref:a,section:"recent"},null,512)])],64))}},ve={id:"following-modal",class:"modal work-view"},_e={__name:"Following",setup(d){const i={perPage:10,maxLoadMore:4},a=c(null),u=s=>{a.value.view(s),w().openModal("following-modal")};return(s,y)=>(x(),L(D,null,[l(N,{section:"following",title:s.$t("followings.followings"),"pagination-prop":{perPage:i.perPage,maxLoadMore:i.maxLoadMore},"discover-route":"/artworks/following","custom-empty-message":s.$t("explores.noFollowing"),onView:u},null,8,["title","pagination-prop","custom-empty-message"]),n("div",ve,[l(I,{ref_key:"followingModalViewRef",ref:a,section:"following"},null,512)])],64))}},he={id:"popular-modal",class:"modal work-view"},xe={__name:"Popular",setup(d){const i={perPage:10,maxLoadMore:4},a=c(null),u=s=>{a.value.view(s),w().openModal("popular-modal")};return(s,y)=>(x(),L(D,null,[l(N,{section:"popular",title:s.$t("artworks.dailyPopular"),"pagination-prop":{perPage:i.perPage,maxLoadMore:i.maxLoadMore},"discover-route":"/artworks/popular",onView:u},null,8,["title","pagination-prop"]),n("div",he,[l(I,{ref_key:"popularModalViewRef",ref:a,section:"popular"},null,512)])],64))}},ye={class:"flex flex-col gap-12 px-2 mt-2 w-full"},Ie={__name:"index",setup(d){const i=j(),{oApiConfiguration:a,fetchOptions:u}=q(),s=ie(a,u()),{t:y}=oe();X({title:y("explore")}),U(()=>{i.loggedIn&&k()});const M=Z();ee(()=>M.query,g=>{setTimeout(()=>{w().closeModal("recent-modal"),w().closeModal("popular-modal"),w().closeModal("following-modal"),w().closeModal("collection-selection-modal"),w().closeModal("album-selection-modal"),w().closeModal("report-modal")},50)});const v=c(!1),k=async()=>{v.value=!1;const[g,p]=await s.countFollowings(i.user.id);p?v.value=!1:v.value=g>0};return(g,p)=>(x(),T(te,{"with-footer":!0,"hide-side":!0,"no-right-side":!0,fullscreen:!0},{default:B(()=>[n("div",ye,[l(we),t(i).loggedIn&&t(v)?(x(),T(_e,{key:0})):z("",!0),l(xe)])]),_:1}))}};export{Ie as default};
