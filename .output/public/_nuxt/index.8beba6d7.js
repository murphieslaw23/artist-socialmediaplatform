import{k as Y,o as a,p as u,q as o,e as i,L as m,t as r,K as w,$ as de,j as ue,f as pe,I as _e,l as he,O as me,Y as ke,m as ve,E as W,r as k,u as p,c as P,w as _,x as d,s as h,Q as we,P as fe,T as ge,b as R,v as V,H as y,G as M,M as xe,N as ye,y as be}from"./entry.15cb71bb.js";import{u as Me,J as $e}from"./client-only.407c3fea.js";import{u as Ce}from"./useFeed.a800ee91.js";import{u as Ie}from"./useI18n.93778397.js";import{M as Se,a as Le,S as Fe,u as Te,b as Ae,c as Re}from"./ModalView.8a38a44a.js";import{u as Ve}from"./WorkList.d666493b.js";import{L as Ee}from"./Layout.69b2e7d1.js";import{F as He,I as B}from"./FeedModalView.b0e0320b.js";import{_ as z}from"./_plugin-vue_export-helper.a1a6add7.js";import"./useReport.6a600d64.js";import"./LoadingEmptyErrorMessage.31b597d2.js";import"./Spinner.cb390d69.js";import"./user-counters-api.e38b184e.js";import"./useSetting.56adc0e9.js";const Oe={class:"feed__left-buttons"},Pe={class:"hidden ml-3 lg:block"},Be={class:"hidden ml-3 lg:block"},Ne={class:"hidden ml-3 lg:block"},De={__name:"FeedLeftSide",props:{currentView:{type:String,default:"feed"}},emits:["refetch"],setup(g,{emit:f}){Y();const L=b=>{f("refetch",b)};return(b,x)=>(a(),u("div",Oe,[o("button",{onClick:x[0]||(x[0]=F=>L("feed")),class:w(["left-button",g.currentView=="feed"?"theme-colored":"theme-color"])},[i(m,{name:"i-akar-icons-home",class:"text-lg hover:text-white"}),o("span",Pe,r(b.$t("feeds.all")),1)],2),o("button",{onClick:x[1]||(x[1]=F=>L("text")),class:w(["left-button",g.currentView=="text"?"theme-colored":"theme-color"])},[i(m,{name:"i-ion-text-sharp",class:"text-lg hover:text-white"}),o("span",Be,r(b.$t("feeds.textOnly")),1)],2),o("button",{onClick:x[2]||(x[2]=F=>L("artwork")),class:w(["left-button",g.currentView=="artwork"?"theme-colored":"theme-color"])},[i(m,{name:"i-gg-image",class:"text-lg hover:text-white"}),o("span",Ne,r(b.$t("feeds.artworkOnly")),1)],2)]))}},Ue=z(De,[["__scopeId","data-v-47eb3c7f"]]),ze={};function je(g,f){return a(),u("div")}const Ge=z(ze,[["render",je]]);const S=g=>(xe("data-v-b13b808a"),g=g(),ye(),g),qe={class:"mx-auto w-full"},Je={key:0,class:"flex flex-row gap-x-2 justify-center mb-4"},Ke={class:"grid grid-cols-1 gap-1 mx-auto md:gap-2 xl:w-10/12"},Qe={class:"flex flex-row rounded-md theme-color"},We={class:"w-full"},Ye={key:0,class:"p-2 md:p-4 user-info"},Xe=["src"],Ze={class:"name"},et=S(()=>o("br",null,null,-1)),tt=S(()=>o("span",{class:"mx-1"},"\xB7",-1)),ot={key:1,class:"px-2 md:px-4"},st={class:"title"},it={key:0},lt=["id","innerHTML"],rt=["id","onClick"],at={key:2,class:"px-2 mt-2 -mb-2 md:px-4"},nt=["href"],ct={class:"text-xs"},dt={class:"inline-block flex-row w-full rounded-md"},ut=["src"],pt={class:"title"},_t=["onClick"],ht={key:3,class:"px-2 md:px-4"},mt=["innerHTML","id"],kt=["id","onClick"],vt={key:2,class:"my-2 w-full rounded-md theme-color-secondary"},wt={key:0,class:"p-2 md:p-4 user-info"},ft=["src"],gt={class:"name"},xt=S(()=>o("br",null,null,-1)),yt=S(()=>o("span",{class:"mx-1"},"\xB7",-1)),bt={class:"px-2 mt-2 md:px-4"},Mt={class:"title"},$t={key:0},Ct=["id","innerHTML"],It=["id","onClick"],St=["onClick"],Lt={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},Ft={class:"mx-auto mt-2 primary-button"},Tt={key:0,class:"p-2 mx-auto w-full text-center rounded-md opacity-90 theme-color"},At={class:"mx-auto mt-2 primary-button"},Rt={class:"float-right mx-4 mt-2 interactions"},Vt={key:0,class:"reactions"},Et=["onClick"],Ht=["onClick"],Ot=["onClick"],Pt={class:"option dropdown"},Bt={type:"button","aria-haspopup":"true","aria-expanded":"true","aria-controls":"option-dropdown-items"},Nt={class:"option-dropdown dropdown-menu"},Dt={id:"option-dropdown-items",class:"w-52 toggler","aria-labelledby":"option-dropdown-buttons",role:"menu"},Ut={class:"menu-wrapper"},zt=S(()=>o("div",{class:"custom-divider"},null,-1)),jt=["onClick"],Gt={class:"mx-auto text-center"},qt={class:"mx-auto text-center"},Jt={class:"mx-auto text-center"},Kt=S(()=>o("br",null,null,-1)),Qt={id:"chronological-modal",class:"modal work-view"},Wt={id:"chronological-feed-modal",class:"z-30 modal work-view"},Yt={__name:"index",props:{changeMode:{type:Function,default:()=>{}}},setup(g){const f=Y(),{generateArtworkThumb:L}=de(),{oApiConfiguration:b,fetchOptions:x}=ue(),F=Me(b,x()),N=Ce(b,x());pe({title:Ie().tl("meta.title.feed.feed")});const X=_e(),Z=he(),ee=me();ke(()=>{f.loggedIn||Z.push({path:"/explore"})}),ve(()=>{}),W(()=>ee.query,()=>{re(),y().closeModal("feed-collection-selection-modal"),y().closeModal("collection-selection-modal"),y().closeModal("album-selection-modal"),y().closeModal("report-modal")});const $=k({explicitMode:void 0,pagination:{page:0,perPage:10}}),E=k(!0),C=k(!1),T=k([]),H=k("feed"),te=async({loaded:t})=>{const[l,n]=await N.getChronologicalFeeds({fetchMode:H.value,explicitMode:$.value.explicitMode,showAllTextPost:C.value,pagination:{page:$.value.pagination.page,perPage:$.value.pagination.perPage}});if($.value.pagination.page+=1,l.feeds.length)for(let e=0;e<l.feeds.length;e++){const s=l.feeds[e];if(s.liked&&(s.type==="artwork"?v.value.push("a-"+s.id):v.value.push("f-"+s.id)),s.images=[],s.apply_explicit_filter=!1,s.type==="artwork"||s.type==="feed"&&s.artwork_share_info!=null){s.type==="artwork"&&s.saved&&I.value.push(s.id);for(let c=0;c<s.artwork_assets.length;c++)if(c<=3){const ce=await L(s.artwork_assets[c].bucket,s.artwork_assets[c].filename,"feed");s.images.push(ce)}s.artwork_share_info!=null&&(!f.loggedIn&&s.artwork_share_info.is_explicit||s.artwork_share_info.is_explicit&&!f.user.user_settings.show_explicit)&&(s.apply_explicit_filter=!0)}T.value.push(s)}t(l.feeds.length,$.value.pagination.perPage)};W(()=>C.value,()=>{j()});const oe=t=>{H.value=t,j()},j=()=>{$.value.pagination.page=0,T.value=[],E.value=!0},G=k(null),O=(t,l,n)=>{l?T.value[n].apply_explicit_filter=!1:(G.value.view(t),y().openModal("chronological-modal"))},q=k(null),se=t=>{q.value.view(t),y().openModal("chronological-feed-modal")},D=(t,l,n,e)=>{Ae().readMore(t,l,n,e)},J=k(!1);let ie;const le=t=>{const l=k(X.public.appUrl+t),{copy:n}=Ve({source:l});n(),Re().splash(ie,J,"copy-alert")},I=k([]),v=k([]),K=async(t,l)=>{const n=parseInt(t.split("-")[1]);let e=!1;if(l==="artwork"){const[s,c]=await F.like({workId:n});e=s}else if(l==="feed"){const[s,c]=await N.like({feedId:n});e=s}if(e){v.value.push(t);const s=document.getElementById(`feed-like-button-${l}-${n}`);s.classList.add("animate-bounce"),setInterval(()=>{s.classList.remove("animate-bounce")},2500)}},Q=async(t,l)=>{const n=parseInt(t.split("-")[1]);let e=!1;if(l==="artwork"){const[s,c]=await F.unlike({workId:n});e=s}else if(l==="feed"){const[s,c]=await N.unlike({feedId:n});e=s}if(e){const s=v.value.indexOf(t);v.value.splice(s,1)}},re=()=>{y().closeModal("chronological-modal"),y().closeModal("chronological-feed-modal")},U=k(null),A=k(0),ae=t=>{A.value=t,y().openModal("feed-collection-selection-modal"),U.value.fetchCollection(),U.value.fetchCurrentSaved()},ne=t=>{if(t){const l=I.value.indexOf(A.value);I.value.splice(l,1)}else I.value.push(A.value);Te().animate("save-to-collection-button-"+A.value)};return(t,l)=>{const n=be;return p(f).loggedIn?(a(),P(Ee,{key:0,"with-footer":!0,"hide-side":t.isMobileDevice(),"no-right-side":t.isMobile()},{"left-side":_(()=>[p(T).length?(a(),P(Ue,{key:0,"current-view":p(H),onRefetch:oe},null,8,["current-view"])):d("",!0)]),"right-side":_(()=>[i(Ge)]),default:_(()=>[o("div",qe,[p(H)=="text"?(a(),u("div",Je,[o("button",{onClick:l[0]||(l[0]=e=>C.value=!1),class:w(p(C)==!1?"primary-button":"light-button")},[i(m,{name:"i-fluent-people-checkmark-24-regular"}),h(" "+r(t.$t("followings.followingOnly")),1)],2),o("button",{onClick:l[1]||(l[1]=e=>C.value=!0),class:w(p(C)==!0?"primary-button":"light-button")},[i(m,{name:"i-heroicons-globe-asia-australia"}),h(" "+r(t.$t("followings.global")),1)],2)])):d("",!0),o("div",Ke,[(a(!0),u(fe,null,we(p(T),(e,s)=>(a(),u("div",{key:e.id+e.type,class:"rounded-md lg:mx-6"},[o("div",Qe,[o("div",We,[e.users?(a(),u("div",Ye,[i(n,{to:"/profile/"+e.users.username},{default:_(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.users.avatar_bucket,e.users.avatar_filename),onError:l[2]||(l[2]=(...c)=>t.imageLoadError&&t.imageLoadError(...c))},null,40,Xe)]),_:2},1032,["to"]),o("div",Ze,[i(n,{to:"/profile/"+e.users.username,class:"fullname hover:href"},{default:_(()=>[h(r(e.users.name),1)]),_:2},1032,["to"]),et,i(n,{to:"/profile/"+e.users.username,class:"hover:underline text-xxs"},{default:_(()=>[h(" @"+r(e.users.username),1)]),_:2},1032,["to"]),tt,i(n,{to:(e.type==="artwork"?"/a/":"/feed/")+e.id,class:"hover:underline text-xxs"},{default:_(()=>[h(r(t.formatDate(e.scheduled_post?e.scheduled_post:e.created_at,!0)),1)]),_:2},1032,["to"])])])):d("",!0),e.type==="artwork"?(a(),u("div",ot,[o("span",st,r(e.title),1),e.description?(a(),u("p",it,[o("span",{id:"feed-description-"+e.id,innerHTML:e.description.length>300?`${e.description.slice(0,300)}...`:e.description},null,8,lt),e.description.length>300?(a(),u("a",{key:0,id:"feed-read-more-"+e.id,class:"href",onClick:M(c=>D(e.description,e.id,"feed-read-more-","feed-description-"),["prevent"])},r(t.$t("readMore")),9,rt)):d("",!0)])):d("",!0)])):d("",!0),e.redraw_of&&e.redrawed_artwork_info?(a(),u("div",at,[o("a",{href:"/a/"+e.redraw_of,target:"_blank",class:"flex flex-col gap-2 p-2 w-full rounded-md theme-color-secondary hover:theme-colored"},[o("i",ct,r(t.$t("artworks.redrawed")),1),o("div",dt,[o("img",{preload:"",loading:"lazy",class:"inline-block mr-2 w-10 rounded-md",src:t.artworkThumb(e.redrawed_artwork_info.artwork_assets.bucket,e.redrawed_artwork_info.artwork_assets.filename,"thumbnail",!1),onError:l[3]||(l[3]=(...c)=>t.imageLoadError&&t.imageLoadError(...c))},null,40,ut),o("span",pt,r(e.redrawed_artwork_info.title),1)])],8,nt)])):d("",!0),o("div",null,[o("div",null,[e.type==="artwork"&&!t.isMobile()?(a(),u("div",{key:0,class:"cursor-pointer",onClick:M(c=>O(e.id),["prevent"])},[i(B,{class:"p-2 md:p-4",work:e},null,8,["work"])],8,_t)):d("",!0),e.type==="artwork"&&t.isMobile()?(a(),P(n,{key:1,to:"/a/"+e.id,class:"cursor-pointer"},{default:_(()=>[i(B,{class:"p-2",work:e},null,8,["work"])]),_:2},1032,["to"])):d("",!0)])]),e.type==="feed"?(a(),u("div",ht,[e.text?(a(),u("p",{key:0,innerHTML:e.text.split("<br>").length>3&&e.text.length>300?`${e.text.slice(0,300)}...`:e.text,id:"feed-text-"+e.id,class:w(["mt-2",{"mb-2":!e.artwork_share_info}])},null,10,mt)):d("",!0),e.text&&e.text.split("<br>").length>3&&e.text.length>300?(a(),u("a",{key:1,id:"feed-read-more-"+e.id,class:"href",onClick:M(c=>D(e.text,e.id,"feed-read-more-","feed-text-"),["prevent"])},r(t.$t("readMore")),9,kt)):d("",!0),e.artwork_share_info?(a(),u("div",vt,[e.artwork_share_info.user?(a(),u("div",wt,[i(n,{to:"/profile/"+e.artwork_share_info.user.username},{default:_(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.artwork_share_info.user.avatar_bucket,e.artwork_share_info.user.avatar_filename),onError:l[4]||(l[4]=(...c)=>t.imageLoadError&&t.imageLoadError(...c))},null,40,ft)]),_:2},1032,["to"]),o("div",gt,[i(n,{to:"/profile/"+e.artwork_share_info.user.username,class:"fullname hover:href"},{default:_(()=>[h(r(e.artwork_share_info.user.name),1)]),_:2},1032,["to"]),xt,i(n,{to:"/profile/"+e.artwork_share_info.user.username,class:"hover:underline text-xxs"},{default:_(()=>[h(" @"+r(e.artwork_share_info.user.username),1)]),_:2},1032,["to"]),yt,i(n,{to:"/a/"+e.artwork_share_info.id,class:"hover:underline text-xxs"},{default:_(()=>[h(r(t.formatDate(e.artwork_share_info.scheduled_post?e.artwork_share_info.scheduled_post:e.artwork_share_info.created_at,!0)),1)]),_:2},1032,["to"])])])):d("",!0),o("div",bt,[o("span",Mt,r(e.artwork_share_info.title),1),e.artwork_share_info.description?(a(),u("p",$t,[o("span",{id:"feed-description-"+e.artwork_share_info.id,innerHTML:e.artwork_share_info.description.length>300?`${e.artwork_share_info.description.slice(0,300)}...`:e.artwork_share_info.description},null,8,Ct),e.artwork_share_info.description.length>300?(a(),u("a",{key:0,id:"feed-read-more-"+e.artwork_share_info.id,class:"href",onClick:M(c=>D(e.artwork_share_info.description,e.artwork_share_info.id,"feed-read-more-","feed-description-"),["prevent"])},r(t.$t("readMore")),9,It)):d("",!0)])):d("",!0)]),o("div",null,[t.isMobile()?d("",!0):(a(),u("div",{key:0,class:w(["p-2",{"cursor-pointer":!e.apply_explicit_filter}]),onClick:M(c=>O(e.artwork_share_info.id,e.apply_explicit_filter,s),["prevent"])},[o("div",{class:w(["overflow-hidden relative p-2 rounded-md",{"md:mx-2":e.apply_explicit_filter}])},[i(B,{class:w([{"blur-3xl unclickable":e.apply_explicit_filter},e.apply_explicit_filter?"brightness-50":"brightness-100"]),work:e},null,8,["class","work"]),e.apply_explicit_filter?(a(),u("div",Lt,[o("div",null,r(p(f).loggedIn?t.$t("explicitContentAlert"):t.$t("explicitContentAlertForGuest")),1),o("button",Ft,r(t.$t("explicitShowMeThisContent")),1)])):d("",!0)],2)],10,St)),t.isMobile()?(a(),P(n,{key:1,to:e.apply_explicit_filter?null:"/a/"+e.artwork_share_info.id,onClick:M(c=>O(e.artwork_share_info.id,e.apply_explicit_filter,s),["prevent"]),class:"cursor-pointer"},{default:_(()=>[o("div",{class:w(["overflow-hidden relative p-2 rounded-md",{"m-2":e.apply_explicit_filter}])},[i(B,{class:w([{"blur-3xl unclickable":e.apply_explicit_filter},e.apply_explicit_filter?"brightness-50":"brightness-100"]),work:e},null,8,["class","work"]),e.apply_explicit_filter?(a(),u("div",Tt,[o("div",null,r(p(f).loggedIn?t.$t("explicitContentAlert"):t.$t("explicitContentAlertForGuest")),1),o("button",At,r(t.$t("explicitShowMeThisContent")),1)])):d("",!0)],2)]),_:2},1032,["to","onClick"])):d("",!0)])])):d("",!0)])):d("",!0),o("div",Rt,[p(f).loggedIn?(a(),u("div",Vt,[o("span",{onClick:c=>e.type==="artwork"?p(v).includes("a-"+e.id)?Q("a-"+e.id,e.type):K("a-"+e.id,e.type):p(v).includes("f-"+e.id)?Q("f-"+e.id,e.type):K("f-"+e.id,e.type)},[R(i(m,{id:"feed-like-button-"+e.type+"-"+e.id,name:"i-ion-heart",class:"mr-1 text-red-500 hover:text-red-500"},null,8,["id"]),[[V,e.type==="artwork"?p(v).includes("a-"+e.id):p(v).includes("f-"+e.id)]]),R(i(m,{name:"i-ri-heart-3-line",class:"mr-1 icon-color hover:text-red-500"},null,512),[[V,e.type==="artwork"?!p(v).includes("a-"+e.id):!p(v).includes("f-"+e.id)]]),h(" "+r(t.thousand(e._count.likes)),1)],8,Et),o("span",{onClick:M(c=>e.type==="artwork"?O(e.id):se(e.id),["prevent"])},[i(m,{name:"i-mdi-comment-multiple-outline",class:"mr-1 icon-color hover:text-blue-500"}),h(" "+r(t.thousand(e._count.comments)),1)],8,Ht),e.type==="artwork"?(a(),u("span",{key:0,onClick:c=>ae(e.id)},[R(i(m,{id:"save-to-collection-button-"+e.id,name:"i-ion-bookmark",class:"text-blue-500 hover:text-blue-500"},null,8,["id"]),[[V,p(I).includes(e.id)]]),R(i(m,{name:"i-majesticons-bookmark-line",class:"icon-color hover:text-blue-500"},null,512),[[V,!p(I).includes(e.id)]])],8,Ot)):d("",!0),o("div",Pt,[o("button",Bt,[o("span",null,[i(m,{name:"i-uit-ellipsis-v",class:"align-middle icon icon-color"})])]),o("div",Nt,[o("div",Dt,[o("div",Ut,[i(n,{to:e.type==="artwork"?"/a/"+e.id:"/feed/"+e.id,class:"flex py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:_(()=>[i(m,{name:"i-fluent-arrow-enter-20-filled",class:"mr-2 text-base"}),h(" "+r(t.$t("open")),1)]),_:2},1032,["to"]),i(n,{to:e.type==="artwork"?"/a/"+e.id:"/feed/"+e.id,target:"_blank",class:"flex z-20 py-2 px-3 w-full rounded-md transition-all duration-150 hover:button-color parent-icon hover:text-white"},{default:_(()=>[i(m,{name:"i-ci-external-link",class:"mr-2 text-base"}),h(" "+r(t.$t("openInNewTab")),1)]),_:2},1032,["to"]),zt,o("div",null,[o("a",{class:"flex py-2 px-3 w-full leading-4 rounded-md transition-all duration-150 cursor-pointer hover:button-color parent-icon hover:text-white",onClick:c=>le(e.type==="artwork"?"/a/"+e.id:"/feed/"+e.id)},[i(m,{name:"i-icon-park-outline-copy",class:"mr-2 text-base"}),h(" "+r(t.$t("copySharableLink")),1)],8,jt)])])])])])])):d("",!0)])])])]))),128)),i(p($e),{class:"mt-6",load:te,"is-initial":p(E),"onUpdate:is-initial":l[5]||(l[5]=e=>ge(E)?E.value=e:null)},{loading:_(()=>[o("div",Gt,[i(m,{name:"i-line-md-loading-twotone-loop",class:"text-3xl"})])]),"no-results":_(()=>[o("div",qt,r(t.$t("feeds.nothingToShow")),1)]),"no-more":_(()=>[o("div",Jt,[h(r(t.$t("youHaveReachedTheEnd"))+" ",1),Kt,h(" "+r(t.$t("feeds.followMorePeople")),1)])]),_:1},8,["is-initial"]),o("div",Qt,[i(Se,{ref_key:"chronologicalModalViewRef",ref:G,section:"chronological"},null,512)]),o("div",Wt,[i(He,{ref_key:"chronologicalFeedModalViewRef",ref:q,section:"chronological-feed"},null,512)]),i(Le,{id:"feed-collection-selection-modal","modal-id":"feed-collection-selection-modal",ref_key:"collectionSelectionModalRef",ref:U,"work-id":p(A),class:"modal",onSave:ne},null,8,["work-id"]),R(i(Fe,{id:"copy-alert",text:t.$t("linkCopied"),icon:"i-bi-check-all"},null,8,["text"]),[[V,p(J)]])])])]),_:1},8,["hide-side","no-right-side"])):d("",!0)}}},_o=z(Yt,[["__scopeId","data-v-b13b808a"]]);export{_o as default};
