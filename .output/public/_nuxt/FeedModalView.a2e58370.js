import{a7 as q,o as a,m as r,b as w,p as o,s as u,U as S,V as T,J as $,t as d,i as ae,a as re,j as le,a3 as ne,l as ie,G,r as h,ab as ue,C as de,e as f,w as y,q as C,K as F,v as L,F as A,c as ce,u as z,E as me,x as ve,L as fe,M as we}from"./entry.ff1c6b2d.js";import{u as ke}from"./useFeed.ef69bb9d.js";import{S as ge}from"./Spinner.0f65676e.js";import{_ as J}from"./_plugin-vue_export-helper.a1a6add7.js";import{M as he}from"./ModalView.8c1c291a.js";const pe=["images"],_e=["src"],ye=["images"],be=["src"],xe=["images"],Ee=["src"],Le=["images"],$e=["src"],Ce={key:4,class:"imgrid"},Me=["src"],Ie={key:1,class:"relative text-center"},ze={class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 text-3xl font-semibold text-white"},Ve=["src"],Se={__name:"ImageList",props:{work:{type:Object,default:()=>{}}},setup(l){const j={1:"col-start-1 row-start-1 col-span-4 row-span-4",2:["col-start-1 row-start-1 col-span-1 row-span-2","col-start-2 row-start-1 col-span-1 row-span-2"],3:["col-start-1 row-start-1 col-span-1 row-span-4","col-start-2 row-start-1 col-span-1 row-span-2","col-start-2 row-start-3 col-span-1 row-span-2"]};return(m,v)=>{const p=q("lazy");return a(),r("div",null,[l.work.artwork_assets.length===1?(a(),r("div",{key:0,images:[m.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]},[w(o("img",{src:m.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed"),class:"object-contain w-full rounded",style:{"max-height":"1000px"},loading:"lazy",onError:v[0]||(v[0]=(...c)=>m.imageLoadError&&m.imageLoadError(...c))},null,40,_e),[[p,m.artworkThumb(l.work.artwork_assets[0].bucket,l.work.artwork_assets[0].filename,"feed")]])],8,pe)):u("",!0),l.work.artwork_assets.length===2?(a(),r("div",{key:1,images:l.work.images,class:"imgrid"},[(a(!0),r(S,null,T(l.work.images,(c,_)=>w((a(),r("img",{key:c,class:$(j[2][_]),src:c,loading:"lazy",onError:v[1]||(v[1]=(...k)=>m.imageLoadError&&m.imageLoadError(...k))},null,42,be)),[[p,c]])),128))],8,ye)):u("",!0),l.work.artwork_assets.length===3?(a(),r("div",{key:2,images:l.work.images,class:"imgrid"},[(a(!0),r(S,null,T(l.work.images,(c,_)=>w((a(),r("img",{key:c,class:$(j[3][_]),src:c,loading:"lazy",onError:v[2]||(v[2]=(...k)=>m.imageLoadError&&m.imageLoadError(...k))},null,42,Ee)),[[p,c]])),128))],8,xe)):u("",!0),l.work.artwork_assets.length===4?(a(),r("div",{key:3,images:l.work.images,class:"imgrid"},[(a(!0),r(S,null,T(l.work.images,c=>w((a(),r("img",{key:c,src:c,loading:"lazy",onError:v[3]||(v[3]=(..._)=>m.imageLoadError&&m.imageLoadError(..._))},null,40,$e)),[[p,c]])),128))],8,Le)):u("",!0),l.work.artwork_assets.length>4?(a(),r("div",Ce,[(a(!0),r(S,null,T(l.work.images,(c,_)=>(a(),r("div",{key:_},[_<3?w((a(),r("img",{key:0,src:c,loading:"lazy",onError:v[4]||(v[4]=(...k)=>m.imageLoadError&&m.imageLoadError(...k))},null,40,Me)),[[p,c]]):(a(),r("div",Ie,[o("span",ze,"+"+d(l.work.artwork_assets.length-4),1),w(o("img",{src:c,class:"z-0 brightness-50",loading:"lazy",onError:v[5]||(v[5]=(...k)=>m.imageLoadError&&m.imageLoadError(...k))},null,40,Ve),[[p,c]])]))]))),128))])):u("",!0)])}}},H=J(Se,[["__scopeId","data-v-433644ba"]]),B=l=>(fe("data-v-5e4bbeb1"),l=l(),we(),l),Te={class:"flex flex-row justify-between mb-2 w-full"},Be={key:0,class:"user-info"},je=["src"],De={class:"name"},Fe=B(()=>o("br",null,null,-1)),Ae=B(()=>o("span",{class:"mx-1"},"\xB7",-1)),Pe={class:"text-xxs"},Ue={key:1,class:"flex float-right flex-row gap-2 mb-4 cursor-pointer"},Ne=["innerHTML"],Oe={key:0,class:"p-2 md:p-4 user-info"},Re=["src"],We={class:"name"},Ge=B(()=>o("br",null,null,-1)),He=B(()=>o("span",{class:"mx-1"},"\xB7",-1)),qe={class:"px-2 mt-2 md:px-4"},Je={class:"text-xs font-semibold"},Ke=["id"],Ye=["id"],Qe={key:2,class:"flex flex-row justify-between"},Xe={key:0},Ze={key:1},es={key:2},ss={class:"mt-6 mb-2"},ts={key:0,class:"comment-box"},os={class:"flex flex-col"},as={class:"flex relative flex-col"},rs=["readonly","rows","placeholder"],ls={key:1,class:"p-4 mb-4 text-center rounded-md theme-color-secondary"},ns=["src"],is={class:"w-full"},us={class:"flex justify-between"},ds={class:"comment-time"},cs={key:0,class:"hidden reactions"},ms=B(()=>o("div",{class:"flex flex-row"},null,-1)),vs=[ms],fs={key:1,class:"mt-4 w-full text-xs italic text-center"},ws={id:"chronological-modal",class:"modal work-view"},ks={__name:"FeedModalView",props:{id:{type:String,default:""},section:{type:String,default:""}},emits:["showEmpty","showError"],setup(l,{expose:j,emit:m}){const v=l,p=ae();re();const{oApiConfiguration:c,fetchOptions:_}=le(),k=ke(c,_()),{generateArtworkThumb:K}=ne();ie(()=>{v.id!==""&&O(v.id),window.addEventListener("keydown",t=>{const s=document.getElementById("chronological-modal");t.key==="Escape"&&(!s||s.style.display!="flex")&&G().closeModal(`${v.section}-modal`)})});const x=v.id==="",N=h(!0),e=h({}),M=h(!1),O=async t=>{N.value=!0,empty.value=!1,error.value=!1,E.value=[],V.value.page=0;try{const[s,n]=await k.feedDetail({id:t});if(n)n=="Post not found"?m("showEmpty"):m("showError");else{if(s.feed.artworks){s.feed.artworks.images=[];for(let b=0;b<s.feed.artworks.artwork_assets.length;b++)if(b<=3){const i=await K(s.feed.artworks.artwork_assets[b].bucket,s.feed.artworks.artwork_assets[b].filename,"feed");s.feed.artworks.images.push(i)}}e.value=s.feed,M.value=s.feed.liked,await Z(t)}}catch{ue()}N.value=!1},R=h(null),Y=async t=>{R.value.view(t),G().openModal("chronological-modal")},Q=async()=>{const[t,s]=await k.like({feedId:e.value.id});if(t){M.value=!0,e.value._count.feed_likes++;const n=document.getElementById("feedLikeButton"+e.value.id);n.classList.add("animate-bounce"),setInterval(()=>{n.classList.remove("animate-bounce")},2500)}},X=async()=>{const[t,s]=await k.unlike({feedId:e.value.id});t&&(M.value=!1,e.value._count.feed_likes--)},E=h([]),V=h({perPage:5,page:0}),P=h([]),W=async t=>{try{const[s,n]=await k.fetchComments({feedId:t,pagination:{page:V.value.page,perPage:V.value.perPage}});return s.pagination.current_page===s.pagination.first_last.last_page?D.value=!1:D.value=!0,s.comments.forEach(b=>{P.value.push(b.id)}),s.comments}catch{}},Z=async t=>{try{(await W(t)).forEach(n=>E.value.push(n))}catch{}},D=h(!1),ee=async t=>{try{V.value.page+=1,(await W(t)).forEach(n=>E.value.push(n))}catch{}},g=h(),U=200,se=de(()=>g.value!=null&&g.value!==""?U-g.value.length:U),I=h(!1),te=async()=>{I.value=!0;try{const[t,s,n]=await k.comment({feedId:e.value.id,comment:g.value});t&&(g.value="",E.value.splice(0,0,s),E.value.join(),P.value.splice(0,0,s.id),P.value.join())}catch{}I.value=!1};return h([]),h(!1),h(!1),j({view:O}),(t,s)=>{const n=ve,b=q("auto-animate");return a(),r("div",{class:$(["z-40 work-container work-view",x?"w-full md:w-9/12 lg:w-2/5 mx-auto md:p-6 p-4 theme-color":"w-full"])},[o("div",{class:$(["w-full",{"overflow-y-scroll pr-4":x}])},[o("div",Te,[e.value.users?(a(),r("div",Be,[f(n,{to:"/profile/"+e.value.users.username},{default:y(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.value.users.avatar_bucket,e.value.users.avatar_filename),onError:s[0]||(s[0]=(...i)=>t.imageLoadError&&t.imageLoadError(...i))},null,40,je)]),_:1},8,["to"]),o("div",De,[f(n,{to:"/profile/"+e.value.users.username,class:"fullname"},{default:y(()=>[C(d(e.value.users.name),1)]),_:1},8,["to"]),Fe,f(n,{to:"/profile/"+e.value.users.username,class:"username"},{default:y(()=>[C(" @"+d(e.value.users.username),1)]),_:1},8,["to"]),Ae,o("span",Pe,d(t.formatDate(e.value.created_at,!0)),1)])])):u("",!0),x?(a(),r("div",Ue,[o("div",{class:"modal-close",onClick:s[1]||(s[1]=i=>t.closeModal(l.section+"-modal"))},[f(F,{name:"i-ion-close",class:"text-2xl"})])])):u("",!0)]),e.value.text?(a(),r("div",{key:0,innerHTML:e.value.text,class:"p-4 mb-4 rounded-md theme-color"},null,8,Ne)):u("",!0),e.value.artworks?(a(),r("div",{key:1,class:$(["mb-4 w-full rounded-md",x?"theme-color-secondary":"theme-color"])},[e.value.artworks.users?(a(),r("div",Oe,[f(n,{to:"/profile/"+e.value.artworks.users.username},{default:y(()=>[o("img",{class:"avatar",src:t.avatarCoverUrl(e.value.artworks.users.avatar_bucket,e.value.artworks.users.avatar_filename),onError:s[2]||(s[2]=(...i)=>t.imageLoadError&&t.imageLoadError(...i))},null,40,Re)]),_:1},8,["to"]),o("div",We,[f(n,{to:"/profile/"+e.value.artworks.users.username,class:"fullname hover:href"},{default:y(()=>[C(d(e.value.artworks.users.name),1)]),_:1},8,["to"]),Ge,f(n,{to:"/profile/"+e.value.artworks.users.username,class:"hover:underline text-xxs"},{default:y(()=>[C(" @"+d(e.value.artworks.users.username),1)]),_:1},8,["to"]),He,f(n,{to:"/a/"+e.value.artworks.id,class:"hover:underline text-xxs"},{default:y(()=>[C(d(t.formatDate(e.value.artworks.scheduled_post?e.value.artworks.scheduled_post:e.value.artworks.created_at,!0)),1)]),_:1},8,["to"])])])):u("",!0),o("div",qe,[o("span",Je,d(e.value.artworks.title),1),w(o("p",null,[o("span",{id:"feed-description-"+e.value.artworks.id},d(e.value.artworks.description.length>300?`${e.value.artworks.description.slice(0,300)}...`:e.value.artworks.description),9,Ke),e.value.artworks.description.length>300?(a(),r("a",{key:0,id:"feed-read-more-"+e.value.artworks.id,class:"href",onClick:s[3]||(s[3]=A(i=>t.readMore(e.value.artworks.description,e.value.artworks.id,"feed-read-more-","feed-description-"),["prevent"]))},d(t.$t("readMore")),9,Ye)):u("",!0)],512),[[L,e.value.artworks.description]])]),o("div",null,[e.value.artworks&&t.isMobile()?(a(),ce(n,{key:0,to:"/a/"+e.value.id,class:"cursor-pointer"},{default:y(()=>[f(H,{class:"p-2",work:e.value.artworks},null,8,["work"])]),_:1},8,["to"])):u("",!0),e.value.artworks&&!t.isMobile()?(a(),r("div",{key:1,class:"cursor-pointer",onClick:s[4]||(s[4]=A(i=>Y(e.value.artworks.id),["prevent"]))},[f(H,{class:"p-2 md:p-4",work:e.value.artworks},null,8,["work"])])):u("",!0)])],2)):u("",!0),e.value._count?(a(),r("div",Qe,[e.value._count.feed_comments?(a(),r("div",Xe,[o("b",null,d(t.thousand(e.value._count.feed_comments)),1),C(" "+d(e.value._count.feed_comments>1?t.$t("count.comments"):t.$t("count.comment")),1)])):u("",!0),e.value._count.feed_comments?u("",!0):(a(),r("div",Ze)),z(p).loggedIn?(a(),r("div",es,[o("div",{class:"flex flex-row",onClick:s[5]||(s[5]=i=>M.value?X():Q())},[w(f(F,{id:"feedLikeButton"+e.value.id,name:"i-ion-heart",class:"mr-2 text-xl text-red-500 cursor-pointer hover:text-red-500"},null,8,["id"]),[[L,M.value]]),w(f(F,{name:"i-ion-heart-outline",class:"mr-2 text-xl cursor-pointer hover:text-red-500"},null,512),[[L,!M.value]]),o("span",null,d(t.thousand(e.value._count.feed_likes)),1)])])):u("",!0)])):u("",!0),o("div",ss,[z(p).loggedIn?(a(),r("div",ts,[o("div",os,[o("div",as,[w(o("textarea",{"onUpdate:modelValue":s[6]||(s[6]=i=>g.value=i),class:$(["input form-input",[{"cursor-not-allowed":I.value},{"theme-color-secondary textarea":x}]]),readonly:I.value,cols:"20",rows:g.value!=null&&g.value!=""?"6":"0",placeholder:t.$t("comments.inputPlaceholder"),maxlength:U,"data-gramm":"false"},null,10,rs),[[me,g.value]]),w(o("span",{class:"absolute left-4 bottom-6 py-1 px-2 text-white rounded-md button-color"},d(z(se)),513),[[L,g.value!=null&&g.value!=""]]),o("span",{class:"absolute right-2 bottom-5 py-1 px-2",onClick:s[7]||(s[7]=A(i=>te(),["prevent"]))},[w(f(F,{name:"i-ion-prism",class:"text-xl transition-all duration-100 rotate-90 cursor-pointer text-colored"},null,512),[[L,g.value!=null&&g.value!=""&&!I.value]]),w(f(ge,null,null,512),[[L,I.value]])])])])])):u("",!0),z(p).loggedIn?u("",!0):(a(),r("div",ls,d(t.$t("comments.loginOrRegisterToLeaveComment")),1))]),o("div",{class:$(["comment-content",[{"pr-3 overflow-x-hidden":x},{"mb-20":!x}]])},[(a(!0),r(S,null,T(E.value,i=>w((a(),r("div",{key:i.id,class:"flex flex-row w-full comment-item"},[f(n,{class:"mr-2",to:"/profile/"+i.users.username},{default:y(()=>[o("img",{class:"w-10 h-10 avatar",src:t.avatarCoverUrl(i.users.avatar_bucket,i.users.avatar_filename),onError:s[8]||(s[8]=(...oe)=>t.imageLoadError&&t.imageLoadError(...oe))},null,40,ns)]),_:2},1032,["to"]),o("div",is,[o("div",{class:$(["p-4 w-full rounded-md",x?"theme-color-secondary":"theme-color"])},[o("div",us,[f(n,{to:"/profile/"+i.users.username,class:"mb-2 text-xs font-medium transition-all duration-150 cursor-pointer hover:font-bold"},{default:y(()=>[C(d(i.users.name),1)]),_:2},1032,["to"]),o("div",ds,d(t.formatDate(i.created_at,!0)),1)]),o("div",null,d(i.comment),1),z(p).loggedIn?(a(),r("div",cs,vs)):u("",!0)],2)])])),[[b]])),128)),e.value._count?w((a(),r("div",{key:0,class:"text-center capitalize href",onClick:s[9]||(s[9]=A(i=>ee(e.value.id),["prevent"]))},d(t.$t("comments.loadOlder")),513)),[[L,e.value._count.feed_comments>V.value.perPage&&D.value]]):u("",!0),w(o("div",{class:"w-full text-xs italic text-center"},d(t.$t("comments.reachedTheEnd")),513),[[L,E.value.length&&!D.value]]),z(p).loggedIn&&!E.value.length?(a(),r("div",fs,d(t.$t("comments.noCommentYet")),1)):u("",!0)],2)],2),o("div",ws,[f(he,{ref_key:"sharedWorkModalViewRef",ref:R,section:"chronological"},null,512)])],2)}}},bs=J(ks,[["__scopeId","data-v-5e4bbeb1"]]);export{bs as F,H as I};
